<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Scrapy-Re-动态爬虫实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/" class="article-date">
  <time datetime="2020-07-06T15:58:47.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/">Scrapy&amp;Re--动态爬虫实例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>关于动态爬虫：</p>
<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/1.png" style="zoom: 67%;">

<h2 id="实例一：爬取影评网站中的视频链接，视频名，以及图片"><a href="#实例一：爬取影评网站中的视频链接，视频名，以及图片" class="headerlink" title="实例一：爬取影评网站中的视频链接，视频名，以及图片"></a>实例一：爬取影评网站中的视频链接，视频名，以及图片</h2><p><a href="https://www.1905.com/mtalk/" target="_blank" rel="noopener">https://www.1905.com/mtalk/</a></p>
<h3 id="方法一：用request"><a href="#方法一：用request" class="headerlink" title="方法一：用request"></a>方法一：用request</h3><p>打开网站：</p>
<img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/2.png" style="zoom: 33%;">



<p>由于这是一个动态网页，我们不能直接爬它的网址。打开XHR，手动获取真正的URL。</p>
<img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/3.png" style="zoom:33%;">

<p>在之后写代码请求访问时，要把query string parameters 以键值对形式添加到我们的params中</p>
<img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/4.png" style="zoom: 33%;">



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">()</span>:</span></span><br><span class="line">    url=<span class="string">'http://www.1905.com/api/content/index.php'</span> </span><br><span class="line">    header=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.97 Safari/537.36'</span>&#125; <span class="comment">#这里头部不伪装成浏览器也可以访问</span></span><br><span class="line">    param=&#123;</span><br><span class="line"><span class="string">'callback'</span>: <span class="string">'reloadList'</span>,</span><br><span class="line"><span class="string">'m'</span>: <span class="string">'converged'</span>,</span><br><span class="line"><span class="string">'a'</span>: <span class="string">'info'</span>,</span><br><span class="line"><span class="string">'type'</span>: <span class="string">'jryp'</span>,</span><br><span class="line"><span class="string">'year'</span>: <span class="string">'2020'</span>,</span><br><span class="line"><span class="string">'month'</span>: <span class="string">'5'</span></span><br><span class="line">    &#125; <span class="comment">#从网站看到还有其他年份和月份的数据，我们可以直接修改param中的year和month。</span></span><br><span class="line">    r=requests.get(url,headers=header,params=param) </span><br><span class="line">    result=r.text</span><br><span class="line">find()</span><br></pre></td></tr></table></figure>

<p>我们发现多了一些数据 reloadList({“month”:{“6”:6,”5”:5,”4”:4,”3”:3,”2”:2,”1”:1}，导致返回的代码不是json字符串形式。这样会导致后续json.loads()将json字符串格式转为dict格式时出错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reloadList(&#123;&quot;month&quot;:&#123;&quot;6&quot;:6,&quot;5&quot;:5,&quot;4&quot;:4,&quot;3&quot;:3,&quot;2&quot;:2,&quot;1&quot;:1&#125;,&quot;info&quot;:[&#123;&quot;contentid&quot;:&quot;1458732&quot;,&quot;title&quot;:&quot;\u4e00\u5468\u70ed\u70b9\uff1a\u89e3\u8bfb\u201c\u4e24\u4f1a\u201d\u4e2d\u7684\u7535\u5f71\u4e4b\u58f0&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0529\&#x2F;thumb_1_224_122_20200529043833417252.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1458732.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-29\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1458506&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u5343\u9877\u6f84\u78a7\u7684\u65f6\u4ee3\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0529\&#x2F;thumb_1_224_122_20200529091151656904.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1458506.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-28\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1458290&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u5f20\u827a\u8c0b\u65b0\u7247\u300a\u575a\u5982\u78d0\u77f3\u300b\u300a\u60ac\u5d16\u4e4b\u4e0a\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0527\&#x2F;thumb_1_224_122_20200527040952900837.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1458290.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-27\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1458145&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u5c01\u795e\u4e09\u90e8\u66f2\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image13.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0527\&#x2F;thumb_1_224_122_20200527091651592674.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1458145.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-26\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1457789&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u897f\u6e38\u8bb0\u771f\u5047\u7f8e\u7334\u738b\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0526\&#x2F;thumb_1_224_122_20200526085953497978.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1457789.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-25\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1457465&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u718a\u51fa\u6ca1\u00b7\u72c2\u91ce\u5927\u9646\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image13.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0522\&#x2F;thumb_1_224_122_20200522062257499752.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1457465.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-22\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1457310&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u6211\u548c\u6211\u7684\u5bb6\u4e61\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0522\&#x2F;thumb_1_224_122_20200522090219537956.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1457310.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-21\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1457055&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a\u79c0\u7f8e\u4eba\u751f\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0520\&#x2F;thumb_1_224_122_20200520041720924811.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1457055.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-20\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1456896&quot;,&quot;title&quot;:&quot;\u4e24\u4f1a\u7279\u522b\u7b56\u5212\u8282\u76ee\uff1a\u63a8\u4ecb\u65b0\u7247\u300a749\u5c40\u300b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0521\&#x2F;thumb_1_224_122_20200521011124342128.png&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1456896.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-19\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1456602&quot;,&quot;title&quot;:&quot;\u767e\u4ee3\u5149\u5f71\u5386\u4e45\u5f25\u65b0 \u4e16\u754c\u535a\u7269\u9986\u65e5 \u611f\u53d7\u4e2d\u56fd\u7535\u5f71\u535a\u7269\u9986\u7684\u9b45\u529b&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0519\&#x2F;thumb_1_224_122_20200519091623915695.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1456602.shtml&quot;,&quot;duration&quot;:&quot;0&quot;,&quot;airtime&quot;:&quot;2020-05-18\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1456178&quot;,&quot;title&quot;:&quot;\u89e3\u8bfb\u201c\u514d\u7a0e\u5229\u597d\u201d\u53cc\u653f\u7b56\uff1a\u80fd\u4e3a\u7535\u5f71\u884c\u4e1a\u7684\u53d1\u5c55\u5e26\u6765\u54ea\u4e9b\u652f\u6301\uff1f&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0515\&#x2F;thumb_1_224_122_20200515041954797088.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1456178.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-15\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1455841&quot;,&quot;title&quot;:&quot;\u6ee1\u5730\u7686\u662f\u80e1\u516b\u4e00\uff01\u300a\u9b3c\u5439\u706f\u300bIP\u77e9\u9635\u4e00\u56e2\u4e71 \u4f5c\u8005\u80cc\u9505\u51a4\u4e0d\u51a4\uff1f&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0514\&#x2F;thumb_1_224_122_20200514031301735539.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1455841.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-14\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1455806&quot;,&quot;title&quot;:&quot;\u300a\u5029\u5973\u5e7d\u9b42\uff1a\u4eba\u95f4\u60c5\u300b\u7206\u706b\u51fa\u5708 \u662f\u6361\u6f0f\u8fd8\u662f\u7f51\u5927\u7684\u65b0\u91cc\u7a0b\u7891\uff1f&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image13.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0514\&#x2F;thumb_1_224_122_20200514090500861713.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1455806.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-13\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1455661&quot;,&quot;title&quot;:&quot;\u4ece\u7d27\u6025\u62a2\u6551\u751f\u547d\u5230\u5904\u7406\u65e5\u5e38\u7410\u788e \u56fd\u9645\u62a4\u58eb\u8282 \u5411\u6700\u7f8e\u62a4\u58eb\u81f4\u656c&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0513\&#x2F;thumb_1_224_122_20200513090430196613.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1455661.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-12\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1455507&quot;,&quot;title&quot;:&quot;\u7cbe\u7b97\u5e08\u738b\u6676\u518d\u5bfc\u7ecf\u5178 \u300a\u501a\u5929\u5c60\u9f99\u8bb0\u300b\uff1a\u8425\u9500\u4ece\u9009\u89d2\u5f00\u59cb\uff1f&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0512\&#x2F;thumb_1_224_122_20200512094841916354.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1455507.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-11\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1454917&quot;,&quot;title&quot;:&quot;\u4e00\u5468\u70ed\u70b9\uff1a\u89e3\u8bfb\u5f71\u89c6\u884c\u4e1a\u8054\u5408\u5021\u8bae \u4e3a\u201c\u81ea\u6551\u201d\u5efa\u8a00\u732e\u7b56&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0508\&#x2F;thumb_1_224_122_20200508044743904659.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1454917.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-08\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1454487&quot;,&quot;title&quot;:&quot;\u300a\u4eca\u65e5\u5f71\u8bc4\u00b7\u81f4\u656c\u52b3\u52a8\u8005\u300b\u4e4b\u7e41\u8302\uff1a\u75ab\u60c5\u4e4b\u4e2d\u6709\u62c5\u5f53\u7684\u4f01\u4e1a\u5bb6\u4eec&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0506\&#x2F;thumb_1_224_122_20200506052833620891.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1454487.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-07\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1454002&quot;,&quot;title&quot;:&quot;\u300a\u4eca\u65e5\u5f71\u8bc4\u00b7\u81f4\u656c\u52b3\u52a8\u8005\u300b\u4e4b\u4f59\u9999\uff1a\u75ab\u60c5\u671f\u95f4\u575a\u5b88\u5c97\u4f4d\u7684\u6559\u5e08\u4eec&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image14.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0430\&#x2F;thumb_1_224_122_20200430101201175534.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1454002.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-06\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1454000&quot;,&quot;title&quot;:&quot;\u300a\u4eca\u65e5\u5f71\u8bc4\u00b7\u81f4\u656c\u52b3\u52a8\u8005\u300b\u4e4b\u77d7\u7acb\uff1a\u5411\u4e2d\u56fd\u519b\u4eba\u4e0e\u4eba\u6c11\u8b66\u5bdf\u81f4\u656c&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0430\&#x2F;thumb_1_224_122_20200430101135678150.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1454000.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-05\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1453999&quot;,&quot;title&quot;:&quot;\u300a\u4eca\u65e5\u5f71\u8bc4\u00b7\u81f4\u656c\u52b3\u52a8\u8005\u300b\u4e4b\u7480\u74a8\uff1a\u5e73\u51e1\u4e14\u4f1f\u5927\u7684\u533b\u62a4\u4eba\u5458\u4eec&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image13.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0430\&#x2F;thumb_1_224_122_20200430101103363111.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1453999.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-04\u671f&quot;&#125;,&#123;&quot;contentid&quot;:&quot;1453998&quot;,&quot;title&quot;:&quot;\u300a\u4eca\u65e5\u5f71\u8bc4\u00b7\u81f4\u656c\u52b3\u52a8\u8005\u300b\u4e4b\u751f\u5982\u590f\u82b1\uff1a\u4e3a\u65b0\u65f6\u671f\u7684\u52b3\u52a8\u8005\u4eec\u70b9\u8d5e&quot;,&quot;thumb&quot;:&quot;https:\&#x2F;\&#x2F;image11.m1905.cn\&#x2F;uploadfile\&#x2F;2020\&#x2F;0430\&#x2F;thumb_1_224_122_20200430101037817743.jpg&quot;,&quot;url&quot;:&quot;https:\&#x2F;\&#x2F;www.1905.com\&#x2F;video\&#x2F;play\&#x2F;1453998.shtml&quot;,&quot;duration&quot;:&quot;480&quot;,&quot;airtime&quot;:&quot;2020-05-01\u671f&quot;&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<p>从preview里可以看到info是我们想要的数据。</p>
<img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/5.png" style="zoom:33%;">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用replace()将代码中最前面reloadList(和最后面的)剪掉</span></span><br><span class="line">result=result.replace(<span class="string">'reloadList('</span>,<span class="string">''</span>).replace(<span class="string">')'</span>,<span class="string">''</span>) </span><br><span class="line">    <span class="comment">#json.loads()将json字符串格式转为dict格式,json.dumps()则相反。</span></span><br><span class="line">    final=json.loads(result)</span><br><span class="line">    print(final) <span class="comment">#final就是我们最终的可以进行爬取的数据</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> final[<span class="string">'info'</span>]:</span><br><span class="line">        print(i[<span class="string">'url'</span>],i[<span class="string">'title'</span>],i[<span class="string">'thumb'</span>])</span><br><span class="line">        <span class="comment">#读取图片，使用content返回一个二进制数据</span></span><br><span class="line">        img=requests.get(i[<span class="string">'thumb'</span>]).content<span class="comment">#i['thumb']就是图片的链接</span></span><br><span class="line">        <span class="comment">#存储照片</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'D:/photos/%s.jpg'</span>%i[<span class="string">'title'</span>],<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(img)</span><br><span class="line">        <span class="keyword">break</span> <span class="comment">#循环一次试试</span></span><br><span class="line">find()<span class="comment">#正常返回的数据不会有reloadList，只有后面的info</span></span><br></pre></td></tr></table></figure>

<p>out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;month&#39;: &#123;&#39;6&#39;: 6, &#39;5&#39;: 5, &#39;4&#39;: 4, &#39;3&#39;: 3, &#39;2&#39;: 2, &#39;1&#39;: 1&#125;, &#39;info&#39;: [&#123;&#39;contentid&#39;: &#39;1458732&#39;, &#39;title&#39;: &#39;一周热点：解读“两会”中的电影之声&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0529&#x2F;thumb_1_224_122_20200529043833417252.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1458732.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-29期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1458506&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《千顷澄碧的时代》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0529&#x2F;thumb_1_224_122_20200529091151656904.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1458506.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-28期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1458290&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介张艺谋新片《坚如磐石》《悬崖之上》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0527&#x2F;thumb_1_224_122_20200527040952900837.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1458290.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-27期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1458145&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《封神三部曲》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image13.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0527&#x2F;thumb_1_224_122_20200527091651592674.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1458145.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-26期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1457789&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《西游记真假美猴王》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0526&#x2F;thumb_1_224_122_20200526085953497978.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1457789.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-25期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1457465&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《熊出没·狂野大陆》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image13.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0522&#x2F;thumb_1_224_122_20200522062257499752.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1457465.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-22期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1457310&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《我和我的家乡》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0522&#x2F;thumb_1_224_122_20200522090219537956.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1457310.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-21期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1457055&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《秀美人生》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0520&#x2F;thumb_1_224_122_20200520041720924811.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1457055.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-20期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1456896&#39;, &#39;title&#39;: &#39;两会特别策划节目：推介新片《749局》&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0521&#x2F;thumb_1_224_122_20200521011124342128.png&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1456896.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-19期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1456602&#39;, &#39;title&#39;: &#39;百代光影历久弥新 世界博物馆日 感受中国电影博物馆的魅力&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0519&#x2F;thumb_1_224_122_20200519091623915695.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1456602.shtml&#39;, &#39;duration&#39;: &#39;0&#39;, &#39;airtime&#39;: &#39;2020-05-18期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1456178&#39;, &#39;title&#39;: &#39;解读“免税利好”双政策：能为电影行业的发展带来哪些支持？&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0515&#x2F;thumb_1_224_122_20200515041954797088.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1456178.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-15期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1455841&#39;, &#39;title&#39;: &#39;满地皆是胡八一！《鬼吹灯》IP矩阵一团乱 作者背锅冤不冤？&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0514&#x2F;thumb_1_224_122_20200514031301735539.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1455841.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-14期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1455806&#39;, &#39;title&#39;: &#39;《倩女幽魂：人间情》爆火出圈 是捡漏还是网大的新里程碑？&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image13.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0514&#x2F;thumb_1_224_122_20200514090500861713.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1455806.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-13期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1455661&#39;, &#39;title&#39;: &#39;从紧急抢救生命到处理日常琐碎 国际护士节 向最美护士致敬&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0513&#x2F;thumb_1_224_122_20200513090430196613.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1455661.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-12期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1455507&#39;, &#39;title&#39;: &#39;精算师王晶再导经典 《倚天屠龙记》：营销从选角开始？&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0512&#x2F;thumb_1_224_122_20200512094841916354.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1455507.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-11期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1454917&#39;, &#39;title&#39;: &#39;一周热点：解读影视行业联合倡议 为“自救”建言献策&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0508&#x2F;thumb_1_224_122_20200508044743904659.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1454917.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-08期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1454487&#39;, &#39;title&#39;: &#39;《今日影评·致敬劳动者》之繁茂：疫情之中有担当的企业家们&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0506&#x2F;thumb_1_224_122_20200506052833620891.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1454487.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-07期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1454002&#39;, &#39;title&#39;: &#39;《今日影评·致敬劳动者》之余香：疫情期间坚守岗位的教师们&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image14.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0430&#x2F;thumb_1_224_122_20200430101201175534.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1454002.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-06期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1454000&#39;, &#39;title&#39;: &#39;《今日影评·致敬劳动者》之矗立：向中国军人与人民警察致敬&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0430&#x2F;thumb_1_224_122_20200430101135678150.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1454000.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-05期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1453999&#39;, &#39;title&#39;: &#39;《今日影评·致敬劳动者》之璀璨：平凡且伟大的医护人员们&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image13.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0430&#x2F;thumb_1_224_122_20200430101103363111.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1453999.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-04期&#39;&#125;, &#123;&#39;contentid&#39;: &#39;1453998&#39;, &#39;title&#39;: &#39;《今日影评·致敬劳动者》之生如夏花：为新时期的劳动者们点赞&#39;, &#39;thumb&#39;: &#39;https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0430&#x2F;thumb_1_224_122_20200430101037817743.jpg&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1453998.shtml&#39;, &#39;duration&#39;: &#39;480&#39;, &#39;airtime&#39;: &#39;2020-05-01期&#39;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.1905.com&#x2F;video&#x2F;play&#x2F;1458732.shtml 一周热点：解读“两会”中的电影之声 https:&#x2F;&#x2F;image11.m1905.cn&#x2F;uploadfile&#x2F;2020&#x2F;0529&#x2F;thumb_1_224_122_20200529043833417252.jpg</span><br></pre></td></tr></table></figure>



<p>图片已经保存到我们的指定目录下，成功！</p>
<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/6.png" alt></p>
<p>当然我们可以循环遍历出所有年份月份的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">()</span>:</span></span><br><span class="line">    param=&#123;</span><br><span class="line"><span class="string">'callback'</span>: <span class="string">'reloadList'</span>,</span><br><span class="line"><span class="string">'m'</span>: <span class="string">'converged'</span>,</span><br><span class="line"><span class="string">'a'</span>: <span class="string">'info'</span>,</span><br><span class="line"><span class="string">'type'</span>: <span class="string">'jryp'</span></span><br><span class="line">&#125; <span class="comment">#从网站看到还有其他年份和月份的数据，我们可以直接修改param中的year和month</span></span><br><span class="line">    url=<span class="string">'http://www.1905.com/api/content/index.php'</span></span><br><span class="line">    header=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.97 Safari/537.36'</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2016</span>,<span class="number">2021</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">13</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                param[<span class="string">'year'</span>]=str(i)</span><br><span class="line">                param[<span class="string">'month'</span>]=str(j)</span><br><span class="line">                r=requests.get(url,headers=header,params=param) <span class="comment">#头部不伪装成浏览器也可以访问</span></span><br><span class="line">                result=r.text</span><br><span class="line">                a=result.replace(<span class="string">'reloadList('</span>,<span class="string">''</span>).replace(<span class="string">')'</span>,<span class="string">''</span>)</span><br><span class="line">                <span class="comment">#json.loads()将json字符串格式转为dict格式,json.dumps()则相反。</span></span><br><span class="line">                final=json.loads(a)</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> final[<span class="string">'info'</span>]:</span><br><span class="line">                    print(k[<span class="string">'url'</span>],k[<span class="string">'title'</span>],k[<span class="string">'thumb'</span>])</span><br><span class="line">             <span class="keyword">except</span>:</span><br><span class="line">                 print(<span class="string">'non'</span>)</span><br><span class="line">find()<span class="comment">#正常返回的数据不会有reloadList，只有后面的info</span></span><br></pre></td></tr></table></figure>

<p>out：</p>
<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/10.png" alt></p>
<p>出现了个问题，网站上2016年前几个月是没有数据的，但结果输出了这年12月份的数据。2020年的后几个月没有数据，但也输出了这年1月的数据。我猜测是由于他们的后台设置。解决方法可以把2016和2020单独遍历。但我觉得还有更好的办法。（比如在代码中把年份和月份取出来进行遍历）</p>
<pre><code>except:
     print(&apos;non&apos;)</code></pre><p>find()#正常返回的数据不会有reloadList，只有后面的info</p>
<h3 id="方法二：用scrapy"><a href="#方法二：用scrapy" class="headerlink" title="方法二：用scrapy"></a>方法二：用scrapy</h3><p>如何创建爬虫我们前面已经说过，现在不再累述。直接打开我们创建的爬虫文件movietalk.py</p>
<p>完整代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovietalkSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'movietalk'</span></span><br><span class="line"><span class="comment">#    allowed_domains = ['1905.com']</span></span><br><span class="line">    start_urls = [<span class="string">'https://www.1905.com/api/content/index.php?callback=reloadList&amp;m=converged&amp;a=info&amp;type=jryp&amp;year=2020&amp;month=5'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment"># 用replace()将代码中最前面reloadList(和最后面的)剪掉</span></span><br><span class="line">        result = response.text.replace(<span class="string">'reloadList('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="comment"># json.loads()将json字符串格式转为dict格式,json.dumps()则相反。</span></span><br><span class="line">        final = json.loads(result)</span><br><span class="line">        print(final)  <span class="comment"># final就是我们最终的可以进行爬取的数据</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> final[<span class="string">'info'</span>]:</span><br><span class="line">            items=&#123;<span class="string">'url'</span>:i[<span class="string">'url'</span>],<span class="string">'title'</span>:i[<span class="string">'title'</span>],<span class="string">'thumb'</span>:i[<span class="string">'thumb'</span>]&#125; <span class="comment">#保存到一个csv文件</span></span><br><span class="line">            <span class="keyword">yield</span> items</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>这里要注意的是，由于我们不是用request库去请求访问，因此不能请求访问时把参数放到params中。由于我们知道设置params的效果就相当于直接在url后面添加上这些参数。</p>
<p>因此我们直接将下图中整个url（包括？后面的）复制下来。</p>
<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/3.png" alt></p>
<p>还要注意的是，其中的title是中文，如果直接保存成csv文件会乱码。我们打开settings.py文件，加入一句代码即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FEED_EXPORT_ENCODING &#x3D; &#39;gb18030&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/7.png" alt></p>
<p>如果要保存为json或txt格式，则加这行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FEED_EXPORT_ENCODING &#x3D;&#39;utf-8&#39;</span><br></pre></td></tr></table></figure>

<p>查看是否保存成功：</p>
<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/8.png" alt></p>
<p><img src="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/9.png" alt></p>
<p>成功！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/" data-id="ckcapekfg000icovthtwkcp87" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Request/" rel="tag">Request</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/" rel="tag">动态爬虫</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-机器学习之监督学习算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/" class="article-date">
  <time datetime="2020-07-06T15:05:38.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%AF%87/">机器学习基础篇</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/">机器学习之监督学习算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文是一个关于常用的监督学习算法的学习笔记，以及与其相关的一些知识点。</p>
<p>在监督学习中，我们已经被告知了什么是所谓的正确答案。即下面例子中的良性和恶性。</p>
<h3 id="回归问题（预测连续的数值输出）"><a href="#回归问题（预测连续的数值输出）" class="headerlink" title="回归问题（预测连续的数值输出）"></a>回归问题（预测连续的数值输出）</h3><p>例子：房屋价格预测</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/1.png" alt></p>
<h4 id="线性回归算法"><a href="#线性回归算法" class="headerlink" title="线性回归算法"></a>线性回归算法</h4><p>也就是根据已有的样本拟合一条直线，用线性方程（一次函数）表示（称为假设函数）。如何拟合（设置参数）这个假设函数是重点。方程中的参数称为模型参数。</p>
<img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/5.png">

<p>m represents Number of training examples</p>
<p>x represents input variable/features</p>
<p>y represents output variable/‘target’ variable</p>
<p>代价函数（总是一个凹形函数）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/6.png" alt></p>
<p>我们通过改变这两个参数，让代价函数取到最小值，此时的假设函数能最好拟合实际情况。</p>
<h5 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降"></a>梯度下降</h5><p>我们用梯度下降算法将代价函数最小化，公式为：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/7.png" alt></p>
<p>a称为学习速率。用来控制当梯度下降时，我们迈出多大的步子。a越大，梯度下降就越迅速。 化简上式得：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/8.png" alt></p>
<h4 id="多元线性回归"><a href="#多元线性回归" class="headerlink" title="多元线性回归"></a>多元线性回归</h4><p>实际情况当我们的参数很多时（比如在预测房价时，参数不只有面积，还有房屋年龄，卧室数量，地理位置…我们就要进行多元线性回归，这部分会用到线性代数的知识）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/9.png" alt></p>
<p>Tips 1</p>
<p>将x均值归一化（特征收敛），使这些x都处于某个较小的范围，这样后面当我们用梯度下降算法时就可以更快的找到那个最佳点。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/10.png" alt></p>
<p>Tips 2</p>
<p>如何选择学习率a</p>
<p>a过小会导致迭代次数过多</p>
<p>a过大会导致代价函数不收敛，甚至发散。</p>
<p>a取0.001，0.003，0.01，0.03，0.1，0.3，1，3…十倍的取，去看代价函数的值随迭代次数变化的情况（当我们判断代价函数此时收敛时，迭代次数越少，说明此时选择的a就越适合）找到合适的a。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/11.png" alt></p>
<p>上图当迭代次数为300左右时，代价函数就已经很好的收敛了。</p>
<h5 id="用正规方程求参数（不同于梯度下降算法）"><a href="#用正规方程求参数（不同于梯度下降算法）" class="headerlink" title="用正规方程求参数（不同于梯度下降算法）"></a>用正规方程求参数（不同于梯度下降算法）</h5><p>这种方法不需要进行tips 1 .</p>
<p>例子：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/14.png" alt></p>
<p>当X的转置*X不可逆时，我们就不能算出参数。通常出现这种情况是由于以下两个原因：</p>
<p>1.两个成倍数的特征值（删掉其中一个）</p>
<p>2.特征值太多，数量多于样本数（删掉一些）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/15.png" alt></p>
<p>对比</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/13.png" alt></p>
<h4 id="多项式回归"><a href="#多项式回归" class="headerlink" title="多项式回归"></a>多项式回归</h4><p>有时我们的假设函数为二次函数或多次函数才能很好拟合：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/12.png" alt></p>
<h3 id="分类问题（预测一个离散的数值输出）"><a href="#分类问题（预测一个离散的数值输出）" class="headerlink" title="分类问题（预测一个离散的数值输出）"></a>分类问题（预测一个离散的数值输出）</h3><p>例子：预测肿瘤是良性还是恶性</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/2.png" alt></p>
<p>当有多个特征值（age，size）时：</p>
<p>（o代表良性，x代表恶性）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/3.png" alt></p>
<p>实际上机器学习甚至可以设计一种算法处理无穷多个特征值的算法。</p>
<h4 id="logistic回归（一种分类算法）"><a href="#logistic回归（一种分类算法）" class="headerlink" title="logistic回归（一种分类算法）"></a>logistic回归（一种分类算法）</h4><p>算法的输出值会一直介于0到1之间</p>
<p>如下图</p>
<p>Sigmoid/Logistic 函数：g(z)</p>
<p>在logistic回归中假设函数的表示方法：</p>
<p>假设函数也可看作输入以θ为参数的x时，假设输出y=1的概率。</p>
<p>当g(z)大于等于0.5（z大于等于0）时，假设函数预测为1。</p>
<p>当g(z)小于0.5（z小于0）时，假设函数预测为0。</p>
<p>z其实就是我们之前回归问题中的假设函数。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/16.png" alt></p>
<p>假如现在我们已经拟合出了参数θ1  θ2   …</p>
<p>下图中的那条粉色线被称为决策边界，粉线右边输出为1，左边为0；它是假设函数的一个属性。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/17.png" alt></p>
<p>如果我们的数据集是这样的：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/18.png" alt></p>
<p>我们可以在假设函数中添加高阶多项式。假如现在我们已经拟合出了参数θ1  θ2   …，可以看到现在的决策边界是一个圆。这说明决策边界可以是更复杂的曲线，取决于我们假设函数。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/19.png" alt></p>
<p>如何拟合参数θ</p>
<p>先介绍一下代价函数。在logistic回归中，如果只有一个训练样本，我们的代价函数是这样的：</p>
<p>当y=1时，如下图，假如假设函数算出来的值也是1，则把1代到代价函数-log(1)中，此时代价为0。若假设函数趋于0，则代价为无穷大。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/20.png" alt></p>
<p>代价函数图象的推导：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/21.png" alt></p>
<p>红线部分 自变量x(这里就是我们的代价函数)范围0到1，y再取负值则沿x轴翻转，就得到代价函数的图像。</p>
<p>当y=0时，如下图</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/22.png" alt></p>
<p>我们把单个样本代价函数用一个式子表示:</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/23.png" alt></p>
<p>现在，当有多个样本时，我们真正的代价函数可以表示为：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/24.png" alt></p>
<p>与之前一样，用梯度下降算法，我们不断改变θ（改变θ要同时改变θ1，θ2…)，找到代价函数的最小值，这时的θ就是最佳的。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/7.png" alt></p>
<p>可以看到求出来的更新θj的式子与线性回归中的一样！</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/25.png" alt></p>
<p>同样的，我们也可以把特征缩放的方法用在这里，让梯度下降收敛更快。</p>
<h4 id="多类别问题"><a href="#多类别问题" class="headerlink" title="多类别问题"></a>多类别问题</h4><p>如果有多种类别，例如三种时，如下图所示：</p>
<p>这时我们的解决方法是把最初的训练集分成三种情况，求出这三个训练集各自的假设函数。我们给出一个新的x值，代到这三个假设函数中，得到的值（概率）最大的那个就是我们应该选择的类别。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/26.png" alt></p>
<h3 id="过拟合"><a href="#过拟合" class="headerlink" title="过拟合"></a>过拟合</h3><p>过拟合是指我们的假设函数能够很好的拟合现有的数据集，但我们用了太多的特征（x）去拟合它，当有新的样本时并不能推测出一个合适的输出值。在回归问题和分类问题中都有可能会出现。如下图所示，右一就是过拟合的情况</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/27.png" alt></p>
<h4 id="解决方法（对于线性回归问题）："><a href="#解决方法（对于线性回归问题）：" class="headerlink" title="解决方法（对于线性回归问题）："></a>解决方法（对于线性回归问题）：</h4><ol>
<li><p>减少特征数量（人工剔除或用算法自动剔除）</p>
</li>
<li><p>正则化：保留所有的特征，但把其中一些参数θj的值减小，让一些特征值的作用变小。</p>
<h5 id="将正则化用于梯度下降算法中"><a href="#将正则化用于梯度下降算法中" class="headerlink" title="将正则化用于梯度下降算法中"></a>将正则化用于梯度下降算法中</h5><p>右边的那项为正则化项 ，λ为正则化参数。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/28.png" alt></p>
</li>
</ol>
<p>对于θ0，按我们前面的说法是一个常数，因为x0我们默认为1。没有必要进行正则化。</p>
<p>对于其他的θj，每次变化的表达式依然是求偏导，只不过现在多了一项。整理式子后我们发现θj的表达式中，（1-a*λ/m）是略小于1的，因为一般m很大。这说明在添加正则项后，每次θ都会再变小一点点。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/29.png" alt></p>
<h5 id="将正则化用于正规方程中："><a href="#将正则化用于正规方程中：" class="headerlink" title="将正则化用于正规方程中："></a>将正则化用于正规方程中：</h5><p>θ新的表达式如下：（这里不再具体推导多的那一项是怎么来的，矩阵为(n+1)行*(n+1)列）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/30.png" alt></p>
<p>如果λ&gt;0，我们可以确保括号里的那一项是可逆的。</p>
<h4 id="解决方法（对于逻辑回归问题）："><a href="#解决方法（对于逻辑回归问题）：" class="headerlink" title="解决方法（对于逻辑回归问题）："></a>解决方法（对于逻辑回归问题）：</h4><p>与在线性回归问题中处理梯度下降算法的过拟合类似</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/31.png" alt></p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/32.png" alt></p>
<h3 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h3><p>当特征值很多时，前面学的算法会难以处理，因为计算量过大。此时我们会用神经网络模型。</p>
<p>神经网络模型会模拟人类大脑处理信息的方式，一个神经元接收一些信息（多个输入）并进行处理后，将输出传递给下一个神经元。输出用一个假设函数表示。假设函数中的参数在一些文献中也叫做weights权重。</p>
<p>下图中x0称为偏执单元，视情况决定是否添加。橙圈为一个神经元。<img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/33.png" alt></p>
<p>神经网络：</p>
<p>第一层叫输入层（input layer），第二层叫隐藏层（hidden layer，可以有多层，隐藏层每一项称为单元，它们的输出称为激活项），第三层叫输出层（output layer）。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/34.png" alt></p>
<p>前向传播</p>
<p>下图中g(z)就是sigmoid函数。权重矩阵为三行四列。一般来说，如果一个网络第j层有sj个单元，在j+1层有s(j+1)个单元，则θj的维度为s(j+1)行sj+1列。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/35.png" alt></p>
<h4 id="例1（非线性分类）"><a href="#例1（非线性分类）" class="headerlink" title="例1（非线性分类）"></a>例1（非线性分类）</h4><p>如果我们想要得到这样一个假设函数（实现非线性分类问题），当两个输入相同时，分为一类，当两个输入不同时，分为另一类。如下图所示</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/40.png" alt></p>
<p>首先先用神经网络算法实现与操作</p>
<p>如果有三个特征值（x0默认为1），设参数为-30，20，20。x1和x2取值范围为0或1，假设函数就是g(-30+20X1+20X2)，现在进行检验，输入四种组合，我们的假设函数都能得到正确的结果。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/36.png" alt></p>
<p>或操作：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/37.png" alt></p>
<p>非操作：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/38.png" alt></p>
<p>将前面几种操作组合起来，就得到我们想要的实现。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/39.png" alt></p>
<h4 id="例2（多元分类）"><a href="#例2（多元分类）" class="headerlink" title="例2（多元分类）"></a>例2（多元分类）</h4><p>我们想要判断一张图片是行人，汽车，摩托还是货车。理想情况下，我们希望假设函数输出四种结果，每种结果分别对应行人，汽车…如下图</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/41.png" alt></p>
<h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>根据训练集，从第一层到最后一层去构造每层假设方程的参数。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/42.png" alt></p>
<h5 id="表示代价函数"><a href="#表示代价函数" class="headerlink" title="表示代价函数"></a>表示代价函数</h5><p>我们用的是逻辑回归的代价函数的一般形式（输出有多种可能时）。</p>
<p>如下图所示。K个输出单元（可以看作假设函数的输出是一个k维向量），这里有四个；h(x)i指输出向量中的第几个；m个样本；L层，这里有四层；Sl表示第l层有S个单元。正则项可以理解为第l层中，第j个单元第i个参数θji的平方（一列一列的把参数依次加起来）。从前文可知，在第l层，θ参数可以看作一个矩阵，由i和j来标识。这里我们依然不加入偏差项(i=0项)</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/43.png" alt></p>
<h5 id="用反向传播算法求代价函数的偏导项"><a href="#用反向传播算法求代价函数的偏导项" class="headerlink" title="用反向传播算法求代价函数的偏导项"></a>用反向传播算法求代价函数的偏导项</h5><p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/45.png" alt></p>
<p>现在先来看看只有一个样本集的情况，a表示激活值（一个向量）：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/46.png" alt></p>
<p>我们先表示一个激活值（不考虑第一层，每个激活值都是最开始的输入通过一或多次的g(z)函数得出来的输出）的代价（误差），<img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/47.png" alt>代表第l层第j个节点的误差。</p>
<p>从最后一层反向将前一层的代价（最后一层为假设的输出值与样本y值之差）表示出来。所有的代价相加就等于代价函数对θ求偏导的值。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/48.png" alt></p>
<p>当有m个样本集时：</p>
<p>用循环把每个样本的误差加一起。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/49.png" alt></p>
<p>注意！对于反向传播，我们用随机取值的方法将参数初始化。如下图：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/52.png" alt></p>
<p>反向传播算法的缺点：</p>
<p>容易出现一些无法被程序识别的小bug，即使我们观察到代价函数是逐渐减小的，但最终的结果可能会比正确的结果高出一个量级。</p>
<p>解决办法：</p>
<h5 id="梯度检验"><a href="#梯度检验" class="headerlink" title="梯度检验"></a>梯度检验</h5><p>当θ为一个实数时，让对θ的导数近似等于对θ的双侧差分</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/51.png" alt></p>
<p>当θ为一个n维向量时，让对每个θ的偏导等于它们各自的双侧差分<img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/50.png" alt></p>
<p>之后我们验证通过梯度检验算出的代价函数的偏导是否近似等于反向传播算出来的偏导。如果很接近则说明反向传播是正确运行的，在正式运行代码时要关掉梯度检验，因为它梯度检验的运行速度很慢。</p>
<h5 id="神经网络模型总述"><a href="#神经网络模型总述" class="headerlink" title="神经网络模型总述"></a>神经网络模型总述</h5><p>1.选择一个合适的神经网络结构</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/53.png" alt></p>
<p>2.将参数初始化。</p>
<p>3.用前向传播获得假设函数。</p>
<p>4.通过代码计算代价函数。</p>
<p>5.用反向传播算法计算各个参数的偏导</p>
<p>6.用梯度检验确定反向传播算法没问题后，关闭梯度检验（如下图）</p>
<p>7.知道偏导后就可以用梯度下降算法或其他高级算法更新θ，逐渐找到代价函数的局部最小值。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/55.png" alt></p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><h4 id="选择多项式（选择模型）"><a href="#选择多项式（选择模型）" class="headerlink" title="选择多项式（选择模型）"></a>选择多项式（选择模型）</h4><p>将样本集分为训练集，(交叉)验证集和测试集（比例为3:1:1）：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/57.png" alt></p>
<p>三个集合各自的代价函数的表示：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/58.png" alt></p>
<p>如下图所示，假如有10个待选模型。我们先用验证集的数据确定参数，再算出这10个代价函数的值（比较大小），选择哪个假设函数是最优的，假如第五个模型是最优的。以这个最优模型的参数为参考，去人工调整训练集模型的参数。</p>
<p>在不断调整训练集的模型的过程中，我们用测试集（相当于新样本）去测试模型的泛化误差。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/59.png" alt></p>
<h4 id="如何判断偏差欠拟合与方差过拟合"><a href="#如何判断偏差欠拟合与方差过拟合" class="headerlink" title="如何判断偏差欠拟合与方差过拟合"></a>如何判断偏差欠拟合与方差过拟合</h4><p>当偏差过大时为欠拟合，当方差过大时为过拟合。</p>
<p>一开始，训练误差与验证误差一开始都很大，此时为欠拟合。随着假设函数多项式次数的增加，训练误差变得很小，而验证误差远远大于训练误差，此时为过拟合。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/60.png" alt></p>
<h4 id="正则化与欠拟合、过拟合的关系"><a href="#正则化与欠拟合、过拟合的关系" class="headerlink" title="正则化与欠拟合、过拟合的关系"></a>正则化与欠拟合、过拟合的关系</h4><p>λ越大，对参数的惩罚程度越大，欠拟合程度越高。</p>
<p>λ越小，对参数的惩罚程度越小，过拟合程度越高。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/61.png" alt></p>
<p>如何选择正则化参数λ：</p>
<p>尝试一组λ，找出其中使验证误差最小的λ。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/62.png" alt></p>
<p>随λ的变化，训练误差与验证误差的变化如下：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/63.png" alt></p>
<h4 id="学习曲线"><a href="#学习曲线" class="headerlink" title="学习曲线"></a>学习曲线</h4><p>判断模型是否存在偏差或方差问题</p>
<p>m就找训练集中的大概10个20个就可以了。</p>
<p>正常情况下，我们假设模型是一个二次函数（这个训练集比较符合二次函数的特征）：</p>
<p>随着训练样本的增加，训练误差会越来越大。（样本少时能很好拟合，但样本多时二次函数可能就已经不足以拟合了）</p>
<p>而验证误差会越来越小，因为随着样本的增大，能获得更好的泛化表现。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/64.png" alt></p>
<p>高偏差时的学习曲线：</p>
<p>如果我们用一个一次函数作为假设函数：</p>
<p>随着训练样本的增加，训练误差会不断增大直到趋近一个稳定值。因为我们知道一次函数并不能很好的拟合这些样本，即使样本量越来越大。而验证误差会从一个很高的值逐渐减小直到趋近一个稳定值。最终两种误差值会比较接近。<img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/65.png" alt></p>
<p>高方差时的学习曲线：</p>
<p>当我们用一个高阶函数作为（模型）假设函数时：</p>
<p>随着样本量不断的增大，模型会变得越来越好。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/66.png" alt></p>
<p>因此如果出现过拟合问题，增大训练样本数量对改进算法是有帮助的。</p>
<h4 id="如何修正算法"><a href="#如何修正算法" class="headerlink" title="如何修正算法"></a>如何修正算法</h4><p>在了解过拟合和欠拟合之后。当得到一个线性回归模型但它的误差很大时，我们可以从以下方面去修正这个模型（修正欠拟合或过过拟合）：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/56.png" alt></p>
<h4 id="对于神经网络的欠拟合和过拟合"><a href="#对于神经网络的欠拟合和过拟合" class="headerlink" title="对于神经网络的欠拟合和过拟合"></a>对于神经网络的欠拟合和过拟合</h4><p>通常隐藏层越多，每层单元越多（计算量也就越大），就意味着参数越多，更容易出现过拟合。我们可以根据之前所说的将样本集划分为训练集，验证集，测试集来找最适合的那个模型结构。</p>
<h3 id="机器学习系统设计"><a href="#机器学习系统设计" class="headerlink" title="机器学习系统设计"></a>机器学习系统设计</h3><h4 id="执行的优先级"><a href="#执行的优先级" class="headerlink" title="执行的优先级"></a>执行的优先级</h4><p>例子：垃圾邮件分类器</p>
<p>如何让这个分类器错误率更小（随机选择以下的方法，因为不能确定哪一个效果更好）：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/68.png" alt></p>
<p>一开始时，先用一个尽量简单粗暴的模型去实现，之后再根据学习曲线去调整这个模型。同时，对于那些经常被错误分类的邮件，我们看看这些邮件内容它们有没有什么共同特征（误差分析），看是否还需要添加新的特征。</p>
<p>在决定要不要使用词干提取器（如Porter Stemmer，会将discount，discounts，discounting…看成一个）时，我们可以用交叉验证集的数据验证在使用它前后误差率的变化。</p>
<h4 id="不对称性分类的误差评估（度量率-召回率）"><a href="#不对称性分类的误差评估（度量率-召回率）" class="headerlink" title="不对称性分类的误差评估（度量率/召回率）"></a>不对称性分类的误差评估（度量率/召回率）</h4><p>例如我们想要设计一个模型判断是否是癌症，由于我们知道患病率本来就是很低的，所以对于那些验证集样本，我们不能接受一个相对高的误差率。（比如误差率是1%，而验证集样本的患病率是0.5%，说明这个模型不好。因为即使我们把所有样本都当成未患病的，误差率也只有0.5%。）</p>
<p>对于这种偏斜类，我们可以用度量率或召回率（越高越好）来度量误差</p>
<p>度量率：在验证集中，对于我们预测的那些患有癌症的病人，真正有多少个患有癌症的比率。</p>
<p>召回率：在验证集中，对于那些患有癌症的病人，我们预测正确的比率。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/69.png" alt></p>
<p>度量率和召回率的权衡</p>
<p>假如我们将假设函数的临界值设为0.7。假设值&gt;=0.7时预测为1，此时的度量率高，而召回率低。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/70.png" alt></p>
<p>用F1 Score值（0-1之间，越大越好）来度量：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/71.png" alt></p>
<h3 id="支持向量机（SVM）-大间距分类器"><a href="#支持向量机（SVM）-大间距分类器" class="headerlink" title="支持向量机（SVM）/大间距分类器"></a>支持向量机（SVM）/大间距分类器</h3><h4 id="推导代价函数"><a href="#推导代价函数" class="headerlink" title="推导代价函数"></a>推导代价函数</h4><p>在逻辑函数中，一个样本的代价函数表示为</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/72.png" alt></p>
<p>（图左）当y=1时，代价函数替换为品红色线，用cost1(z)表示。</p>
<p>（图右）当y=0时，代价函数替换为品红色线，用cost0(z)表示。</p>
<p>用上面的两项代替逻辑回归代价函数函数表达式的那两项，去掉1/m（习惯），不再用λ参数而是C去权衡代价项和正则项的权重，就得到支持向量机的代价函数：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/73.png" alt></p>
<h4 id="假设函数"><a href="#假设函数" class="headerlink" title="假设函数"></a>假设函数</h4><p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/74.png" alt></p>
<h4 id="分析代价函数"><a href="#分析代价函数" class="headerlink" title="分析代价函数"></a>分析代价函数</h4><p>现在我们要使代价函数最小，根据图形可知</p>
<p>如果y=1时，z&gt;=1代价函数就最小（我们知道根据假设函数z&gt;=0时就能够正确分类）。（通常参数C会选取的很大）</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/75.png" alt></p>
<p>SVM决策边界：</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/76.png" alt></p>
<p>举例</p>
<p>黑色线就是向量机的决策边界（黑色线到正/负样本的距离称为间距，它比起其他线间距是最大的），相比其他的决策边界，它的鲁棒性更强，适用性也更好。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/77.png" alt></p>
<h4 id="高斯核函数exp"><a href="#高斯核函数exp" class="headerlink" title="高斯核函数exp()"></a>高斯核函数exp()</h4><p>用于在向量机中定义新的特征变量，获得更加复杂精确的决策边界。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/80.png" alt></p>
<p>假如我们用特征值x1，x2构造三个新特征f1，f2，f3。手动选择三个标记点。这里的exp()就是核函数，确切来说是高斯核函数。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/81.png" alt></p>
<p>σ的作用：</p>
<p>如果标记点在[3,5]，当x为[3,5]时，f1位于最高点</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/78.png" alt></p>
<p>每个标记点l对应一个f</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/82.png" alt></p>
<p>来看看核函数是怎么预测输出的：</p>
<p>这里假设x是二维（两个特征值x1，x2）</p>
<p>三个特征变量f1，f2，f3，假如现在我们有三个标记点，且已经知道参数的值（下图所示）。与之前一样，当假设函数&gt;=0时，预测输出值为1。</p>
<p>现在如果有一个样本（x1,x2），靠近l1（品红色部分），那么根据核函数定义假设函数的值&gt;=0，预测输出为1。如果一个样本靠近三个标记点的任意一个，它都会被预测为1。通过这种方式我们就可以得到一条橘红的非线性的决策边界，内部预测为1，外部预测为0。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/79.png" alt></p>
<p>如何选取标记点l</p>
<p>将标记点直接选取为样本的位置</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/83.png" alt></p>
<p>（对于特征值x1，x2…，如果x1是房屋面积(例如1000平米)，x2是卧室的数量，它们的值差异很大，我们需要把x1缩放，以免||x-l||^2都由房屋面积决定，让SVM能考虑到所有特征变量f。）</p>
<p>f作为新的特征向量</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/84.png" alt></p>
<p>引入核函数之后的向量机的代价函数：</p>
<p>需要注意的是，在实际操作中，如果参数特别多时，我们计算θ^2(等同于[θ]^T[θ])时，会改为计算[θ]^TM[θ]，M为一个矩阵，与标记点有关。这样是为了简化计算。</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/85.png" alt></p>
<p>参数大小的选择</p>
<p><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/86.png" alt></p>
<h4 id="线性核函数"><a href="#线性核函数" class="headerlink" title="线性核函数"></a>线性核函数</h4><p>线性核函数为K(x,z)=xTz。</p>
<h4 id="向量机vs逻辑回归vs神经网络"><a href="#向量机vs逻辑回归vs神经网络" class="headerlink" title="向量机vs逻辑回归vs神经网络"></a>向量机vs逻辑回归vs神经网络</h4><h2 id><a href="#" class="headerlink" title></a><img src="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/87.png" alt></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/" data-id="ckcapekfl000pcovt7zcc1sgr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" rel="tag">监督学习</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux操作学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T15:03:12.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Linux操作学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="快捷操作"><a href="#快捷操作" class="headerlink" title="快捷操作"></a>快捷操作</h3><p>ls:查看当前目录下的文件和目录。</p>
<p>cd:使用 cd 命令可进入其他目录(如cd code  表示进入code目录)</p>
<p><code>cd ..</code> 可以回到上一级目录，类似 Windows 的「向上」。</p>
<p><code>cd -</code> 表示回到上一次所在的目录，类似 Windows 的「后退」。</p>
<p><code>cd ~</code> 表示回到当前用户的主目录，类似 Windows 的「回到桌面」。</p>
<p><code>cd /</code> 表示进入根目录，它是一切目录的父目录</p>
<h3 id="查看目录结构：tree"><a href="#查看目录结构：tree" class="headerlink" title="查看目录结构：tree"></a>查看目录结构：tree</h3><p>使用 tree 命令，可以列出一个文件夹下的所有子文件夹和文件（以树形结构来进行列出）。按下 <code>ctrl + c</code> 键即可停止遍历。</p>
<h3 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h3><p>使用 pwd 命令可以获取当前目录的绝对路径（指一个以根目录 / 为起点的完整路径）</p>
<p><strong>提示：</strong>如果忘记了目录名、文件名或命令，可使用 Tab 键自动补全，还可避免输入错误；连续按两次 Tab 可以显示全部候选结果。</p>
<h3 id="新建目录"><a href="#新建目录" class="headerlink" title="新建目录"></a>新建目录</h3><p>使用 <code>mkdir</code> 命令可创建目录，<code>mkdir mycode</code> 的意思就是新建一个名为 <code>mycode</code> 的目录。</p>
<p>还可以在 <code>mkdir</code> 后加入 <code>-p</code> 参数，一次性创建多级目录，如：</p>
<p><img src="/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt="img"></p>
<h3 id="Linux-文件操作"><a href="#Linux-文件操作" class="headerlink" title="Linux 文件操作"></a>Linux 文件操作</h3><p>使用 <code>touch</code> 命令可以新建文件，比如我想在新建一个名为 “hello” 的文件，可输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ **touch hello**</span><br></pre></td></tr></table></figure>

<p>（该命令不会覆盖已有同名文件）</p>
<p>使用 <code>cp</code> 命令（Copy）复制文件到指定目录下，比如要把 <code>hello</code> 文件复制到 <code>one/two</code> 这个目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ **cp hello one&#x2F;two&#x2F;**</span><br></pre></td></tr></table></figure>

<p>如果要复制目录，需要在 <code>cp</code> 后加上 <code>-r</code> ，然后接上 <code>目录名 目标目录名</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ mkdir test</span><br><span class="line">shiyanlou:~&#x2F; $ cp -r test one&#x2F;two </span><br><span class="line">shiyanlou:~&#x2F; $ tree one </span><br><span class="line">one</span><br><span class="line"> └── two</span><br><span class="line">      ├── hello</span><br><span class="line">      ├── test</span><br><span class="line">      └── three</span><br><span class="line"></span><br><span class="line">3 directories, 1 file</span><br></pre></td></tr></table></figure>



<p>下面是 Linux 中对文件的常用操作，包含新建、复制、删除等。</p>
<h4 id="新建空白文件"><a href="#新建空白文件" class="headerlink" title="新建空白文件"></a>新建空白文件</h4><p>使用 <code>touch</code> 命令可以新建文件，比如我想在新建一个名为 “hello” 的文件，可输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ touch hello</span><br></pre></td></tr></table></figure>

<p>“hello” 文件就被创建出来了，用 <code>ls</code> 命令查看一下：</p>
<p><img src="/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Linux%E6%93%8D%E4%BD%9C%5C2.png" alt></p>
<p>（该命令不会覆盖已有同名文件）</p>
<h4 id="编辑文件"><a href="#编辑文件" class="headerlink" title="编辑文件"></a>编辑文件</h4><p>使用vim命令进该文件，点击insert可进行编辑。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ vim hello</span><br></pre></td></tr></table></figure>

<p>编辑完成后按退出esc键，再输入 :wq  即可实现保存且退出。</p>
<h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h4><p>使用 <code>cp</code> 命令（Copy）复制文件到指定目录下，比如要把 <code>hello</code> 文件复制到 <code>one/two</code> 这个目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ cp hello one&#x2F;two&#x2F;  </span><br><span class="line">shiyanlou:~&#x2F; $ tree one   </span><br><span class="line">one</span><br><span class="line"> └── two</span><br><span class="line">      ├── hello</span><br><span class="line">      └── three</span><br><span class="line"></span><br><span class="line">2 directories, 1 file</span><br><span class="line">shiyanlou:~&#x2F; $</span><br></pre></td></tr></table></figure>

<p>如果要复制目录，需要在 <code>cp</code> 后加上 <code>-r</code> ，然后接上 <code>目录名 目标目录名</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ mkdir test</span><br><span class="line">shiyanlou:~&#x2F; $ cp -r test one&#x2F;two</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>使用 <code>rm</code> 命令删除文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ ls</span><br><span class="line">Code  Desktop  hello  one</span><br><span class="line">shiyanlou:~&#x2F; $ rm hello</span><br><span class="line">shiyanlou:~&#x2F; $ ls</span><br><span class="line">Code  Desktop  one</span><br></pre></td></tr></table></figure>

<p>删除目录要加上 <code>-r</code> 选项，类似 <code>cp -r</code> 拷贝目录，会删除目录和目录下的所有内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ mkdir test</span><br><span class="line">shiyanlou:~&#x2F; $ ls</span><br><span class="line">Code  Desktop  one  test</span><br><span class="line">shiyanlou:~&#x2F; $ rm -r test</span><br><span class="line">shiyanlou:~&#x2F; $ ls</span><br><span class="line">Code  Desktop  one</span><br></pre></td></tr></table></figure>

<h4 id="移动文件-目录与重命名"><a href="#移动文件-目录与重命名" class="headerlink" title="移动文件 / 目录与重命名"></a>移动文件 / 目录与重命名</h4><p>使用 <code>mv</code> 命令可以移动文件或目录。</p>
<p>首先，我们进入到 <code>/home/shiyanlou</code> 目录，使用 <code>touch</code> 创建空文件 <code>test1</code>：</p>
<p>然后，我们用mkdir创建一个新目录 <code>dir1</code></p>
<p>使用 <code>mv</code> 命令 将 <code>test1</code> 移动到 <code>dir1</code> 目录，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:~&#x2F; $ mv test1 dir1</span><br><span class="line">shiyanlou:~&#x2F; $ cd dir1</span><br><span class="line">shiyanlou:dir1&#x2F; $ ls</span><br><span class="line">test1</span><br></pre></td></tr></table></figure>

<p><code>mv</code> 命令还可以用来重命名，如 <code>mv test1 test2</code>， 会把 <code>test1</code> 重命名为 <code>test2</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:dir1&#x2F; $ ls</span><br><span class="line">test1</span><br><span class="line">shiyanlou:dir1&#x2F; $ mv test1 test2</span><br><span class="line">shiyanlou:dir1&#x2F; $ ls</span><br><span class="line">test2</span><br></pre></td></tr></table></figure>

<h4 id="cat打印"><a href="#cat打印" class="headerlink" title="cat打印"></a>cat打印</h4><p>使用 <code>cat</code> 命令，可以将文件中的内容打印到屏幕上，使用方法是 <code>cat 文件路径</code>。</p>
<p>现在还没有文件，我们先从其他地方复制过来一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:dir1&#x2F; $ cp &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">shiyanlou:dir1&#x2F; $ ls</span><br><span class="line">passwd  test2</span><br></pre></td></tr></table></figure>

<p>这样就把 <code>passwd</code> 文件从 <code>/etc</code> 目录拷贝到了当前目录中，然后我们用 <code>cat passwd</code> 显示文件中的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:dir1&#x2F; $ cat passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>

<p>使用 <code>cat -n</code> 可以带行号地打印文件内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shiyanlou:dir1&#x2F; $ cat -n passwd</span><br><span class="line">     1    root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">     2    daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">     3    bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">     4    sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">     5    sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">     6    games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">     7    man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>

<h4 id="帮助命令man"><a href="#帮助命令man" class="headerlink" title="帮助命令man"></a>帮助命令man</h4><p>在 Linux 环境中，如果你遇到困难，可以使用 <code>man</code> 命令，它是 <code>Manual pages</code> 的缩写。例如输入 <code>man cat</code> ，可以获取 cat 命令的详细的帮助文件。进入到 man 的页面后，按 <code>q</code> 可以退出 man。</p>
<p>有些命令可以使用 <code>--help</code> 选项查看帮助文档。如输入man –help </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapeket0000covtg9b25trp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Matplotlib学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T15:00:10.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BA%93/">数据分析库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Matplotlib学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>echarts.baidu.com(这个网站提供很多前端框架，当我们把数据处理好之后，可以直接把这些数据放到框架中得到很多炫酷的展示,模仿MATLAB 构建，主要做数据可视化图表。</p>
<h2 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h2><h3 id="实例1（10到12点的温度变化图）"><a href="#实例1（10到12点的温度变化图）" class="headerlink" title="实例1（10到12点的温度变化图）"></a>实例1（10到12点的温度变化图）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt <span class="comment">#plt用来绘折线图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下代码为绘制一天内每隔2小时显示当前的气温图</span></span><br><span class="line"></span><br><span class="line">x=range(<span class="number">2</span>,<span class="number">26</span>,<span class="number">2</span>)</span><br><span class="line">y=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>) <span class="comment">#设置图片大小，如果没有这行，则为默认大小，dpi指像素</span></span><br><span class="line">plt.plot(x,y) <span class="comment">#绘图</span></span><br><span class="line">plt.xticks(x) <span class="string">'''设置x轴为刚才x的格式（从2到24，每间隔2），若不设置则为默认的样式。也可按自己的要求设置如plt.xticks(range(2,25)) '''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#若要实现x轴每隔0.5取一个呢？则应该这样：i=[i/2 for i in range(4,49)],plt.xticks(i);另一种方式可以用while循环。</span></span><br><span class="line">plt.yticks(range(min(y),max(y)+<span class="number">1</span>)) <span class="comment">#设置y轴的刻度范围</span></span><br><span class="line"><span class="string">''' plt.savefig('C:/Users/Administrator/t1.png') #保存图片到指定路径</span></span><br><span class="line"><span class="string">plt.savefig('C:/Users/Administrator/sig_size.png') #指以矢量图的形式保存图片到指定路径，矢量图放大不会有锯齿 ??此行代码有问题  '''</span></span><br><span class="line">plt.show() <span class="comment">#展示图形,jupyter notebook中只用plt.plot()就可显示出图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实现10-12点显示这120分钟的温度</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">b=[random.randint(<span class="number">20</span>,<span class="number">35</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">120</span>)]</span><br><span class="line">a=range(<span class="number">120</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.plot(a,b)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment">#如下图所示</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt></p>
<p>#但我们希望x轴的刻度能以时钟的形式展示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#调整x轴的刻度，这里先让x轴以字符串形式标记</span><br><span class="line">_x&#x3D;a</span><br><span class="line">_xtick_labels &#x3D; [&#39;hello,&#123;&#125;&#39;.format(i) for i in _x]</span><br><span class="line">plt.xticks(_x,_xtick_labels) #将传入的x（数字）和字符串一一对应。实现x轴坐标以字符串的方式显示</span><br><span class="line">plt.plot(_x,b) </span><br><span class="line">#如下图所示，x轴的坐标点名会变为hello，0  hello,1 hello,2 ...hello,119,但太过密集，我们用以下方式调</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_x&#x3D;list(a)[::10] #将a转换成列表型，让之前x轴上的点每隔10个取一个，达到放大的目的。</span><br><span class="line">_xtick_labels &#x3D; [&#39;hello,&#123;&#125;&#39;.format(i) for i in _x]</span><br><span class="line">plt.xticks(_x,_xtick_labels) #将传入的x（数字）和字符串一一对应。实现x轴坐标以字符串的方式显示</span><br><span class="line">plt.plot(_x,b) </span><br><span class="line">#如下图所示，x轴的坐标点名会变为hello,0  hello,10 hello,20 ...hello,110,共12个点</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt></p>
<p>#现在我们想把横坐标以小时分钟的形式表示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.plot(a,y)</span><br><span class="line">_x=list(a)[::<span class="number">4</span>]</span><br><span class="line">_xtick_labels = [<span class="string">'10点&#123;&#125;分'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">60</span>)]</span><br><span class="line">_xtick_labels += [<span class="string">'11点&#123;&#125;分'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">60</span>)]</span><br><span class="line">plt.xticks(_x,_xtick_labels[::<span class="number">4</span>])</span><br><span class="line">plt.savefig(<span class="string">'C:/Users/Administrator/Desktop/计算机学习note/Matplotlib/4.png'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt></p>
<p>现在 我们将x轴的表达式旋转90度，使得能够看清楚。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接在刚刚设置x轴的代码中添加rotation</span></span><br><span class="line"></span><br><span class="line">plt.xticks(_x,_xtick_labels[::<span class="number">4</span>],rotation=<span class="number">90</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#对我们的图添加描述信息，图的标题，x，y轴的标签。在刚才的代码中加入三行：</span><br><span class="line">plt.xticks(_x,_xtick_labels[::4],rotation&#x3D;90)</span><br><span class="line">plt.xlabel(&#39;时间&#39;)</span><br><span class="line">plt.ylabel(&#39;温度，摄氏度&#39;)</span><br><span class="line">plt.title(&#39;10点到12点每分钟温度的变化情况&#39;)</span><br><span class="line">#plt.savefig(&#39;C:&#x2F;Users&#x2F;Administrator&#x2F;Desktop&#x2F;计算机学习note&#x2F;Matplotlib&#x2F;6.png&#39;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.grid(alpha=<span class="number">0.1</span>) <span class="string">'''增加网格，alpha指网格透明度，值从0-1，以改变x,y轴的疏密来改变网格的疏密,还可传入linestyle等'''</span></span><br></pre></td></tr></table></figure>

<h3 id="实例2（从11到30岁自己和同桌的恋爱次数变化图）"><a href="#实例2（从11到30岁自己和同桌的恋爱次数变化图）" class="headerlink" title="实例2（从11到30岁自己和同桌的恋爱次数变化图）"></a>实例2（从11到30岁自己和同桌的恋爱次数变化图）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">x=range(<span class="number">11</span>,<span class="number">31</span>)</span><br><span class="line">y_1=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">y_2=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.grid(alpha=<span class="number">0.1</span>)<span class="comment">#增加网格，alpha指网格透明度</span></span><br><span class="line">plt.xlabel(<span class="string">'年龄'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'恋爱次数'</span>)</span><br><span class="line">plt.xticks(x)</span><br><span class="line">plt.plot(x,y_1,label=<span class="string">'自己'</span>)<span class="comment">#在这里还可以设置线条的颜色；如用linestyle==‘--’设置线条风格，用linewidth=5设置线条粗细，用alpha=0.5设置透明度</span></span><br><span class="line">plt.plot(x,y_2,label=<span class="string">'同桌'</span>,color=<span class="string">'pink'</span>)</span><br><span class="line">plt.legend() <span class="comment">#前两行中的label和legend联合使用，添加图例，实现图中右上的效果。可传入参数log改变位置</span></span><br><span class="line"><span class="comment">#plt.savefig('C:/Users/Administrator\Desktop/计算机学习note/Matplotlib/7.png')</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt></p>
<h3 id="思维导图（折线图）"><a href="#思维导图（折线图）" class="headerlink" title="思维导图（折线图）"></a>思维导图（折线图）</h3><p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.jpg" alt></p>
<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.jpg" alt></p>
<h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><p>技术要点：plt.scatter(x,y)</p>
<h3 id="实例1（3月与10月每天的气温散点图）"><a href="#实例1（3月与10月每天的气温散点图）" class="headerlink" title="实例1（3月与10月每天的气温散点图）"></a>实例1（3月与10月每天的气温散点图）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">x_3=range(<span class="number">1</span>,<span class="number">32</span>)</span><br><span class="line">x_10=range(<span class="number">51</span>,<span class="number">82</span>)</span><br><span class="line">y_3=[<span class="number">11</span>,<span class="number">17</span>,<span class="number">16</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">21</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">19</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>]</span><br><span class="line">y_10=[<span class="number">26</span>,<span class="number">26</span>,<span class="number">28</span>,<span class="number">19</span>,<span class="number">21</span>,<span class="number">17</span>,<span class="number">16</span>,<span class="number">19</span>,<span class="number">18</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">19</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">9</span>]</span><br><span class="line"><span class="comment">#设置图片大小</span></span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line"><span class="comment">#设置网格</span></span><br><span class="line">plt.grid(alpha=<span class="number">0.5</span>)</span><br><span class="line"><span class="comment">#生成散点图</span></span><br><span class="line">plt.scatter(x_3,y_3,label=<span class="string">'三月份'</span>)</span><br><span class="line">plt.scatter(x_10,y_10,label=<span class="string">'五月份'</span>)</span><br><span class="line"><span class="comment">#调整x轴的刻度</span></span><br><span class="line">_x=list(x_3)+list(x_10)</span><br><span class="line">_xtick_labels=[<span class="string">'3月&#123;&#125;号'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> x_3]</span><br><span class="line">_xtick_labels+=[<span class="string">'10月&#123;&#125;号'</span>.format(i<span class="number">-50</span>) <span class="keyword">for</span> i <span class="keyword">in</span> x_10]</span><br><span class="line">plt.xticks(_x,_xtick_labels,rotation=<span class="number">45</span>)</span><br><span class="line"><span class="comment">#调整y轴的刻度</span></span><br><span class="line">_y=range(min(y_3),max(y_10)+<span class="number">1</span>)</span><br><span class="line">plt.yticks(_y)</span><br><span class="line"><span class="comment">#添加图例</span></span><br><span class="line">plt.legend()</span><br><span class="line"><span class="comment">#添加描述信息</span></span><br><span class="line">plt.xlabel(<span class="string">'日期'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'温度（摄氏度）'</span>)</span><br><span class="line"><span class="comment">#保存此散点图</span></span><br><span class="line">plt.savefig(<span class="string">'C:\\Users\\Administrator\\Desktop\\计算机学习note\\Matplotlib\\10.png'</span>)</span><br><span class="line"><span class="comment">#展示</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>除了在绘制散点图时我们用plt.scatter()进行绘制，其他方法与折线图没有任何区别。</p>
<h2 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h2><h3 id="实例1（某日的电影票房）"><a href="#实例1（某日的电影票房）" class="headerlink" title="实例1（某日的电影票房）"></a>实例1（某日的电影票房）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">y=[<span class="number">2.91</span>,<span class="number">7.88</span>,<span class="number">11.97</span>,<span class="number">11.72</span>,<span class="number">0.1</span>,<span class="number">3.5</span>]</span><br><span class="line">x=[<span class="string">'雷霆沙赞！'</span>,<span class="string">'反贪风暴4'</span>,<span class="string">'误杀'</span>,<span class="string">'叶问4'</span>,<span class="string">'士兵顺溜：兵王争锋'</span>,<span class="string">'老师·好'</span>]</span><br><span class="line">plt.bar(range(len(x)),y,width=<span class="number">0.3</span>)<span class="comment">#width表示柱子的宽度</span></span><br><span class="line">plt.xticks(range(len(x)),x,rotation=<span class="number">45</span>)</span><br><span class="line">plt.ylabel(<span class="string">'票房（亿）'</span>)</span><br><span class="line"><span class="comment">#plt.savefig('C:\\Users\\Administrator\\Desktop\\计算机学习note\\Matplotlib\\11.png')</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<p>此时我们发现x轴坐标显示不完全，我们可以用plt.barh()将柱子横过来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">y=[<span class="number">2.91</span>,<span class="number">7.88</span>,<span class="number">11.97</span>,<span class="number">11.72</span>,<span class="number">0.1</span>,<span class="number">3.5</span>]</span><br><span class="line">x=[<span class="string">'雷霆沙赞！'</span>,<span class="string">'反贪风暴4'</span>,<span class="string">'误杀'</span>,<span class="string">'叶问4'</span>,<span class="string">'士兵顺溜：兵王争锋'</span>,<span class="string">'老师·好'</span>]</span><br><span class="line">plt.barh(range(len(x)),y,height=<span class="number">0.3</span>,color=<span class="string">'orange'</span>)<span class="comment">#由于柱子是横着的，要用height表示柱子的宽度</span></span><br><span class="line">plt.yticks(range(len(x)),x)<span class="comment">#之前的x变成y；</span></span><br><span class="line">plt.xlabel(<span class="string">'票房（亿）'</span>)<span class="comment">#之前的x变成y</span></span><br><span class="line"><span class="comment">#plt.savefig('C:\\Users\\Administrator\\Desktop\\计算机学习note\\Matplotlib\\12.png')</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<h3 id="实例2–绘制多次条形图（某三天的4部电影票房）"><a href="#实例2–绘制多次条形图（某三天的4部电影票房）" class="headerlink" title="实例2–绘制多次条形图（某三天的4部电影票房）"></a>实例2–绘制多次条形图（某三天的4部电影票房）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">y_14=[<span class="number">2358</span>,<span class="number">399</span>,<span class="number">2358</span>,<span class="number">362</span>]</span><br><span class="line">y_15=[<span class="number">12357</span>,<span class="number">156</span>,<span class="number">2045</span>,<span class="number">168</span>]</span><br><span class="line">y_16=[<span class="number">15746</span>,<span class="number">312</span>,<span class="number">4497</span>,<span class="number">319</span>]</span><br><span class="line">x=[<span class="string">'猩球崛起3：终极之战'</span>,<span class="string">'敦刻尔克'</span>,<span class="string">'蜘蛛侠：英雄归来'</span>,<span class="string">'战狼2'</span>]</span><br><span class="line"><span class="comment">#我们将15号的x轴坐标的后移一个柱子宽度0.2，将16号的x轴坐标的后移2个柱子宽度0.2，就可以将这三天的票房信息都放在一张表里</span></span><br><span class="line">bar_width=<span class="number">0.2</span></span><br><span class="line">x_14=list(range(len(x)))</span><br><span class="line">x_15=[i+bar_width <span class="keyword">for</span> i <span class="keyword">in</span> x_14]</span><br><span class="line">x_16=[i+bar_width*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> x_14]</span><br><span class="line">plt.bar(range(len(x)),y_14,width=bar_width,label=<span class="string">'14号'</span>)</span><br><span class="line">plt.bar(x_15,y_15,width=bar_width,label=<span class="string">'15号'</span>)</span><br><span class="line">plt.bar(x_16,y_16,width=bar_width,label=<span class="string">'16号'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.grid()</span><br><span class="line">plt.xticks(x_15,x)<span class="comment">#我们将电影名放到三个柱子中间，所以是x_15,更美观</span></span><br><span class="line">plt.ylabel(<span class="string">'票房（万）'</span>)</span><br><span class="line">plt.savefig(<span class="string">'C:\\Users\\Administrator\\Desktop\\计算机学习note\\Matplotlib\\13.png'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" alt></p>
<h2 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h2><h3 id="实例1（根据电影时长统计电影频数）"><a href="#实例1（根据电影时长统计电影频数）" class="headerlink" title="实例1（根据电影时长统计电影频数）"></a>实例1（根据电影时长统计电影频数）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment">#a为250部电影的时长集合</span></span><br><span class="line">a=[<span class="number">131</span>,  <span class="number">98</span>, <span class="number">125</span>, <span class="number">131</span>, <span class="number">124</span>, <span class="number">139</span>, <span class="number">131</span>, <span class="number">117</span>, <span class="number">128</span>, <span class="number">108</span>, <span class="number">135</span>, <span class="number">138</span>, <span class="number">131</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">114</span>, <span class="number">119</span>, <span class="number">128</span>, <span class="number">121</span>, <span class="number">142</span>, <span class="number">127</span>, <span class="number">130</span>, <span class="number">124</span>, <span class="number">101</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">115</span>,  <span class="number">99</span>, <span class="number">136</span>, <span class="number">126</span>, <span class="number">134</span>,  <span class="number">95</span>, <span class="number">138</span>, <span class="number">117</span>, <span class="number">111</span>,<span class="number">78</span>, <span class="number">132</span>, <span class="number">124</span>, <span class="number">113</span>, <span class="number">150</span>, <span class="number">110</span>, <span class="number">117</span>,  <span class="number">86</span>,  <span class="number">95</span>, <span class="number">144</span>, <span class="number">105</span>, <span class="number">126</span>, <span class="number">130</span>,<span class="number">126</span>, <span class="number">130</span>, <span class="number">126</span>, <span class="number">116</span>, <span class="number">123</span>, <span class="number">106</span>, <span class="number">112</span>, <span class="number">138</span>, <span class="number">123</span>,  <span class="number">86</span>, <span class="number">101</span>,  <span class="number">99</span>, <span class="number">136</span>,<span class="number">123</span>, <span class="number">117</span>, <span class="number">119</span>, <span class="number">105</span>, <span class="number">137</span>, <span class="number">123</span>, <span class="number">128</span>, <span class="number">125</span>, <span class="number">104</span>, <span class="number">109</span>, <span class="number">134</span>, <span class="number">125</span>, <span class="number">127</span>,<span class="number">105</span>, <span class="number">120</span>, <span class="number">107</span>, <span class="number">129</span>, <span class="number">116</span>, <span class="number">108</span>, <span class="number">132</span>, <span class="number">103</span>, <span class="number">136</span>, <span class="number">118</span>, <span class="number">102</span>, <span class="number">120</span>, <span class="number">114</span>,<span class="number">105</span>, <span class="number">115</span>, <span class="number">132</span>, <span class="number">145</span>, <span class="number">119</span>, <span class="number">121</span>, <span class="number">112</span>, <span class="number">139</span>, <span class="number">125</span>, <span class="number">138</span>, <span class="number">109</span>, <span class="number">132</span>, <span class="number">134</span>,<span class="number">156</span>, <span class="number">106</span>, <span class="number">117</span>, <span class="number">127</span>, <span class="number">144</span>, <span class="number">139</span>, <span class="number">139</span>, <span class="number">119</span>, <span class="number">140</span>,  <span class="number">83</span>, <span class="number">110</span>, <span class="number">102</span>,<span class="number">123</span>,<span class="number">107</span>, <span class="number">143</span>, <span class="number">115</span>, <span class="number">136</span>, <span class="number">118</span>, <span class="number">139</span>, <span class="number">123</span>, <span class="number">112</span>, <span class="number">118</span>, <span class="number">125</span>, <span class="number">109</span>, <span class="number">119</span>, <span class="number">133</span>,<span class="number">112</span>, <span class="number">114</span>, <span class="number">122</span>, <span class="number">109</span>, <span class="number">106</span>, <span class="number">123</span>, <span class="number">116</span>, <span class="number">131</span>, <span class="number">127</span>, <span class="number">115</span>, <span class="number">118</span>, <span class="number">112</span>, <span class="number">135</span>,<span class="number">115</span>, <span class="number">146</span>, <span class="number">137</span>, <span class="number">116</span>, <span class="number">103</span>, <span class="number">144</span>,  <span class="number">83</span>, <span class="number">123</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">154</span>,<span class="number">136</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">106</span>, <span class="number">129</span>, <span class="number">126</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">109</span>, <span class="number">141</span>,<span class="number">120</span>, <span class="number">117</span>, <span class="number">106</span>, <span class="number">149</span>, <span class="number">122</span>, <span class="number">122</span>, <span class="number">110</span>, <span class="number">118</span>, <span class="number">127</span>, <span class="number">121</span>, <span class="number">114</span>, <span class="number">125</span>, <span class="number">126</span>,<span class="number">114</span>, <span class="number">140</span>, <span class="number">103</span>, <span class="number">130</span>, <span class="number">141</span>, <span class="number">117</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">114</span>, <span class="number">133</span>, <span class="number">137</span>,  <span class="number">92</span>,<span class="number">121</span>, <span class="number">112</span>, <span class="number">146</span>,  <span class="number">97</span>, <span class="number">137</span>, <span class="number">105</span>,  <span class="number">98</span>, <span class="number">117</span>, <span class="number">112</span>,  <span class="number">81</span>,  <span class="number">97</span>, <span class="number">139</span>, <span class="number">113</span>,<span class="number">134</span>, <span class="number">106</span>, <span class="number">144</span>, <span class="number">110</span>, <span class="number">137</span>, <span class="number">137</span>, <span class="number">111</span>, <span class="number">104</span>, <span class="number">117</span>, <span class="number">100</span>, <span class="number">111</span>, <span class="number">101</span>, <span class="number">110</span>,<span class="number">105</span>, <span class="number">129</span>, <span class="number">137</span>, <span class="number">112</span>, <span class="number">120</span>, <span class="number">113</span>, <span class="number">133</span>, <span class="number">112</span>,  <span class="number">83</span>,  <span class="number">94</span>, <span class="number">146</span>, <span class="number">133</span>, <span class="number">101</span>,<span class="number">131</span>, <span class="number">116</span>, <span class="number">111</span>,  <span class="number">84</span>, <span class="number">137</span>, <span class="number">115</span>, <span class="number">122</span>, <span class="number">106</span>, <span class="number">144</span>, <span class="number">109</span>, <span class="number">123</span>, <span class="number">116</span>, <span class="number">111</span>,<span class="number">111</span>, <span class="number">133</span>, <span class="number">150</span>]</span><br><span class="line">d=max(a)-min(a)</span><br><span class="line">print(d)<span class="comment">#我们算出极差是78，能被78整除的数有2，3...我们这里取3作为组距，并把x轴相邻坐标也设置为3的间距，与组距一致，方便观察</span></span><br><span class="line">num_bins=int(d/<span class="number">3</span>)<span class="comment">#组数</span></span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">120</span>)</span><br><span class="line">plt.hist(a,num_bins)<span class="comment">#生成直方图，传入组数</span></span><br><span class="line">plt.xticks(range(min(a),max(a)+<span class="number">3</span>,<span class="number">3</span>))</span><br><span class="line">plt.ylabel(<span class="string">'电影个数）'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'电影时长（分钟）'</span>)</span><br><span class="line">plt.grid()</span><br><span class="line">plt.savefig(<span class="string">'C:\\Users\\Administrator\\Desktop\\计算机学习note\\Matplotlib\\14.png'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" alt></p>
<p>如果我们想要不同组别的频率而不是频数，直接修改上述代码中的一行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.hist(a,num_bins,density&#x3D;True)#传入density&#x3D;True</span><br></pre></td></tr></table></figure>

<p>同时把y的标签改成电影频率：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.ylabel(&#39;电影频率&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt></p>
<p>一般来说plt.hist()的使用对象是没有进行统计过的数据。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekey0001covt7yku32cw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Matplotlib/" rel="tag">Matplotlib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mysql学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T14:57:45.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Mysql学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>结构化查询语言(<code>Structured Query Language</code>)简称 SQL. </p>
<p>SQL 是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统，同时也是数据库脚本文件的扩展名。</p>
<p>MySQL 是一个 DBMS（数据库管理系统）.</p>
<p>MySQL 是最流行的关系型数据库管理系统（关系数据库，是建立在关系数据库模型基础上的数据库，借助于集合代数等概念和方法来处理数据库中的数据）。</p>
<p>MySQL 使用 SQL 语言进行操作。</p>
<h1 id="在Linux中启动MySQL"><a href="#在Linux中启动MySQL" class="headerlink" title="在Linux中启动MySQL"></a>在Linux中启动MySQL</h1><h3 id="启动MySQL"><a href="#启动MySQL" class="headerlink" title="启动MySQL"></a>启动MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 启动 MySQL 服务</span><br><span class="line">sudo service mysql start             </span><br><span class="line"></span><br><span class="line"># 使用 root 用户登录，这里环境的密码为空，直接回车就可以登录</span><br><span class="line">mysql -u root</span><br></pre></td></tr></table></figure>

<h3 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a><strong>查看数据库</strong></h3><p>使用命令 <code>show databases;</code>，查看有哪些数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| hive               |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a><strong>连接数据库</strong></h3><p>选择连接其中一个数据库，语句格式为 <code>use &lt;数据库名&gt;</code>，这里可以不用加分号，这里我们选择 <code>information_schema</code> 数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema</span><br></pre></td></tr></table></figure>

<h3 id="查看表"><a href="#查看表" class="headerlink" title="查看表"></a>查看表</h3><p>使用命令 <code>show tables;</code> 查看此数据库中有哪些表（<strong>注意不要漏掉“;”</strong>）</p>
<h3 id="查看表内容"><a href="#查看表内容" class="headerlink" title="查看表内容"></a>查看表内容</h3><p> <code>SELECT * FROM 表名;</code></p>
<h3 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h3><p>使用命令 <code>quit</code> 或者 <code>exit</code> 退出 MySQL。</p>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>drop database 数据库名;</p>
<h3 id="新建数据库"><a href="#新建数据库" class="headerlink" title="新建数据库"></a>新建数据库</h3><p>我们创建一个数据库，给它一个名字，比如 <code>mysql_shiyan</code>，以后的几次实验也是对 <code>mysql_shiyan</code> 这个数据库进行操作。 语句格式为 <code>CREATE DATABASE &lt;数据库名字&gt;;</code>，（注意不要漏掉分号 <code>;</code>），前面的 CREATE DATABASE 也可以使用小写，具体命令为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE mysql_shiyan;</span><br></pre></td></tr></table></figure>



<p>SQL语句不分大小写。但是出于严谨，而且便于区分保留字（<strong><em>保留字(reserved word)：指在高级语言中已经定义过的字，使用者不能再将这些字作为变量名或过程名使用。\</em></strong>）和变量名，我们把保留字大写，把变量和数据小写。</p>
<p>建立此数据库后进入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql_shiyan;</span><br></pre></td></tr></table></figure>



<h4 id="建立表格"><a href="#建立表格" class="headerlink" title="建立表格"></a>建立表格</h4><p>在数据库中新建一张表的语句格式为：</p>
<p>CREATE TABLE 表的名字 </p>
<p>( </p>
<p>列名a 数据类型(数据长度), </p>
<p>列名b 数据类型(数据长度)， </p>
<p>列名c 数据类型(数据长度) </p>
<p>);</p>
<p>我们尝试在 <code>mysql_shiyan</code> 中新建一张表 <code>employee</code>，包含姓名，ID 和电话信息，所以语句为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee (id int(10),name char(20),phone int(12));</span><br></pre></td></tr></table></figure>

<p>然后再创建一张表 <code>department</code>，包含名称和电话信息</p>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><p>MySQL 的数据类型和其他编程语言大同小异。</p>
<p>整数除了 INT 外，还有 TINYINT、SMALLINT、MEDIUMINT、BIGINT。</p>
<p><strong>CHAR 和 VARCHAR 的区别:</strong> CHAR 的长度是固定的，而 VARCHAR 的长度是可以变化的，比如，存储字符串 “abc”，对于 CHAR(10)，表示存储的字符将占 10 个字节(包括 7 个空字符)，而同样的 VARCHAR(12) 则只占用4个字节的长度，<code>增加一个额外字节来存储字符串本身的长度</code>，12 只是最大值，当你存储的字符小于 12 时，按实际长度存储。</p>
<p><strong>ENUM和SET的区别:</strong> ENUM 类型的数据的值，必须是定义时枚举的值的其中之一，即单选，而 SET 类型的值则可以多选。</p>
<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><p>刚才我们新建了两张表，使用语句 <code>SELECT * FROM employee;</code> 查看表中的内容，可以看到 employee 表中现在还是空的。</p>
<p>我们通过 INSERT 语句向表中插入数据，语句格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表的名字(列名a,列名b,列名c) VALUES(值1,值2,值3);</span><br></pre></td></tr></table></figure>

<p>我们尝试向 employee 中加入 Tom、Jack 和 Rose：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO employee(id,name,phone) VALUES(01,&#39;TOM&#39;,110110110);</span><br><span class="line">INSERT INTO employee Values(02,&#39;Jack&#39;,119119119);</span><br><span class="line">INSERT INTO employee(id,name) VALUES(03,&#39;Rose&#39;);</span><br></pre></td></tr></table></figure>

<p>现在我们再次使用语句 <code>SELECT * FROM employee;</code> 查看 employee 表，可见 Tom 和 Jack 的相关数据已经保存在其中了：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt></p>
<h2 id="SQL的约束"><a href="#SQL的约束" class="headerlink" title="SQL的约束"></a>SQL的约束</h2><h3 id="主键-PRIMARY-KEY"><a href="#主键-PRIMARY-KEY" class="headerlink" title="主键 (PRIMARY KEY)"></a>主键 (PRIMARY KEY)</h3><p>主键 (PRIMARY KEY)是用于约束表中的一行，作为这一行的唯一标识符，在一张表中通过主键就能准确定位到一行，因此主键十分重要，主键不能有重复记录且不能为空。</p>
<p>PRIMARY KEY(a) </p>
<p>还有一种特殊的主键——复合主键。主键不仅可以是表中的一列，也可以由表中的两列或多列来共同标识，</p>
<p>PRIMARY KEY(a，b) </p>
<h3 id="默认值约束-DEFAULT"><a href="#默认值约束-DEFAULT" class="headerlink" title="默认值约束 (DEFAULT)"></a>默认值约束 (DEFAULT)</h3><p>默认值约束 (DEFAULT)规定，当有 DEFAULT 约束的列，插入数据为空时，将使用默认值。</p>
<p>默认值常用于一些可有可无的字段，比如用户的个性签名，如果用户没有设置，系统给他应该设定一个默认的文本，比如空文本或 ‘这个人太懒了，没有留下任何信息’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people_num INT(10) DEFAULT 10,</span><br></pre></td></tr></table></figure>

<h3 id="唯一约束-UNIQUE"><a href="#唯一约束-UNIQUE" class="headerlink" title="唯一约束 (UNIQUE)"></a>唯一约束 (UNIQUE)</h3><p>唯一约束 (UNIQUE) 比较简单，它规定一张表中指定的一列的值必须不能有重复值，即这一列每个值都是唯一的。</p>
<p>UNIQUE(a)</p>
<h3 id="外键-FOREIGN-KEY"><a href="#外键-FOREIGN-KEY" class="headerlink" title="外键 (FOREIGN KEY)"></a>外键 (FOREIGN KEY)</h3><p>外键 (FOREIGN KEY) 既能确保数据完整性，也能表现表之间的关系。</p>
<p>比如，现在有用户表和文章表，给文章表中添加一个指向用户 id 的外键，表示这篇文章所属的用户 id，外键将确保这个外键指向的记录是存在的，如果你尝试删除一个用户，而这个用户还有文章存在于数据库中，那么操作将无法完成并报错。因为你删除了该用户过后，他发布的文章都没有所属用户了，而这样的情况是不被允许的。同理，你在创建一篇文章的时候也不能为它指定一个不存在的用户 id。</p>
<p>一个表可以有多个外键，每个外键必须 REFERENCES (参考) 另一个表的主键，被外键约束的列，取值必须在它参考的列中有对应值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOREIGN KEY(sid) REFERENCES student(sid)</span><br></pre></td></tr></table></figure>

<h3 id="非空约束-NOT-NULL"><a href="#非空约束-NOT-NULL" class="headerlink" title="非空约束 (NOT NULL)"></a>非空约束 (NOT NULL)</h3><p>非空约束 (NOT NULL),听名字就能理解，被非空约束的列，在插入值时必须非空。</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt></p>
<h2 id="SELECT语句详解"><a href="#SELECT语句详解" class="headerlink" title="SELECT语句详解"></a>SELECT语句详解</h2><h3 id="3-1-基本的SELECT语句"><a href="#3-1-基本的SELECT语句" class="headerlink" title="3.1 基本的SELECT语句"></a>3.1 基本的SELECT语句</h3><p>SELECT 语句的基本格式为：</p>
<p>SELECT 要查询的列名 FROM 表名字 WHERE 限制条件;</p>
<p>如果要查询表的所有内容，则把 <strong>要查询的列名</strong> 用一个星号 <code>*</code> 号表示，代表要查询表中所有的列。 而大多数情况，我们只需要查看某个表的指定的列，比如要查看 employee 表的 name 和 age：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age FROM employee;</span><br></pre></td></tr></table></figure>

<p>选择age列并去重：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT age FROM employee;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-数学符号条件"><a href="#3-2-数学符号条件" class="headerlink" title="3.2 数学符号条件"></a>3.2 数学符号条件</h3><p>SELECT 语句常常会有 WHERE 限制条件，用于达到更加精确的查询。WHERE限制条件可以有数学符号 (<code>=,&lt;,&gt;,&gt;=,&lt;=</code>) ，刚才我们查询了 name 和 age，现在稍作修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age FROM employee WHERE age&gt;25;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-“AND”与“OR”"><a href="#3-3-“AND”与“OR”" class="headerlink" title="3.3 “AND”与“OR”"></a>3.3 “AND”与“OR”</h3><p>从这两个单词就能够理解它们的作用。WHERE 后面可以有不止一条限制，而根据条件之间的逻辑关系，可以用 [<code>条件一 OR 条件二]</code>] 和 [<code>条件一 AND 条件二</code>] 连接：</p>
<p>例如，筛选出 age 小于 25，或 age 大于 30</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age FROM employee WHERE age&lt;25 OR age&gt;30;</span><br></pre></td></tr></table></figure>

<p>如果需要包含25和30这两个数字的话，可以替换为 <strong>age BETWEEN 25 AND 30</strong> </p>
<h3 id="3-4-IN-和-NOT-IN"><a href="#3-4-IN-和-NOT-IN" class="headerlink" title="3.4 IN 和 NOT IN"></a>3.4 IN 和 NOT IN</h3><p>关键词 <strong>IN</strong> 和 <strong>NOT IN</strong> 的作用和它们的名字一样明显，用于筛选<strong>“在”</strong>或<strong>“不在”</strong>某个范围内的结果（作用于字符格式的列），比如说我们要查询在 <strong>dpt3</strong> 或 <strong>dpt4</strong> 的人:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age,phone,in_dpt FROM employee WHERE in_dpt IN (&#39;dpt3&#39;,&#39;dpt4&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt></p>
<h3 id="3-5-通配符"><a href="#3-5-通配符" class="headerlink" title="3.5 通配符"></a>3.5 通配符</h3><p>关键字 <strong>LIKE</strong> 可用于实现模糊查询，常见于搜索功能中。</p>
<p>和 LIKE 联用的通常还有通配符，代表未知字符。SQL中的通配符是 <code>_</code> 和 <code>%</code> 。其中 <code>_</code> 代表一个未指定字符，<code>%</code> 代表<strong>不定个</strong>未指定字符</p>
<p>比如，要只记得电话号码前四位数为1101，而后两位忘记了，则可以用两个 <code>_</code> 通配符代替：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age,phone FROM employee WHERE phone LIKE &#39;1101__&#39;;</span><br></pre></td></tr></table></figure>

<p>这样就查找出了 <strong>1101开头的6位数电话号码</strong>：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt></p>
<p>另一种情况，比如只记名字的首字母，又不知道名字长度，则用 <code>%</code> 通配符代替不定个字符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age,phone FROM employee WHERE name LIKE &#39;J%&#39;;</span><br></pre></td></tr></table></figure>

<p>这样就查找出了首字母为 <strong>J</strong> 的人：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<p><strong>%J%</strong> : 表示查询包含J的所有内容。</p>
<h3 id="3-6-对结果排序"><a href="#3-6-对结果排序" class="headerlink" title="3.6 对结果排序"></a>3.6 对结果排序</h3><p>为了使查询结果看起来更顺眼，我们可能需要对结果按某一列来排序，这就要用到 <strong>ORDER BY</strong> 排序关键词。默认情况下，<strong>ORDER BY</strong> 的结果是<strong>升序</strong>排列，而使用关键词 <strong>ASC</strong> 和 <strong>DESC</strong> 可指定<strong>升序</strong>或<strong>降序</strong>排序。 比如，我们<strong>按 salary 降序排列</strong>，SQL语句为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,age,salary,phone FROM employee ORDER BY salary DESC;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt></p>
<h3 id="3-7-SQL-内置函数和计算"><a href="#3-7-SQL-内置函数和计算" class="headerlink" title="3.7 SQL 内置函数和计算"></a>3.7 SQL 内置函数和计算</h3><p>SQL 允许对表中的数据进行计算。对此，SQL 有 5 个内置函数，这些函数都对 SELECT 的结果做操作：</p>
<table>
<thead>
<tr>
<th>函数名：</th>
<th>COUNT</th>
<th>SUM</th>
<th>AVG</th>
<th>MAX</th>
<th>MIN</th>
</tr>
</thead>
<tbody><tr>
<td>作用：</td>
<td>计数</td>
<td>求和</td>
<td>求平均值</td>
<td>最大值</td>
<td>最小值</td>
</tr>
</tbody></table>
<blockquote>
<p>其中 COUNT 函数可用于任何数据类型(因为它只是计数)，而 SUM 、AVG 函数都只能对数字类数据类型做计算，MAX 和 MIN 可用于数值、字符串或是日期时间数据类型。</p>
</blockquote>
<p>具体举例，比如计算出 salary 的最大、最小值，用这样的一条语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(salary) AS max_salary,MIN(salary) FROM employee;</span><br></pre></td></tr></table></figure>

<p><strong>这里使用 AS 关键词可以给值重命名</strong>，比如最大值被命名为了 max_salary：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt></p>
<h3 id="3-8-子查询"><a href="#3-8-子查询" class="headerlink" title="3.8 子查询"></a>3.8 子查询</h3><p>上面讨论的 SELECT 语句都仅涉及一个表中的数据，然而有时必须处理多个表才能获得所需的信息。例如：想要知道名为 “Tom” 的员工所在部门做了几个工程。员工信息储存在 employee 表中，但工程信息储存在 project 表中。</p>
<p>对于这样的情况，我们可以用子查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT of_dpt,COUNT(proj_name) AS count_project FROM project GROUP BY of_dpt</span><br><span class="line">HAVING of_dpt IN</span><br><span class="line">(SELECT in_dpt FROM employee WHERE name&#x3D;&#39;Tom&#39;);</span><br></pre></td></tr></table></figure>

<p>上面代码包含两个 SELECT 语句，第二个 SELECT 语句将返回一个集合的数据形式，然后被第一个 SELECT 语句用 <strong>in</strong> 进行判断。</p>
<p>GROUP BY 子句将查询结果按某一列或多列的值分组，值相等的为一组。后常跟having短语是为了指定筛选条件，即从Group <a href="https://www.baidu.com/s?wd=by&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">by</a>所分出来的分组结果中进行筛选，则having后面可以加条件。</p>
<h3 id="3-9-连接查询"><a href="#3-9-连接查询" class="headerlink" title="3.9 连接查询"></a>3.9 连接查询</h3><p>mysql&gt; SELECT * FROM project;<br>+———-+———–+————+————+——–+<br>| proj_num | proj_name | start_date | end_date   | of_dpt |<br>+———-+———–+————+————+——–+<br>|        1 | proj_a    | 2015-01-15 | 2015-01-31 | dpt2   |<br>|        2 | proj_b    | 2015-01-15 | 2015-02-15 | dpt1   |<br>|        3 | proj_c    | 2015-02-01 | 2015-03-01 | dpt4   |<br>|        4 | proj_d    | 2015-02-15 | 2015-04-01 | dpt3   |<br>|        5 | proj_e    | 2015-02-25 | 2015-03-01 | dpt4   |<br>|        6 | proj_f    | 2015-02-26 | 2015-03-01 | dpt2   |<br>+———-+———–+————+————+——–+<br>6 rows in set (0.01 sec)</p>
<p>mysql&gt; SELECT * FROM employee;<br>+—-+——+——+——–+——–+——–+<br>| id | name | age  | salary | phone  | in_dpt |<br>+—-+——+——+——–+——–+——–+<br>|  1 | Tom  |   26 |   2500 | 119119 | dpt4   |<br>|  2 | Jack |   24 |   2500 | 120120 | dpt2   |<br>|  3 | Rose |   22 |   2800 | 114114 | dpt3   |<br>|  4 | Jim  |   35 |   3000 | 100861 | dpt1   |<br>|  5 | Mary |   21 |   3000 | 100101 | dpt2   |<br>|  6 | Alex |   26 |   3000 | 123456 | dpt1   |<br>|  7 | Ken  |   27 |   3500 | 654321 | dpt1   |<br>|  8 | Rick |   24 |   3500 | 987654 | dpt3   |<br>|  9 | Joe  |   31 |   3600 | 110129 | dpt2   |<br>| 10 | Mike |   23 |   3400 | 110110 | dpt4   |<br>| 11 | Jobs | NULL |   3600 |  19283 | dpt2   |<br>| 12 | Tony | NULL |   3400 | 102938 | dpt3   |<br>+—-+——+——+——–+——–+——–+<br>12 rows in set (0.00 sec)</p>
<p>mysql&gt; SELECT * FROM department;<br>+———-+————+<br>| dpt_name | people_num |<br>+———-+————+<br>| dpt1     |         11 |<br>| dpt2     |         12 |<br>| dpt3     |         10 |<br>| dpt4     |         15 |<br>+———-+————+<br>4 rows in set (0.01 sec)</p>
<p>在处理多个表时，子查询只有在结果来自一个表时才有用。但如果需要显示两个表或多个表中的数据，这时就必须使用连接 <strong>(join)</strong> 操作。 连接的基本思想是把两个或多个表当作一个新的表来操作，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,people_num</span><br><span class="line">FROM employee,department</span><br><span class="line">WHERE employee.in_dpt = department.dpt_name</span><br><span class="line">ORDER BY id;</span><br></pre></td></tr></table></figure>

<p>这条语句查询出的是，各员工所在部门的人数，其中员工的 id 和 name 来自 employee 表，people_num 来自 department 表：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" alt></p>
<p>另一个连接语句格式是使用 JOIN ON 语法，刚才的语句等同于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,people_num</span><br><span class="line">FROM employee JOIN department</span><br><span class="line">ON employee.in_dpt &#x3D; department.dpt_name</span><br><span class="line">ORDER BY id;</span><br></pre></td></tr></table></figure>

<h2 id="数据库及表的修改和删除"><a href="#数据库及表的修改和删除" class="headerlink" title="数据库及表的修改和删除"></a>数据库及表的修改和删除</h2><h3 id="3-1关于修改数据库名"><a href="#3-1关于修改数据库名" class="headerlink" title="3.1关于修改数据库名"></a>3.1关于修改数据库名</h3><p>目前 Mysql 没有提供修改数据库名称的方法，因为这曾导致一系列安全问题。</p>
<p>在老版本中 RENAME DATABASE 可以修改数据库名称，这条命令在 MySQL 5.1.7 中被加入，但官方很快就发现这条命令所带来的危险，于是在 MySQL 5.1.23 中把这条命令移除。</p>
<p>事实上，数据库名几乎不会遇到必须修改的情况，如果你一定要这么做，比较安全的做法是重新建一个新库，然后将旧库中的数据转移到新库中，并且暂时不要删除旧的数据库，以防数据遗失。</p>
<h3 id="3-2-对一张表的修改"><a href="#3-2-对一张表的修改" class="headerlink" title="3.2 对一张表的修改"></a>3.2 对一张表的修改</h3><h4 id="3-2-1表格重命名"><a href="#3-2-1表格重命名" class="headerlink" title="3.2.1表格重命名"></a>3.2.1表格重命名</h4><p>重命名一张表的语句有多种形式，以下 3 种格式效果是一样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE 原名 TO 新名字;</span><br><span class="line"></span><br><span class="line">ALTER TABLE 原名 RENAME 新名;</span><br><span class="line"></span><br><span class="line">ALTER TABLE 原名 RENAME TO 新名;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-删除一张表"><a href="#3-2-2-删除一张表" class="headerlink" title="3.2.2 删除一张表"></a>3.2.2 删除一张表</h4><p>删除一张表的语句，类似于刚才用过的删除数据库的语句，格式是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE 表名字;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-对一列的修改-即对表结构的修改"><a href="#3-3-对一列的修改-即对表结构的修改" class="headerlink" title="3.3 对一列的修改(即对表结构的修改)"></a>3.3 对一列的修改(即对表结构的修改)</h3><h4 id="3-3-1-增加一列"><a href="#3-3-1-增加一列" class="headerlink" title="3.3.1 增加一列"></a>3.3.1 增加一列</h4><p>在表中增加一列的语句格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名字 ADD COLUMN 列名字 数据类型 约束;</span><br><span class="line">或：</span><br><span class="line">ALTER TABLE 表名字 ADD 列名字 数据类型 约束;</span><br></pre></td></tr></table></figure>

<p>现在 employee 表中有 <code>id、name、age、salary、phone、in_dpt</code> 这6个列，我们尝试加入 <code>height</code> (身高)一个列并指定DEFAULT 约束：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee ADD height INT(4) DEFAULT 170;</span><br></pre></td></tr></table></figure>

<p>可以发现：新增加的列，被默认放置在这张表的最右边。如果要把增加的列插入在指定位置，则需要在语句的最后使用AFTER关键词(<strong>“AFTER 列1” 表示新增的列被放置在 “列1” 的后面</strong>)。</p>
<blockquote>
<p>提醒：语句中的 INT(4) 不是表示整数的字节数，而是表示该值的显示宽度，如果设置填充字符为 0，则 170 显示为 0170</p>
</blockquote>
<p>比如我们新增一列 <code>weight</code>(体重) 放置在 <code>age</code>(年龄) 的后面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee ADD weight INT(4) DEFAULT 120 AFTER age;</span><br></pre></td></tr></table></figure>

<p>上面的效果是把新增的列加在某位置的后面，如果想放在第一列的位置，则使用 <code>FIRST</code> 关键词，如语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee ADD test INT(10) DEFAULT 11 FIRST;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-删除一列"><a href="#3-3-2-删除一列" class="headerlink" title="3.3.2 删除一列"></a>3.3.2 删除一列</h4><p>删除表中的一列和刚才使用的新增一列的语句格式十分相似，只是把关键词 <code>ADD</code> 改为 <code>DROP</code> ，语句后面不需要有数据类型、约束或位置信息。具体语句格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名字 DROP COLUMN 列名字;</span><br><span class="line"></span><br><span class="line">或： ALTER TABLE 表名字 DROP 列名字;</span><br></pre></td></tr></table></figure>

<p>我们把刚才新增的 <code>test</code> 删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee DROP test;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-重命名一列"><a href="#3-3-3-重命名一列" class="headerlink" title="3.3.3 重命名一列"></a>3.3.3 重命名一列</h4><p>这条语句其实不只可用于重命名一列，准确地说，它是对一个列做修改(CHANGE) ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名字 CHANGE 原列名 新列名 数据类型 约束;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：这条重命名语句后面的 “数据类型” 不能省略，否则重命名失败。</strong></p>
</blockquote>
<p>当<strong>原列名</strong>和<strong>新列名</strong>相同的时候，指定新的<strong>数据类型</strong>或<strong>约束</strong>，就可以用于修改数据类型或约束。需要注意的是，修改数据类型可能会导致数据丢失，所以要慎重使用。</p>
<p>我们用这条语句将 “height” 一列重命名为汉语拼音 “shengao” ，效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee CHANGE height shengao INT(4) DEFAULT 170;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-改变数据类型"><a href="#3-3-4-改变数据类型" class="headerlink" title="3.3.4 改变数据类型"></a>3.3.4 改变数据类型</h4><p>要修改一列的数据类型，除了使用刚才的 <strong>CHANGE</strong> 语句外，还可以用这样的 <strong>MODIFY</strong> 语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名字 MODIFY 列名字 新数据类型;</span><br></pre></td></tr></table></figure>

<p>再次提醒，修改数据类型必须小心，因为这可能会导致数据丢失。在尝试修改数据类型之前，请慎重考虑。</p>
<h3 id="3-4-对表的内容修改"><a href="#3-4-对表的内容修改" class="headerlink" title="3.4 对表的内容修改"></a>3.4 对表的内容修改</h3><h4 id="3-4-1-修改表中某个值"><a href="#3-4-1-修改表中某个值" class="headerlink" title="3.4.1 修改表中某个值"></a>3.4.1 修改表中某个值</h4><p>大多数时候我们需要做修改的不会是整个数据库或整张表，而是表中的某一个或几个数据，这就需要我们用下面这条命令达到精确的修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名字 SET 列1&#x3D;值1,列2&#x3D;值2 WHERE 条件;</span><br></pre></td></tr></table></figure>

<p>比如，我们要把 Tom 的 age 改为 21，salary 改为 3000：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE employee SET age&#x3D;21,salary&#x3D;3000 WHERE name&#x3D;&#39;Tom&#39;;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-删除一行记录"><a href="#3-4-2-删除一行记录" class="headerlink" title="3.4.2 删除一行记录"></a>3.4.2 删除一行记录</h4><p>删除表中的一行数据，也必须加上 WHERE 条件，否则整列的数据都会被删除。删除语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM 表名字 WHERE 条件;</span><br></pre></td></tr></table></figure>

<p>我们尝试把 Tom 的数据删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM employee WHERE name&#x3D;&#39;Tom&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="其他基本操作"><a href="#其他基本操作" class="headerlink" title="其他基本操作"></a>其他基本操作</h2><h3 id="3-1-索引"><a href="#3-1-索引" class="headerlink" title="3.1 索引"></a>3.1 索引</h3><p>索引是一种与表有关的结构，它的作用相当于书的目录，可以根据目录中的页码快速找到所需的内容。</p>
<p>当表中有大量记录时，若要对表进行查询，没有索引的情况是全表搜索：将所有记录一一取出，和查询条件进行对比，然后返回满足条件的记录。这样做会执行大量磁盘 I/O 操作，并花费大量数据库系统时间。</p>
<p>而如果在表中已建立索引，在索引中找到符合查询条件的索引值，通过索引值就可以快速找到表中的数据，可以<strong>大大加快查询速度</strong>。</p>
<p>对一张表中的某个列建立索引，有以下两种语句格式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名字 ADD INDEX 索引名 (列名);</span><br><span class="line"></span><br><span class="line">CREATE INDEX 索引名 ON 表名字 (列名);</span><br></pre></td></tr></table></figure>

<p>我们用这两种语句分别建立索引：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee ADD INDEX idx_id (id);  #在employee表的id列上建立名为idx_id的索引</span><br><span class="line"></span><br><span class="line">CREATE INDEX idx_name ON employee (name);   #在employee表的name列上建立名为idx_name的索引</span><br></pre></td></tr></table></figure>

<p>索引的效果是加快查询速度，当表中数据不够多的时候是感受不出它的效果的。这里我们使用命令 <strong>SHOW INDEX FROM 表名字;</strong> 查看刚才新建的索引：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" alt></p>
<p>在使用 SELECT 语句查询的时候，语句中 WHERE 里面的条件，会<strong>自动判断有没有可用的索引</strong>。</p>
<p>一些字段不适合创建索引，比如性别，这个字段存在大量的重复记录无法享受索引带来的速度加成，甚至会拖累数据库，导致数据冗余和额外的 CPU 开销。</p>
<h3 id="3-2-视图"><a href="#3-2-视图" class="headerlink" title="3.2 视图"></a>3.2 视图</h3><p>视图是从一个或多个表中导出来的表，是一种<strong>虚拟存在的表</strong>。它就像一个窗口，通过这个窗口可以看到系统专门提供的数据，这样，用户可以不用看到整个数据库中的数据，而只关心对自己有用的数据。</p>
<p>注意理解视图是虚拟的表：</p>
<ul>
<li>数据库中只存放了视图的定义，而没有存放视图中的数据，这些数据存放在原来的表中；</li>
<li>使用视图查询数据时，数据库系统会从原来的表中取出对应的数据；</li>
<li>视图中的数据依赖于原来表中的数据，一旦表中数据发生改变，显示在视图中的数据也会发生改变；</li>
<li>在使用视图的时候，可以把它当作一张表。</li>
</ul>
<p>创建视图的语句格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW 视图名(列a,列b,列c) AS SELECT 列1,列2,列3 FROM 表名字;</span><br></pre></td></tr></table></figure>

<p>可见创建视图的语句，后半句是一个 SELECT 查询语句，所以<strong>视图也可以建立在多张表上</strong>，只需在 SELECT 语句中使用<strong>子查询</strong>或连接查询。</p>
<p>现在我们创建一个简单的视图，名为 <strong>v_emp</strong>，包含<strong>v_name</strong>，<strong>v_age</strong>，<strong>v_phone</strong>三个列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW v_emp (v_name,v_age,v_phone) AS SELECT name,age,phone FROM employee;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt></p>
<h3 id="3-3-导入"><a href="#3-3-导入" class="headerlink" title="3.3 导入"></a>3.3 导入</h3><p>此处讲解的是导入一个纯数据文件，该文件中将包含与数据表字段相对应的多条数据，这样可以快速导入大量数据，除此之外，还有用 SQL 语句的导入方式，语法为：<code>source *.sql</code> 这是实验中经常用到的。两者之间的不同是：数据文件导入方式只包含数据，导入规则由数据库系统完成；SQL 文件导入相当于执行该文件中包含的 SQL 语句，可以实现多种操作，包括删除，更新，新增，甚至对数据库的重建。</p>
<p>数据文件导入，可以把一个文件里的数据保存进一张表。导入语句格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE &#39;文件路径和文件名&#39; INTO TABLE 表名字;</span><br></pre></td></tr></table></figure>

<p>现在 SQL6 目录下有一个名为 <strong>in.txt</strong> 的文件，我们尝试把这个文件中的数据导入数据库 <strong>mysql_shiyan</strong> 的 <strong>employee</strong> 表中。</p>
<p>由于导入导出大量数据都属于敏感操作，根据 mysql 的安全策略，导入导出的文件都必须在指定的路径下进行，在 mysql 终端中查看路径变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">'%secure%'</span>;</span></span><br><span class="line">+--------------------------+-----------------------+</span><br><span class="line">| Variable_name            | Value                 |</span><br><span class="line">+--------------------------+-----------------------+</span><br><span class="line">| require_secure_transport | OFF                   |</span><br><span class="line">| secure_auth              | ON                    |</span><br><span class="line">| secure_file_priv         | /var/lib/mysql-files/ |</span><br><span class="line">+--------------------------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>注意到 secure_file_priv 变量指定安全路径为 <code>/var/lib/mysql-files/</code> ，要导入数据文件，需要将该文件移动到安全路径下。</p>
<p>打开 Xfce 终端，输入命令拷贝 SQL6 文件夹到 <code>/var/lib/mysql-files/</code> 目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -a &#x2F;home&#x2F;shiyanlou&#x2F;Desktop&#x2F;SQL6 &#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;</span><br></pre></td></tr></table></figure>

<p>使用命令 <code>sudo vim /var/lib/mysql-files/SQL6/in.txt</code> 查看 <code>in.txt</code> 文件中的内容：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<p>可以看到其中仅仅包含了数据本身，没有任何的 SQL 语句</p>
<p>再使用以下命令以 root 用户登录数据库，再连接 <strong>mysql_shiyan</strong> 数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在Xfce 终端输入命令</span></span><br><span class="line">mysql -u root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 MySQL 控制台中输入命令</span></span><br><span class="line">use mysql_shiyan</span><br></pre></td></tr></table></figure>

<p>查看一下没有导入数据之前，employee 表中的数据：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<p>现在执行导入语句，文件中的数据成功导入 employee 表：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" alt></p>
<h3 id="3-4-导出"><a href="#3-4-导出" class="headerlink" title="3.4 导出"></a>3.4 导出</h3><p>导出与导入是相反的过程，是把数据库某个表中的数据保存到一个文件之中。导出语句基本格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列1，列2 INTO OUTFILE &#39;文件路径和文件名&#39; FROM 表名字;</span><br></pre></td></tr></table></figure>

<p><strong>注意：语句中 “文件路径” 之下不能已经有同名文件。</strong></p>
<p>现在我们把整个 employee 表的数据导出到 /var/lib/mysql-files/ 目录下，导出文件命名为 <strong>out.txt</strong> 具体语句为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * INTO OUTFILE &#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;out.txt&#39; FROM employee;</span><br></pre></td></tr></table></figure>

<p>用 gedit 可以查看导出文件 <code>/var/lib/mysql-files/out.txt</code> 的内容：</p>
<blockquote>
<p>也可以使用 <code>sudo cat /var/lib/mysql-files/out.txt</code> 命令查看。</p>
</blockquote>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" alt></p>
<h3 id="3-5-备份"><a href="#3-5-备份" class="headerlink" title="3.5 备份"></a>3.5 备份</h3><p>数据库中的数据十分重要，出于安全性考虑，在数据库的使用中，应该注意使用备份功能。</p>
<blockquote>
<p>备份与导出的区别：导出的文件只是保存数据库中的数据；而备份，则是把数据库的结构，包括数据、约束、索引、视图等全部另存为一个文件。</p>
</blockquote>
<p><strong>mysqldump</strong> 是 MySQL 用于备份数据库的实用程序。它主要产生一个 SQL 脚本文件，其中包含从头重新创建数据库所必需的命令 CREATE TABLE INSERT 等。</p>
<p>使用 mysqldump 备份的语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root 数据库名&gt;备份文件名;   #备份整个数据库</span><br><span class="line"></span><br><span class="line">mysqldump -u root 数据库名 表名字&gt;备份文件名;  #备份整个表</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mysqldump 是一个备份工具，因此该命令是在终端中执行的，而不是在 mysql 交互环境下</p>
</blockquote>
<p>我们尝试备份整个数据库 <code>mysql_shiyan</code>，将备份文件命名为 <code>bak.sql</code>，先 <code>Ctrl+D</code> 退出 MySQL 控制台，再打开 Xfce 终端，在终端中输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;shiyanlou&#x2F;</span><br><span class="line">mysqldump -u root mysql_shiyan &gt; bak.sql;</span><br></pre></td></tr></table></figure>

<p>使用命令 “ls” 可见已经生成备份文件 <code>bak.sql</code>：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt></p>
<p>3.6 恢复</p>
<p>用备份文件恢复数据库。在本次实验的开始，我们使用过这样一条命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;tmp&#x2F;SQL6&#x2F;MySQL-06.sql</span><br></pre></td></tr></table></figure>

<p>这就是一条恢复语句，它把 MySQL-06.sql 文件中保存的<code>mysql_shiyan</code> 数据库恢复。</p>
<p>还有另一种方式恢复数据库，但是在这之前我们先使用命令新建一个<strong>空的数据库 test</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root          #因为在上一步已经退出了MySQL，现在需要重新登录</span><br><span class="line"></span><br><span class="line">CREATE DATABASE test;  #新建一个名为test的数据库</span><br></pre></td></tr></table></figure>

<p>再次 <strong>Ctrl+D</strong> 退出 MySQL，然后输入语句进行恢复，把刚才备份的 <strong>bak.sql</strong> 恢复到 <strong>test</strong> 数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root test &lt; bak.sql</span><br></pre></td></tr></table></figure>

<p>我们输入命令查看 test 数据库的表，便可验证是否恢复成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root          #因为在上一步已经退出了MySQL，现在需要重新登录</span><br><span class="line"></span><br><span class="line">use test               #连接数据库test</span><br><span class="line"></span><br><span class="line">SHOW TABLES;           #查看test数据库的表</span><br></pre></td></tr></table></figure>

<p>可以看见原数据库的4张表和1个视图，现在已经恢复到 test 数据库中：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" alt></p>
<p>再查看 employee 表的恢复情况：</p>
<p><img src="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" alt></p>
<h1 id="用python操作数据库"><a href="#用python操作数据库" class="headerlink" title="用python操作数据库"></a>用python操作数据库</h1><p>与linux不同，python执行sql语句要先建立一个游标cursor。在execute()中执行sql语句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment">#连接mysql</span></span><br><span class="line">db=pymysql.connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'12345689'</span>) </span><br><span class="line"><span class="comment">#使用cursor()方法获取操作游标 </span></span><br><span class="line">cursor=db.cursor()</span><br><span class="line"><span class="comment">#使用execute方法执行SQL语句,连接testdb数据库</span></span><br><span class="line">cursor.execute(<span class="string">'use testdb'</span>)</span><br><span class="line"><span class="comment">#也可以在前面写db=pymysql.connect('localhost','root','12345689','testdb')时就连接testdb数据库。</span></span><br><span class="line"><span class="comment">#在testdb数据库中创建一个表</span></span><br><span class="line">sql=<span class="string">'create table employee(first_name varchar(20),last_name varchar(20),age INT(3),sex varchar(8),income int(20))'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment">#db.commit()网上解释在修改数据时需要加这句代码，才会提交到数据库执行。但实操时发现不加这句代码也可以。</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback() <span class="comment">#如果执行中发生错误，则撤销这步操作</span></span><br><span class="line"><span class="comment">#在查看数据库时，要先选择，再抓取。</span></span><br><span class="line">cursor.execute(<span class="string">'select * from employee'</span>)</span><br><span class="line">print(cursor.fetchall()) <span class="comment">#还有个fetchone()</span></span><br><span class="line"><span class="comment">#关闭数据库连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekf00002covth8gw90st" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Numpy学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T14:54:26.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BA%93/">数据分析库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Numpy学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h2 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h2><p><img src="/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE1.jpg" alt></p>
<p><img src="/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE2.jpg" alt></p>
<h2 id="Numpy读取数据"><a href="#Numpy读取数据" class="headerlink" title="Numpy读取数据"></a>Numpy读取数据</h2><p><img src="/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE.jpg" alt></p>
<h2 id="numpy创建数组（矩阵），调整数据类型"><a href="#numpy创建数组（矩阵），调整数据类型" class="headerlink" title="numpy创建数组（矩阵），调整数据类型"></a>numpy创建数组（矩阵），调整数据类型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment">#用numpy生成数组，得到ndarray的类型</span></span><br><span class="line">a=np.arange(<span class="number">10</span>)</span><br><span class="line">b=np.array(range(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">print</span> (type(a))<span class="comment"># Out： &lt;class 'numpy.ndarray'&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#numpy中的数据类型</span></span><br><span class="line">print(a.dtype)<span class="comment">#输出a的数据类型，Out：int32</span></span><br><span class="line">b=np.array(range(<span class="number">8</span>),dtype=<span class="string">'float'</span>)<span class="comment">#我们可以自行设置数组的数据类型，如int,int32,float,float64...</span></span><br><span class="line">print(b.dtype) <span class="comment">#Out:float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#numpy中的bool类型</span></span><br><span class="line">c=np.array([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">0</span>],dtype=<span class="string">'bool'</span>)</span><br><span class="line">print(c) <span class="comment">#Out:[ True  True  True False]</span></span><br><span class="line">print(c.dtype) <span class="comment">#Out:bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调整数据类型</span></span><br><span class="line">d=c.astype(<span class="string">'float32'</span>)</span><br><span class="line">print(d)<span class="comment">#Out:[1. 1. 1. 0.] 因为c此时为bool型，变成浮点数型后就变成了1. ， 0. </span></span><br><span class="line"><span class="comment">#在np中，用random生成随机小数</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">e=np.array([random.random() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line"><span class="comment">#用round来取保留小数点后第几位</span></span><br><span class="line">round(random.random(),<span class="number">2</span>)<span class="comment">#在Python中用round，这里保留小数点后两位</span></span><br><span class="line">np.round(e,<span class="number">3</span>)<span class="comment">#在numpy中用round，这里保留小数点后三位</span></span><br></pre></td></tr></table></figure>

<h2 id="数组的形状及修改"><a href="#数组的形状及修改" class="headerlink" title="数组的形状及修改"></a>数组的形状及修改</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">b=np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>],[<span class="number">5</span>,<span class="number">6</span>]])</span><br><span class="line">print(b.shape)<span class="comment">#三行两列，Out:(3, 2)</span></span><br><span class="line">c=np.array([[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]],[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]]])</span><br><span class="line">print(c.shape)<span class="comment">#两块中的两行三列，Out:(2, 3, 2)</span></span><br><span class="line"><span class="comment">#修改数据的形状</span></span><br><span class="line">d=np.arange(<span class="number">12</span>)</span><br><span class="line">print(d.reshape(<span class="number">3</span>,<span class="number">4</span>))<span class="string">'''Out:                        [[ 0  1  2  3]</span></span><br><span class="line"><span class="string"> [ 4  5  6  7]</span></span><br><span class="line"><span class="string"> [ 8  9 10 11]]'''</span></span><br><span class="line">print(np.arange(<span class="number">24</span>).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))<span class="string">'''Out:</span></span><br><span class="line"><span class="string">[[[ 0,  1,  2,  3],</span></span><br><span class="line"><span class="string">        [ 4,  5,  6,  7],</span></span><br><span class="line"><span class="string">        [ 8,  9, 10, 11]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[12, 13, 14, 15],</span></span><br><span class="line"><span class="string">        [16, 17, 18, 19],</span></span><br><span class="line"><span class="string">        [20, 21, 22, 23]]]'''</span></span><br></pre></td></tr></table></figure>

<p>a.flatter() 指将a这个数组展开成一维。</p>
<h2 id="数组的操作"><a href="#数组的操作" class="headerlink" title="数组的操作"></a>数组的操作</h2><h3 id="数组与数的运算"><a href="#数组与数的运算" class="headerlink" title="数组与数的运算"></a>数组与数的运算</h3><p>数会作用于数组的每一位</p>
<h3 id="数组与数组的运算"><a href="#数组与数组的运算" class="headerlink" title="数组与数组的运算"></a>数组与数组的运算</h3><p>当两个数组形状完全相同时，运算就是对各自对应位置数的运算。</p>
<p>一个数组例如3行4列的可以与1行4列的数组或3行1列的数组进行运算。</p>
<h3 id="数组的转置"><a href="#数组的转置" class="headerlink" title="数组的转置"></a>数组的转置</h3><p>用a.T 或 a.transpose()</p>
<h3 id="数组的索引和切片"><a href="#数组的索引和切片" class="headerlink" title="数组的索引和切片"></a>数组的索引和切片</h3><p>a[1]或a[1,:]表示取数组a的第二行。</p>
<p>a[[0,2,4]]表示取数组a的第一行，第三行，第五行。</p>
<p>a[1:4,2:3]表示取从第二行到第四行，第三列到第四列的值。</p>
<p>a[0,0]表示取坐标为[0,0]的点。</p>
<p>a[[0,1],[2,3]]表示取坐标为[0,2],[1,3]的点。</p>
<h3 id="数组中值的替换（nan-inf）"><a href="#数组中值的替换（nan-inf）" class="headerlink" title="数组中值的替换（nan,inf）"></a>数组中值的替换（nan,inf）</h3><p>a[a&lt;3]=0 表示把数组a中比3小的值都替换为0</p>
<p>a[0,0]=np.nan表示把坐标为[0,0]的值替换为nan（not a number）,但要注意，由于nan是float型，因此要先把a（b=a.astype(‘float’）转化成float型再替换。</p>
<p>inf（float型）表示正无穷，-inf表示负无穷。（一个数/0就会出现这种情况）</p>
<p>nan在数据有缺失，或做了一个不合适的计算如无穷大减无穷大时，就会出现。</p>
<h4 id="nan的注意点"><a href="#nan的注意点" class="headerlink" title="nan的注意点"></a>nan的注意点</h4><p>1.两个nan并不相等。</p>
<p>2.np.nan不等于np.nan。</p>
<p>3.np.isnan(t) #判断t中哪些是nan，返回bool类型。</p>
<p>4.np.count_nanzero(np.isnan(t))#若输出结果为1，则说明t中有一个nan。</p>
<p>5.nan与任何值进行计算，结果都为nan。</p>
<p>6.一般在进行操作时不会直接把nan替换成0，因为这样会对数组造成影响，例如nan这一行或列的平均值会变化（之前的平均值不会把nan算在内）。所以更一般的方式是将nan替换成均值（中值）【先将nan给找出来，再算出nan这列的均值，赋给nan】，或者直接删除有nan的那行。</p>
<h3 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h3><p>np.where(a&lt;5,0,5) 表示把数组a中比5小的数都替换为0，其他都替换成5。此操作不会改变a，可以将此操作赋给别的变量。</p>
<h3 id="Numpy中的clip（裁剪）"><a href="#Numpy中的clip（裁剪）" class="headerlink" title="Numpy中的clip（裁剪）"></a>Numpy中的clip（裁剪）</h3><p>a.clip(5,10)表示把数组a中比5小的数都替换为5，把比10大的数都替换成10。</p>
<h3 id="数组的拼接"><a href="#数组的拼接" class="headerlink" title="数组的拼接"></a>数组的拼接</h3><p>np.vstack(a1,a2)#垂直拼接，上下拼接</p>
<p>np.hstack(t1,t2)#水平拼接，左右拼接</p>
<h3 id="数组的行列交换"><a href="#数组的行列交换" class="headerlink" title="数组的行列交换"></a>数组的行列交换</h3><p>a[[0,1],:]=a[[1,0],:] #将第一行与第二行交换</p>
<p>a[:,[0,1]]=a[:,[1,0]] #将第一列与第二列交换</p>
<h2 id="numpy的更多用法"><a href="#numpy的更多用法" class="headerlink" title="numpy的更多用法"></a>numpy的更多用法</h2><p>1.获取最大值最小值的位置</p>
<p>np.argmax(t,axis=0) 或者t.max(axis=0)#得出t这个数组每一列的最大值的位置，axis=0表示跨行</p>
<p>np.argmin(t,axis=1)或者t.min(axis=1)#得出t这个数组每一行的最小值的位置，axis=1表示跨列</p>
<p>2.创建一个全0的数组：np.zeros((3,4)) #三行四列</p>
<p>3.创建一个全1的数组：np.ones((3,4)) #三行四列</p>
<p>4.创建一个对角线为1的方阵：np.eye(5)#五行五列</p>
<p>5.np.count_nanzero(t)#t中非零数的个数</p>
<p>6.np.sum(t),   np.sum(t,axis=0)#把行加起来</p>
<p>7.t.mean(axis)#均值</p>
<p>8.np.median(t,axis)#中值</p>
<p>9.np.ptp(t,axis)#极差</p>
<p>10.t.std(axis)#标准差，值越大代表数据波动越大，越不稳定。</p>
<h2 id="python的一些常见用法"><a href="#python的一些常见用法" class="headerlink" title="python的一些常见用法"></a>python的一些常见用法</h2><p>1 t.tolist()#将t转化成列表。</p>
<p>2 .<em>split()</em> 通过指定分隔符对字符串进行切片。默认为以字符串中的空格来分。</p>
<p>3.<strong>set()</strong> 函数创建一个无序不重复元素集，可进行关系测试，删除重复数据，还可以计算交集、差集、并集等。</p>
<p>如     </p>
<p>set([‘boy’,’girl’,’kid’,’boy’])</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;boy&#39;, &#39;girl&#39;, &#39;kid&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>​        set(‘school’)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;c&#39;, &#39;h&#39;, &#39;l&#39;, &#39;o&#39;, &#39;s&#39;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="numpy生成随机数"><a href="#numpy生成随机数" class="headerlink" title="numpy生成随机数"></a>numpy生成随机数</h2><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">函数功能</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.rand(d0, d1, …, dn)</td>
<td align="left">产生均匀分布的随机数,浮点数，范围从0-1</td>
<td align="left">dn为第n维数据的维度</td>
</tr>
<tr>
<td align="left">.randn(d0, d1, …, dn)</td>
<td align="left">产生标准正态分布随机数，平均数0，标准差1</td>
<td align="left">dn为第n维数据的维度</td>
</tr>
<tr>
<td align="left">.randint(low, high, size, dtype])</td>
<td align="left">产生随机整数</td>
<td align="left">low：最小值；high：最大值；size：数据个数</td>
</tr>
<tr>
<td align="left">.random_sample([size])</td>
<td align="left">在[0,1）内产生随机数</td>
<td align="left">size：随机数的shape，可以为元祖或者列表，[2,3]表示2维随机数，维度为（2,3）</td>
</tr>
<tr>
<td align="left">.random([size])</td>
<td align="left">同random_sample([size])</td>
<td align="left">同random_sample([size])</td>
</tr>
<tr>
<td align="left">.ranf([size])</td>
<td align="left">同random_sample([size])</td>
<td align="left">同random_sample([size])</td>
</tr>
<tr>
<td align="left">.sample([size]))</td>
<td align="left">同random_sample([size])</td>
<td align="left">同random_sample([size])</td>
</tr>
<tr>
<td align="left">.choice(a[, size, replace, p])</td>
<td align="left">从a中随机选择指定数据</td>
<td align="left">a：1维数组 size：返回数据形状</td>
</tr>
<tr>
<td align="left">.bytes(length)</td>
<td align="left">返回随机位</td>
<td align="left">length：位的长度</td>
</tr>
</tbody></table>
<p>np.random.rand(2,4)#创建2行4列满足均匀分布的随机数。</p>
<p>np.random.seed(one number)#后面跟生成随机数的代码如np.random.rand（)，只能作用一次。（利用随机数种子，每次生成的随机数相同。）</p>
<p>numpy.random.uniform(low,high,size) #功能：从一个均匀分布[low,high)中随机采样，注意定义域是左闭右开，即包含low，不包含high.</p>
<p>np.random.uniform(0,1,(3,4))      <em># 产生3行4列个[0,1)的数</em></p>
<h2 id="numpy的注意点：copy和view"><a href="#numpy的注意点：copy和view" class="headerlink" title="numpy的注意点：copy和view"></a>numpy的注意点：copy和view</h2><p>1.a=b,完全不复制，a和b相互影响。</p>
<p>2.a=b.copy(),a和b互不影响。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekf50005covt7kog74tz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Pandas学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T14:51:48.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BA%93/">数据分析库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Pandas学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>numpy能够帮我们处理数值，但pandas除了处理数值之外（基于numpy),还能帮助我们处理其他类型如字符串，时间序列等。</p>
<p>pandas的常用数据类型：</p>
<p>1.Series一维，带标签数组。</p>
<p>2.DataFrame二维，Series容器。</p>
<h2 id="1-pandas的常用操作（Series）"><a href="#1-pandas的常用操作（Series）" class="headerlink" title="1.pandas的常用操作（Series）"></a>1.pandas的常用操作（Series）</h2><h3 id="pandas之series创建"><a href="#pandas之series创建" class="headerlink" title="pandas之series创建"></a>pandas之series创建</h3><h4 id="1-直接创建"><a href="#1-直接创建" class="headerlink" title="1.直接创建"></a>1.直接创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">t=pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">32</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">79</span>])<span class="comment">#创建Series一维，带标签数组。默认标签</span></span><br><span class="line"></span><br><span class="line">type(t)<span class="comment">#**pandas.core.series.Series**</span></span><br><span class="line"></span><br><span class="line">t2=pd.Series([<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">54</span>,<span class="number">6</span>],index=list(<span class="string">'abcde'</span>)) <span class="comment">#指定标签 </span></span><br><span class="line">a=t2.astype(<span class="string">'float'</span>)<span class="comment">#修改数据类型，与numpy操作一样</span></span><br></pre></td></tr></table></figure>



<h4 id="2-通过字典创建"><a href="#2-通过字典创建" class="headerlink" title="2.通过字典创建"></a>2.通过字典创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">temp_dict=&#123;<span class="string">'name'</span>:<span class="string">'xiaohong'</span>,<span class="string">'age'</span>:<span class="number">30</span>,<span class="string">'tel'</span>:<span class="number">10010</span>&#125; </span><br><span class="line">t3=pd.Series(temp_dict)<span class="comment">#通过字典创建带标签数组</span></span><br><span class="line">t3.dtype <span class="comment">#**dtype('O') **O表示object，里面有字符串</span></span><br></pre></td></tr></table></figure>



<h3 id="pandas之series切片与索引"><a href="#pandas之series切片与索引" class="headerlink" title="pandas之series切片与索引"></a>pandas之series切片与索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">t3[<span class="string">'name'</span>]<span class="comment">#与字典操作一样，通过索引来取。</span></span><br><span class="line">t3[[<span class="string">'name'</span>,<span class="string">'age'</span>]]<span class="comment">#用多个索引来取</span></span><br><span class="line">t3[<span class="number">0</span>]<span class="comment">#通过位置来取</span></span><br><span class="line">t3[:<span class="number">2</span>]<span class="comment">#取第一二行（连续</span></span><br><span class="line">t3[[<span class="number">1</span>,<span class="number">2</span>]]<span class="comment">#取第二三行（非连续</span></span><br></pre></td></tr></table></figure>



<h4 id="bool索引"><a href="#bool索引" class="headerlink" title="bool索引"></a>bool索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t4=pd.Series(range(<span class="number">10</span>),index=list(<span class="string">'ABCDEFGHIJ'</span>))</span><br><span class="line">t4[t4&gt;<span class="number">5</span>]<span class="comment">#bool索引</span></span><br><span class="line">t4[<span class="number">0</span>:<span class="number">5</span>:<span class="number">2</span>]<span class="comment">#隔一个取到第五位</span></span><br></pre></td></tr></table></figure>



<h3 id="Pandas之Series的索引与值"><a href="#Pandas之Series的索引与值" class="headerlink" title="Pandas之Series的索引与值"></a>Pandas之Series的索引与值</h3><p>Series对象本质上由两个数组构成：</p>
<p>一个数组构成对象的键（index，索引），一个数组构成对象的值（values）。</p>
<p>ndarray的很多方法都可以用于series类型，比如argmax，clip。where方法与ndarray的太相同。</p>
<h4 id="1-index"><a href="#1-index" class="headerlink" title="1.index"></a>1.index</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t4.index</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t4.index:</span><br><span class="line">    print(i)<span class="comment">#获取index的数据，意味着index是可以遍历的。</span></span><br><span class="line">print(len(t4.index))<span class="comment">#获取index的长度</span></span><br></pre></td></tr></table></figure>



<h4 id="2-values"><a href="#2-values" class="headerlink" title="2.values"></a>2.values</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t4.values</span><br><span class="line">list(t4.values)[:<span class="number">2</span>]<span class="comment">#与index一样，也可以对值进行切片或者是遍历操作</span></span><br></pre></td></tr></table></figure>

<h2 id="2-pandas之读取外部数据"><a href="#2-pandas之读取外部数据" class="headerlink" title="2.pandas之读取外部数据"></a>2.pandas之读取外部数据</h2><p>pd.read#tab补全可看到各种读取的方法。可以读取CSV,MYSQL,mangodb等的数据。</p>
<h2 id="3-pandas的常用操作（DataFrame）"><a href="#3-pandas的常用操作（DataFrame）" class="headerlink" title="3.pandas的常用操作（DataFrame）"></a>3.pandas的常用操作（DataFrame）</h2><h3 id="DataFrame的创建"><a href="#DataFrame的创建" class="headerlink" title=".DataFrame的创建"></a>.DataFrame的创建</h3><p>DataFrame对象既有行索引，又有列索引。</p>
<p>行索引，表明不同行，横向索引，叫做index，0轴，axis=0</p>
<p>列索引，表明不同列，纵向索引，叫做columns，1轴，axis=1</p>
<h4 id="1-直接创建-1"><a href="#1-直接创建-1" class="headerlink" title="1.直接创建"></a>1.直接创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pd.DataFrame(np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>,<span class="number">4</span>))<span class="comment">#创建DataFrame对象</span></span><br><span class="line">pd.DataFrame(np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>,<span class="number">4</span>),index=list(<span class="string">'abc'</span>),columns=list(<span class="string">'defg'</span>))</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">pd.DataFrame(np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>,<span class="number">4</span>),index=list(string.ascii_uppercase[<span class="number">0</span>:<span class="number">3</span>]),columns=list(string.ascii_uppercase[<span class="number">-4</span>:]))<span class="comment">#索引取大写字母表的前三位和后四位。</span></span><br></pre></td></tr></table></figure>

<h4 id="2-通过字典创建-1"><a href="#2-通过字典创建-1" class="headerlink" title="2.通过字典创建"></a>2.通过字典创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a=&#123;<span class="string">'name'</span>:[<span class="string">'xiaohong'</span>,<span class="string">'xiaoming'</span>],<span class="string">'age'</span>:[<span class="number">22</span>,<span class="number">23</span>],<span class="string">'tel'</span>:[<span class="number">10010</span>,<span class="number">10086</span>]&#125;</span><br><span class="line">pd.DataFrame(a)</span><br><span class="line"></span><br><span class="line">|      |     name |  age |   tel |</span><br><span class="line">| ---: | -------: | ---: | ----: |</span><br><span class="line">|    <span class="number">0</span> | xiaohong |   <span class="number">22</span> | <span class="number">10010</span> |</span><br><span class="line">|    <span class="number">1</span> | xiaoming |   <span class="number">23</span> | <span class="number">10086</span> |</span><br><span class="line"></span><br><span class="line">a2=[&#123;<span class="string">'name'</span>:<span class="string">'xiaohong'</span>,<span class="string">'age'</span>:<span class="number">22</span>,<span class="string">'tel'</span>:<span class="number">10010</span>&#125;,&#123;<span class="string">'name'</span>:<span class="string">'xiaoming'</span>,<span class="string">'age'</span>:<span class="number">23</span>,<span class="string">'tel'</span>:<span class="number">10086</span>&#125;]<span class="comment">#列表中放字典</span></span><br><span class="line">pd.DataFrame(a2)</span><br><span class="line">     name	    age	  tel</span><br><span class="line"><span class="number">0</span>	xiaohong	<span class="number">22</span>	<span class="number">10010</span></span><br><span class="line"><span class="number">1</span>	xiaoming	<span class="number">23</span>	<span class="number">10086</span></span><br><span class="line">a3=pd.DataFrame(a2)</span><br></pre></td></tr></table></figure>

<h3 id="DataFrame的基础属性操作"><a href="#DataFrame的基础属性操作" class="headerlink" title=".DataFrame的基础属性操作"></a>.DataFrame的基础属性操作</h3><p>A.index#行索引<br>A.columns#列索引<br>A.values#对象值，二维ndarray数组<br>A.shape#几行几列<br>A.dtypes#每一列的数据类型（int,object…）<br>A.ndim#维度</p>
<h3 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h3><p>A.sort_value(by=’某一列索引名’，ascending=False)#按照某一列索引进行降序排序，ascending默认为True(升序)</p>
<h3 id="DataFrame切片与索引"><a href="#DataFrame切片与索引" class="headerlink" title=".DataFrame切片与索引"></a>.DataFrame切片与索引</h3><p>a3[:2]#取前两行</p>
<p>a3[‘age’]#取age这一列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a3[:2][&#39;age&#39;]#取前两行第age列</span><br></pre></td></tr></table></figure>

<h4 id="1-通过标签索引行数据-loc"><a href="#1-通过标签索引行数据-loc" class="headerlink" title="1.通过标签索引行数据 .loc"></a>1.通过标签索引行数据 .loc</h4><p>a3.loc[0,’age’]#用A.loc()方法可以行列一起取，这里我们用行索引和列索引取。</p>
<p>a3.loc[0,’age’]#取第一行第age列</p>
<p>a3.loc[1,’name’:’age’]#取第二行，第name到第age列<br><strong>a3.loc[:1,[‘name’,’age’]]#取前两行，第name，age列</strong></p>
<p><strong>！注意，loc中：后的数据也会取到。</strong></p>
<h4 id="2-通过位置索引-iloc"><a href="#2-通过位置索引-iloc" class="headerlink" title="2.通过位置索引 .iloc"></a>2.通过位置索引 .iloc</h4><p>a3.iloc[0,1],[1,2]]#取位置为第一行第二行，第二列第三列的数据</p>
<p>a3.iloc[]#取位置为第一行第二行，第二列第三列的数据</p>
<h4 id="3-更改数据"><a href="#3-更改数据" class="headerlink" title="3.更改数据"></a>3.更改数据</h4><p>A.log[‘a’,’age’]=50#将第a行age列的值更改为50。</p>
<p>A.ilog[‘1’,’2’]=50#将第2行3列的值更改为50。</p>
<p>A.ilog[‘1’,’2’]=np.nan#将第2行3列的值更改为nan。与numpy不同，这里不会报错，因为DataFrame会自动转换数据类型为float型。</p>
<h4 id="4-bool布尔索引"><a href="#4-bool布尔索引" class="headerlink" title="4.bool布尔索引"></a>4.bool布尔索引</h4><p>a3[a3[‘age’]&gt;20]#取a3对象中age&gt;20的行。</p>
<p>a3[(a3[‘age’]&gt;20)&amp;(a3[‘age’]&lt;30)]#取a3对象中30&gt;age&gt;20的行。</p>
<h3 id="DataFrame整体情况查询操作"><a href="#DataFrame整体情况查询操作" class="headerlink" title=".DataFrame整体情况查询操作"></a>.DataFrame整体情况查询操作</h3><p>A.head()#默认显示前五行<br>A.tail()#默认显示后五行<br>A.info()#相关信息概览：行数，列数，列索引，列非空值个数，行类型，列类型，内存占用<br>A.describe()#显示有数字的那些列的最大值，最小值，均值，25%中位数等</p>
<p>A.count()#统计每列的个数</p>
<h3 id="DataFrame中缺失数据的处理"><a href="#DataFrame中缺失数据的处理" class="headerlink" title=".DataFrame中缺失数据的处理"></a>.DataFrame中缺失数据的处理</h3><p>1.用pd.isnull(A)或pd.notnull(A)判断A中有没有nan。</p>
<p>2.若有nan：</p>
<p>处理方式1：删除nan所在的行/列：A.dropna(axis=0,how=’any’,inplace=False)#any意为某行只要有一个nan就会被删除，inplace=Ture以为A会被永久性修改。A也可以只是某一列。</p>
<p>处理方式2：填充nan：</p>
<p>A.fillna(A.mean())#用每列的均值填充每一列的nan；A[‘age’].fillna(A[‘age’].mean())#只填充age这一列的nan。</p>
<p>处理为0的数据：A[A==0]=np.nan</p>
<p>当然并不是每次为0的数据都需要处理。计算平均值等时，nan不参与计算，但0会。</p>
<h3 id="DataFrame中数据的合并和分组聚合"><a href="#DataFrame中数据的合并和分组聚合" class="headerlink" title=".DataFrame中数据的合并和分组聚合"></a>.DataFrame中数据的合并和分组聚合</h3><h4 id="1-实例1（特征提取）"><a href="#1-实例1（特征提取）" class="headerlink" title="1.实例1（特征提取）"></a>1.实例1（特征提取）</h4><p>对于一组电影数据(其中包含了name，genre，director等列），如果要统计电影分类(genre)这一列的情况：</p>
<p>思路—重新构造一个全为0的数组，列名为genre，如果某一条数据中某分类（如comedy）出现过，则让0变为1。</p>
<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.jpg" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">a=pd.read_excel(<span class="string">r"C:/Users/YI/Desktop/movie.xlsx"</span>)</span><br><span class="line">print(a[<span class="string">'genre'</span>])</span><br><span class="line"><span class="comment">#统计分类的列表</span></span><br><span class="line">temp_a=a[<span class="string">'genre'</span>].str.split(<span class="string">','</span>).tolist() <span class="comment">#用.str.split(',')才能将genre中每一行的类别分开变成一个个单独的字符串，此时类型仍为series型,要用.tolist()转化为列表类型。对象类型为temp_a是一个大列表中嵌套着7个（行数）小列表。[[],[],...] '''</span></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line">print(temp_a)</span><br><span class="line"><span class="string">'''o=[]</span></span><br><span class="line"><span class="string">for j in temp_a:</span></span><br><span class="line"><span class="string">    for i in j:</span></span><br><span class="line"><span class="string">        o.append(i)</span></span><br><span class="line"><span class="string">print(list(set(o)))'''</span></span><br><span class="line">genre_a=list(set([i <span class="keyword">for</span> j <span class="keyword">in</span> temp_a <span class="keyword">for</span> i <span class="keyword">in</span> j]))</span><br><span class="line">print(genre_a)</span><br><span class="line"><span class="comment">#构造全为0的数组</span></span><br><span class="line">zero_a=pd.DataFrame(np.zeros((a.shape[<span class="number">0</span>],len(genre_a))),columns=genre_a)</span><br><span class="line">print(zero_a)</span><br><span class="line"><span class="comment">#给每个电影出现分类的的位置赋值1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(a.shape[<span class="number">0</span>]): <span class="comment">#遍历每一行</span></span><br><span class="line">    zero_a.loc[i,temp_a[i]]=<span class="number">1</span> <span class="comment">#temp_a[i]就选择了i行的所有类型，我们再用loc[]筛选赋值1</span></span><br><span class="line">genre_count=zero_a.sum(axis=<span class="number">0</span>)<span class="comment">#逐行相加，也就是把每列加起来</span></span><br><span class="line">print(genre_count)</span><br><span class="line"><span class="comment">#降序排序</span></span><br><span class="line">final=genre_count.sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line">print(final)</span><br><span class="line"><span class="comment">#画图</span></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.bar(final.index,final.values,width=<span class="number">0.4</span>,color=<span class="string">'orange'</span>)<span class="comment">#可以将索引和值直接作为x，y轴。</span></span><br><span class="line">plt.grid()</span><br><span class="line">plt.savefig(<span class="string">'D:\\计算机学习note\\计算机学习note\\pandas\\2.jpg'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>OUT:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">a[&#39;genre&#39;]:</span><br><span class="line">0     Action,Adventure,Sci-Fi</span><br><span class="line">1             Horror,Thriller</span><br><span class="line">2          Comedy,Drama,Music</span><br><span class="line">3                      Comedy</span><br><span class="line">4    Action,Adventure,Fantasy</span><br><span class="line">5         Action,Comedy,Drama</span><br><span class="line">6                    Thriller</span><br><span class="line">Name: genre, dtype: object</span><br><span class="line">temp_a:</span><br><span class="line">[[&#39;Action&#39;, &#39;Adventure&#39;, &#39;Sci-Fi&#39;], [&#39;Horror&#39;, &#39;Thriller&#39;], [&#39;Comedy&#39;, &#39;Drama&#39;, &#39;Music&#39;], [&#39;Comedy&#39;], [&#39;Action&#39;, &#39;Adventure&#39;, &#39;Fantasy&#39;], [&#39;Action&#39;, &#39;Comedy&#39;, &#39;Drama&#39;], [&#39;Thriller&#39;]]</span><br><span class="line">genre_a:</span><br><span class="line">[&#39;Adventure&#39;, &#39;Action&#39;, &#39;Music&#39;, &#39;Fantasy&#39;, &#39;Comedy&#39;, &#39;Thriller&#39;, &#39;Drama&#39;, &#39;Sci-Fi&#39;, &#39;Horror&#39;]</span><br><span class="line">zero_a:</span><br><span class="line">   Adventure  Action  Music  Fantasy  Comedy  Thriller  Drama  Sci-Fi  Horror</span><br><span class="line">0        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">1        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">2        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">3        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">4        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">5        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">6        0.0     0.0    0.0      0.0     0.0       0.0    0.0     0.0     0.0</span><br><span class="line">genre_count:</span><br><span class="line">Adventure    2.0</span><br><span class="line">Action       3.0</span><br><span class="line">Music        1.0</span><br><span class="line">Fantasy      1.0</span><br><span class="line">Comedy       3.0</span><br><span class="line">Thriller     2.0</span><br><span class="line">Drama        2.0</span><br><span class="line">Sci-Fi       1.0</span><br><span class="line">Horror       1.0</span><br><span class="line">dtype: float64</span><br><span class="line">****************************************************************************************************</span><br><span class="line">final:</span><br><span class="line">Comedy       3.0</span><br><span class="line">Action       3.0</span><br><span class="line">Drama        2.0</span><br><span class="line">Thriller     2.0</span><br><span class="line">Adventure    2.0</span><br><span class="line">Horror       1.0</span><br><span class="line">Sci-Fi       1.0</span><br><span class="line">Fantasy      1.0</span><br><span class="line">Music        1.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.jpg" alt></p>
<p>#用pandas的另一种方法.value_counts()<br>print(a[‘genre’].value_counts()) #结果并不是我们想要的，因为没办法把每一行中的类型分开统计。<br>#用pandas的另一种方法pd.get_dummies()<br>print(pd.get_dummies(a.genre))#结果也并不是我们想要的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Action,Comedy,Drama         1</span><br><span class="line">Action,Adventure,Fantasy    1</span><br><span class="line">Horror,Thriller             1</span><br><span class="line">Comedy                      1</span><br><span class="line">Action,Adventure,Sci-Fi     1</span><br><span class="line">Thriller                    1</span><br><span class="line">Comedy,Drama,Music          1</span><br><span class="line">Name: genre, dtype: int64</span><br><span class="line">   Action,Adventure,Fantasy  Action,Adventure,Sci-Fi  Action,Comedy,Drama  \</span><br><span class="line">0                         0                        1                    0   </span><br><span class="line">1                         0                        0                    0   </span><br><span class="line">2                         0                        0                    0   </span><br><span class="line">3                         0                        0                    0   </span><br><span class="line">4                         1                        0                    0   </span><br><span class="line">5                         0                        0                    1   </span><br><span class="line">6                         0                        0                    0   </span><br><span class="line">  Comedy  Comedy,Drama,Music  Horror,Thriller Thriller  </span><br><span class="line">0       0                   0                0         0  </span><br><span class="line">1       0                   0                1         0  </span><br><span class="line">2       0                   1                0         0  </span><br><span class="line">3       1                   0                0         0  </span><br><span class="line">4       0                   0                0         0  </span><br><span class="line">5       0                   0                0         0  </span><br><span class="line">6       0                   0                0         1</span><br></pre></td></tr></table></figure>

<h4 id="实例2（用三种方法进行特征提取）"><a href="#实例2（用三种方法进行特征提取）" class="headerlink" title="实例2（用三种方法进行特征提取）"></a>实例2（用三种方法进行特征提取）</h4><p>以下数据是某几年911紧急电话的数量，现在我们要统计出不同类型的紧急情况的次数。数据来源<a href="https://www.kaggle.com/mchirico/montcoalert/data" target="_blank" rel="noopener">https://www.kaggle.com/mchirico/montcoalert/data</a></p>
<h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data_path=<span class="string">'D:/csv file/911.csv'</span></span><br><span class="line">pd.read_csv(data_path)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data=pd.read_csv(data_path)</span><br><span class="line">data[<span class="string">'title'</span>].str.split(<span class="string">':'</span>).tolist() <span class="comment">#把title列中的紧急情况分割出来。结果如下图</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">temp_list=data[<span class="string">'title'</span>].str.split(<span class="string">':'</span>).tolist()</span><br><span class="line">cate_list=list(set(i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> temp_list)) <span class="comment">#把所有的紧急情况取出来</span></span><br><span class="line">cate_list<span class="comment">#如下</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment">#构造全为0的数组</span></span><br><span class="line">zeros_data=pd.DataFrame(np.zeros((data.shape[<span class="number">0</span>],len(cate_list))),columns=cate_list)</span><br><span class="line"><span class="comment">#赋值</span></span><br><span class="line"><span class="keyword">for</span> cate <span class="keyword">in</span> cate_list:</span><br><span class="line">    zeros_data[cate][data[<span class="string">'title'</span>].str.contains(cate)]=<span class="number">1</span> <span class="comment">#[data['title'].str.contains(cate)]是一个布尔索引，可以挑选出title列中有cate的那些行</span></span><br><span class="line">print(zeros_data) </span><br><span class="line">zeros_data.sum() <span class="comment">#结果如下，得到了我们想要的结果</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" alt></p>
<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><p>如实例1，我们也可以用for循环遍历每一行，对全零dataframe赋值1，来得到每种情况的个数。但for循环遍历要比在pandas中遍历慢很多，这个表有几十万条数据，因此我们不推荐这种方法。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(data.shape[<span class="number">0</span>]):</span><br><span class="line">    zeros_data.loc[i,temp_list[i][<span class="number">0</span>]]=<span class="number">1</span></span><br><span class="line">print(zeros_data)</span><br></pre></td></tr></table></figure>

<p>方法三</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=[i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> temp_list]</span><br><span class="line">data[<span class="string">'cate'</span>]=pd.DataFrame(np.array(a).reshape(data.shape[<span class="number">0</span>],<span class="number">1</span>))<span class="comment">#np.array()将列表list或元组tuple转换为 ndarray 数组</span></span><br><span class="line"><span class="comment">#在数据中添加一列cate，这一列是去掉原本title列中多余信息后的不同类型的紧急情况。然后再用groupby分组就可以得到。</span></span><br><span class="line">data.groupby(by=<span class="string">'cate'</span>).count()[<span class="string">'title'</span>]<span class="comment">#结果如下</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt></p>
<h4 id="2-数据合并之join"><a href="#2-数据合并之join" class="headerlink" title="2.数据合并之join"></a>2.数据合并之join</h4><p>默认情况下会将行索引相同的数据合并到一起。</p>
<p>print(a)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    E   F   G   H   I</span><br><span class="line">A   0   1   2   3   4</span><br><span class="line">B   5   6   7   8   9</span><br><span class="line">C  10  11  12  13  14</span><br><span class="line">D  15  16  17  18  19</span><br></pre></td></tr></table></figure>

<p>print(b)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     0    1    2</span><br><span class="line">A  0.0  0.0  0.0</span><br><span class="line">B  0.0  0.0  0.0</span><br></pre></td></tr></table></figure>

<p>a.join(b)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   E   F   G   H   I    0    1    2</span><br><span class="line">A   0   1   2   3   4  0.0  0.0  0.0</span><br><span class="line">B   5   6   7   8   9  0.0  0.0  0.0</span><br><span class="line">C  10  11  12  13  14  NaN  NaN  NaN</span><br><span class="line">D  15  16  17  18  19  NaN  NaN  NaN</span><br></pre></td></tr></table></figure>

<h4 id="3-数据合并之merge"><a href="#3-数据合并之merge" class="headerlink" title="3.数据合并之merge"></a>3.数据合并之merge</h4><p>pandas中的merge()函数类似于SQL中join的用法，可以将不同数据集依照某些字段（属性）进行合并操作，得到一个新的数据集。</p>
<h5 id="1-用法"><a href="#1-用法" class="headerlink" title="1.用法"></a>1.用法</h5><p>DataFrame1.merge(DataFrame2, how=‘inner’, on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=False, suffixes=(’_x’, ‘_y’))</p>
<h5 id="2-参数说明"><a href="#2-参数说明" class="headerlink" title="2.参数说明"></a>2.参数说明</h5><p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/D:%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5Cpandas%5C3.png" alt></p>
<h5 id="3-代码展示"><a href="#3-代码展示" class="headerlink" title="3.代码展示"></a>3.代码展示</h5><p>print(a)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    E   F   G   H   I</span><br><span class="line">A   0   1   2   3   4</span><br><span class="line">B   5   6   7   8   9</span><br><span class="line">C  10  11  12  13  14</span><br><span class="line">D  15  16  17  18  19</span><br></pre></td></tr></table></figure>

<p>print(c)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   E  Y</span><br><span class="line">A  0  1</span><br><span class="line">B  2  3</span><br></pre></td></tr></table></figure>

<p>print(a.merge(c,on=’E’))#若未指定on,则默认以a和c列名的交集作为连接键。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   E  F  G  H  I  Y</span><br><span class="line">0  0  1  2  3  4  1</span><br></pre></td></tr></table></figure>

<p>print(a.merge(c,on=’E’,how=’outer’))#全链接(Outer)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    E     F     G     H     I    Y</span><br><span class="line">0   0   1.0   2.0   3.0   4.0  1.0</span><br><span class="line">1   5   6.0   7.0   8.0   9.0  NaN</span><br><span class="line">2  10  11.0  12.0  13.0  14.0  NaN</span><br><span class="line">3  15  16.0  17.0  18.0  19.0  NaN</span><br><span class="line">4   2   NaN   NaN   NaN   NaN  3.0</span><br></pre></td></tr></table></figure>

<p>print(a.merge(c,on=’E’,how=’left’))#左链接(left）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    E   F   G   H   I    Y</span><br><span class="line">0   0   1   2   3   4  1.0</span><br><span class="line">1   5   6   7   8   9  NaN</span><br><span class="line">2  10  11  12  13  14  NaN</span><br><span class="line">3  15  16  17  18  19  NaN</span><br></pre></td></tr></table></figure>

<p>print(a.merge(c,on=’E’,how=’right’))#右链接(Right)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   E    F    G    H    I  Y</span><br><span class="line">0  0  1.0  2.0  3.0  4.0  1</span><br><span class="line">1  2  NaN  NaN  NaN  NaN  3</span><br></pre></td></tr></table></figure>

<p>print(a.merge(c,left_on=’F’,right_on=’Y’)) #列名可以不同，但要有值相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   E_x  F  G  H  I  E_y  Y</span><br><span class="line">0    0  1  2  3  4    0  1</span><br></pre></td></tr></table></figure>

<h4 id="4-数据分组之groupby"><a href="#4-数据分组之groupby" class="headerlink" title="4.数据分组之groupby"></a>4.数据分组之groupby</h4><p>t.groupby(by=’columns_name’) #得到的结果是一个DataFrameGroupBy对象</p>
<p>DataFrameGroupBy对象有很多经过优化的方法</p>
<img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.jpg" style="zoom:50%;">



<h5 id="实例1–按一个条件进行分组"><a href="#实例1–按一个条件进行分组" class="headerlink" title="实例1–按一个条件进行分组"></a>实例1–按一个条件进行分组</h5><p>统计星巴克在美国和中国的数量。数据来源<a href="https://www.kaggle.com/starbucks/store-locations/data" target="_blank" rel="noopener">https://www.kaggle.com/starbucks/store-locations/data</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data_path=<span class="string">'D:/csv file/directory.csv'</span></span><br><span class="line">data=pd.read_csv(data_path)</span><br><span class="line">print(data.head())</span><br><span class="line">print(data.info())</span><br><span class="line"><span class="comment">#方法1，直接用列索引进行筛选</span></span><br><span class="line">cn_length=len(data[data[<span class="string">'Country'</span>]==<span class="string">'CN'</span>])</span><br><span class="line">us_length=len(data[data[<span class="string">'Country'</span>]==<span class="string">'US'</span>])</span><br><span class="line">print(cn_length,us_length)</span><br><span class="line"><span class="comment">#输出如下：中国2734家，美国13608家</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">     Brand  Store Number        Store Name Ownership Type  \</span><br><span class="line">0  Starbucks  47370-257954     Meritxell, 96       Licensed   </span><br><span class="line">1  Starbucks  22331-212325  Ajman Drive Thru       Licensed   </span><br><span class="line">2  Starbucks  47089-256771         Dana Mall       Licensed   </span><br><span class="line">3  Starbucks  22126-218024        Twofour 54       Licensed   </span><br><span class="line">4  Starbucks  17127-178586      Al Ain Tower       Licensed   </span><br><span class="line"></span><br><span class="line">                    Street Address              City State&#x2F;Province Country  \</span><br><span class="line">0                Av. Meritxell, 96  Andorra la Vella              7      AD   </span><br><span class="line">1             1 Street 69, Al Jarf             Ajman             AJ      AE   </span><br><span class="line">2     Sheikh Khalifa Bin Zayed St.             Ajman             AJ      AE   </span><br><span class="line">3                  Al Salam Street         Abu Dhabi             AZ      AE   </span><br><span class="line">4  Khaldiya Area, Abu Dhabi Island         Abu Dhabi             AZ      AE   </span><br><span class="line"></span><br><span class="line">  Postcode Phone Number                 Timezone  Longitude  Latitude  </span><br><span class="line">0    AD500    376818720  GMT+1:00 Europe&#x2F;Andorra       1.53     42.51  </span><br><span class="line">1      NaN          NaN     GMT+04:00 Asia&#x2F;Dubai      55.47     25.42  </span><br><span class="line">2      NaN          NaN     GMT+04:00 Asia&#x2F;Dubai      55.47     25.39  </span><br><span class="line">3      NaN          NaN     GMT+04:00 Asia&#x2F;Dubai      54.38     24.48  </span><br><span class="line">4      NaN          NaN     GMT+04:00 Asia&#x2F;Dubai      54.54     24.51  </span><br><span class="line">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span><br><span class="line">RangeIndex: 25600 entries, 0 to 25599</span><br><span class="line">Data columns (total 13 columns):</span><br><span class="line"> #   Column          Non-Null Count  Dtype  </span><br><span class="line">---  ------          --------------  -----  </span><br><span class="line"> 0   Brand           25600 non-null  object </span><br><span class="line"> 1   Store Number    25600 non-null  object </span><br><span class="line"> 2   Store Name      25600 non-null  object </span><br><span class="line"> 3   Ownership Type  25600 non-null  object </span><br><span class="line"> 4   Street Address  25598 non-null  object </span><br><span class="line"> 5   City            25585 non-null  object </span><br><span class="line"> 6   State&#x2F;Province  25600 non-null  object </span><br><span class="line"> 7   Country         25600 non-null  object </span><br><span class="line"> 8   Postcode        24078 non-null  object </span><br><span class="line"> 9   Phone Number    18739 non-null  object </span><br><span class="line"> 10  Timezone        25600 non-null  object </span><br><span class="line"> 11  Longitude       25599 non-null  float64</span><br><span class="line"> 12  Latitude        25599 non-null  float64</span><br><span class="line">dtypes: float64(2), object(11)</span><br><span class="line">memory usage: 2.5+ MB</span><br><span class="line">None</span><br><span class="line">2734 13608</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法2，用groupby</span></span><br><span class="line"></span><br><span class="line">a=data.groupby(by=<span class="string">'Country'</span>) <span class="comment">#a是一个DataFrameGroupBy对象，可遍历，可调用聚合方法count.()。a中每一个元素是一个元组。</span></span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(i)</span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出如下</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x000001D992724288&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(&#39;AD&#39;,        Brand  Store Number     Store Name Ownership Type     Street Address  \</span><br><span class="line">0  Starbucks  47370-257954  Meritxell, 96       Licensed  Av. Meritxell, 96   </span><br><span class="line"></span><br><span class="line">               City State&#x2F;Province Country Postcode Phone Number  \</span><br><span class="line">0  Andorra la Vella              7      AD    AD500    376818720   </span><br><span class="line"></span><br><span class="line">                  Timezone  Longitude  Latitude  </span><br><span class="line">0  GMT+1:00 Europe&#x2F;Andorra       1.53     42.51  )</span><br><span class="line">****************************************************************************************************</span><br><span class="line">(&#39;AE&#39;,          Brand  Store Number                      Store Name Ownership Type  \</span><br><span class="line">1    Starbucks  22331-212325                Ajman Drive Thru       Licensed   </span><br><span class="line">2    Starbucks  47089-256771                       Dana Mall       Licensed   </span><br><span class="line">3    Starbucks  22126-218024                      Twofour 54       Licensed   </span><br><span class="line">4    Starbucks  17127-178586                    Al Ain Tower       Licensed   </span><br><span class="line">5    Starbucks  17688-182164        Dalma Mall, Ground Floor       Licensed   </span><br><span class="line">..         ...           ...                             ...            ...   </span><br><span class="line">140  Starbucks   34253-62541                  Bukhatir Tower       Licensed   </span><br><span class="line">141  Starbucks   1359-138434                  Qanat Al Qasba       Licensed   </span><br><span class="line">142  Starbucks   34259-54260                   Sahara Center       Licensed   </span><br><span class="line">143  Starbucks   34217-27108  American University of Sharjah       Licensed   </span><br><span class="line">144  Starbucks  22697-223524                  UAQ Drive Thru       Licensed   </span><br><span class="line"></span><br><span class="line">                         Street Address           City State&#x2F;Province Country  \</span><br><span class="line">1                  1 Street 69, Al Jarf          Ajman             AJ      AE   </span><br><span class="line">2          Sheikh Khalifa Bin Zayed St.          Ajman             AJ      AE   </span><br><span class="line">3                       Al Salam Street      Abu Dhabi             AZ      AE   </span><br><span class="line">4       Khaldiya Area, Abu Dhabi Island      Abu Dhabi             AZ      AE   </span><br><span class="line">5                  Dalma Mall, Mussafah      Abu Dhabi             AZ      AE   </span><br><span class="line">..                                  ...            ...            ...     ...   </span><br><span class="line">140            Sharjah Buheira Corniche        Sharjah             SH      AE   </span><br><span class="line">141                      Al Taawun Road        Sharjah             SH      AE   </span><br><span class="line">142                             Alnahda        Sharjah             SH      AE   </span><br><span class="line">143  Airport Road, Universities Complex        Sharjah             SH      AE   </span><br><span class="line">144                 King Faisal Highway  Umm Al Quwain             UQ      AE</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(a.count())<span class="comment">#看看将a计数能得到什么结果，结果如下所示</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">         Brand  Store Number  Store Name  Ownership Type  Street Address  \</span><br><span class="line">Country                                                                    </span><br><span class="line">AD           1             1           1               1               1   </span><br><span class="line">AE         144           144         144             144             144   </span><br><span class="line">AR         108           108         108             108             108   </span><br><span class="line">AT          18            18          18              18              18   </span><br><span class="line">AU          22            22          22              22              22   </span><br><span class="line">...        ...           ...         ...             ...             ...   </span><br><span class="line">TT           3             3           3               3               3   </span><br><span class="line">TW         394           394         394             394             394   </span><br><span class="line">US       13608         13608       13608           13608           13608   </span><br><span class="line">VN          25            25          25              25              25   </span><br><span class="line">ZA           3             3           3               3               3   </span><br><span class="line"></span><br><span class="line">           City  State&#x2F;Province  Postcode  Phone Number  Timezone  Longitude  \</span><br><span class="line">Country                                                                       </span><br><span class="line">AD           1               1         1             1         1          1   </span><br><span class="line">AE         144             144        24            78       144        144   </span><br><span class="line">AR         108             108       100            29       108        108   </span><br><span class="line">AT          18              18        18            17        18         18   </span><br><span class="line">AU          22              22        22             0        22         22   </span><br><span class="line">...        ...             ...       ...           ...       ...        ...   </span><br><span class="line">TT           3               3         3             0         3          3   </span><br><span class="line">TW         394             394       365            39       394        394   </span><br><span class="line">US       13608           13608     13607         13122     13608      13608   </span><br><span class="line">VN          25              25        25            23        25         25   </span><br><span class="line">ZA           3               3         3             2         3          3   </span><br><span class="line"></span><br><span class="line">         Latitude  </span><br><span class="line">Country            </span><br><span class="line">AD              1  </span><br><span class="line">AE            144  </span><br><span class="line">AR            108  </span><br><span class="line">AT             18  </span><br><span class="line">AU             22  </span><br><span class="line">...           ...  </span><br><span class="line">TT              3  </span><br><span class="line">TW            394  </span><br><span class="line">US          13608  </span><br><span class="line">VN             25  </span><br><span class="line">ZA              3  </span><br><span class="line"></span><br><span class="line">[73 rows x 12 columns]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(a[<span class="string">'Brand'</span>].count())<span class="comment">#Series类型,选择Brand是因为Brand列中数据没有缺失，计数它就相当于对每个国家（每个元组中）星巴克的个数进行计数。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Country</span><br><span class="line">AD        1</span><br><span class="line">AE      144</span><br><span class="line">AR      108</span><br><span class="line">AT       18</span><br><span class="line">AU       22</span><br><span class="line">      ...  </span><br><span class="line">TT        3</span><br><span class="line">TW      394</span><br><span class="line">US    13608</span><br><span class="line">VN       25</span><br><span class="line">ZA        3</span><br><span class="line">Name: Brand, Length: 73, dtype: int64</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="string">'Brand'</span>].count()[<span class="string">'CN'</span>]<span class="comment">#输出结果为2734，同理可以得到美国的。</span></span><br></pre></td></tr></table></figure>

<h5 id="实例2–按多条件进行分组"><a href="#实例2–按多条件进行分组" class="headerlink" title="实例2–按多条件进行分组"></a>实例2–按多条件进行分组</h5><p>以实例1为基础。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据按照多个条件进行分组</span></span><br><span class="line">grouped=data[<span class="string">'Brand'</span>].groupby(by=[data[<span class="string">'Country'</span>],data[<span class="string">'State/Province'</span>]]).count()<span class="comment">#按国家和省进行分组并统计个数。注意data['Brand']是一个series类型，后面分组时不能写成by=['Country','State/Province']。</span></span><br><span class="line">print(grouped)<span class="comment">#grouped是series类型，左边两列都是索引。</span></span><br><span class="line"><span class="comment">#输出如下</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Country  State&#x2F;Province</span><br><span class="line">AD       7                  1</span><br><span class="line">AE       AJ                 2</span><br><span class="line">         AZ                48</span><br><span class="line">         DU                82</span><br><span class="line">         FU                 2</span><br><span class="line">                           ..</span><br><span class="line">US       WV                25</span><br><span class="line">         WY                23</span><br><span class="line">VN       HN                 6</span><br><span class="line">         SG                19</span><br><span class="line">ZA       GT                 3</span><br><span class="line">Name: Brand, Length: 545, dtype: int64</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grouped1=data.groupby(by=[<span class="string">'Country'</span>,<span class="string">'State/Province'</span>]).count()[<span class="string">'Brand'</span>]</span><br><span class="line">print(grouped1)</span><br><span class="line"><span class="comment">#输出如下，可以达到同样效果</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Country  State&#x2F;Province</span><br><span class="line">AD       7                  1</span><br><span class="line">AE       AJ                 2</span><br><span class="line">         AZ                48</span><br><span class="line">         DU                82</span><br><span class="line">         FU                 2</span><br><span class="line">                           ..</span><br><span class="line">US       WV                25</span><br><span class="line">         WY                23</span><br><span class="line">VN       HN                 6</span><br><span class="line">         SG                19</span><br><span class="line">ZA       GT                 3</span><br><span class="line">Name: Brand, Length: 545, dtype: int64</span><br></pre></td></tr></table></figure>

<h3 id="DataFrame的索引与复合索引-set-index"><a href="#DataFrame的索引与复合索引-set-index" class="headerlink" title=".DataFrame的索引与复合索引 set_index()"></a>.DataFrame的索引与复合索引 set_index()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">a=pd.DataFrame(&#123;<span class="string">'a'</span>:range(<span class="number">7</span>),<span class="string">'b'</span>:range(<span class="number">7</span>,<span class="number">0</span>,<span class="number">-1</span>),<span class="string">'c'</span>:[<span class="string">'one'</span>,<span class="string">'one'</span>,<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'two'</span>,<span class="string">'two'</span>,<span class="string">'two'</span>],<span class="string">'d'</span>:list(<span class="string">'hjklmno'</span>)&#125;)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   a  b    c  d</span><br><span class="line">0  0  7  one  h</span><br><span class="line">1  1  6  one  j</span><br><span class="line">2  2  5  one  k</span><br><span class="line">3  3  4  two  l</span><br><span class="line">4  4  3  two  m</span><br><span class="line">5  5  2  two  n</span><br><span class="line">6  6  1  two  o</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改索引</span></span><br><span class="line">a.index=list(<span class="string">'ABCDEFG'</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment">#重新设置index</span></span><br><span class="line">b=a.reindex([<span class="string">'A'</span>,<span class="string">'E'</span>,<span class="string">'a'</span>])</span><br><span class="line">print(b)<span class="comment">#若索引不存在则赋值nan</span></span><br><span class="line"><span class="comment">#把某一列作为索引</span></span><br><span class="line">c=a.set_index(<span class="string">'a'</span>,drop=<span class="literal">True</span>)<span class="comment">#把a列作为索引,当drop=True时a列只作为索引</span></span><br><span class="line">print(c)</span><br><span class="line"><span class="comment">#返回索引的唯一值</span></span><br><span class="line">print(a[<span class="string">'c'</span>].unique())</span><br><span class="line"><span class="comment">#设置复合索引</span></span><br><span class="line">d=a.set_index([<span class="string">'c'</span>,<span class="string">'a'</span>],drop=<span class="literal">False</span>)</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">   a  b    c  d</span><br><span class="line">A  0  7  one  h</span><br><span class="line">B  1  6  one  j</span><br><span class="line">C  2  5  one  k</span><br><span class="line">D  3  4  two  l</span><br><span class="line">E  4  3  two  m</span><br><span class="line">F  5  2  two  n</span><br><span class="line">G  6  1  two  o</span><br><span class="line">     a    b    c    d</span><br><span class="line">A  0.0  7.0  one    h</span><br><span class="line">E  4.0  3.0  two    m</span><br><span class="line">a  NaN  NaN  NaN  NaN</span><br><span class="line">   b    c  d</span><br><span class="line">a           </span><br><span class="line">0  7  one  h</span><br><span class="line">1  6  one  j</span><br><span class="line">2  5  one  k</span><br><span class="line">3  4  two  l</span><br><span class="line">4  3  two  m</span><br><span class="line">5  2  two  n</span><br><span class="line">6  1  two  o</span><br><span class="line">[&#39;one&#39; &#39;two&#39;]</span><br><span class="line">       a  b    c  d</span><br><span class="line">c   a              </span><br><span class="line">one 0  0  7  one  h</span><br><span class="line">    1  1  6  one  j</span><br><span class="line">    2  2  5  one  k</span><br><span class="line">two 3  3  4  two  l</span><br><span class="line">    4  4  3  two  m</span><br><span class="line">    5  5  2  two  n</span><br><span class="line">    6  6  1  two  o</span><br></pre></td></tr></table></figure>

<p>Out[3]:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MultiIndex([(&#39;one&#39;, 0),</span><br><span class="line">            (&#39;one&#39;, 1),</span><br><span class="line">            (&#39;one&#39;, 2),</span><br><span class="line">            (&#39;two&#39;, 3),</span><br><span class="line">            (&#39;two&#39;, 4),</span><br><span class="line">            (&#39;two&#39;, 5),</span><br><span class="line">            (&#39;two&#39;, 6)],</span><br><span class="line">           names&#x3D;[&#39;c&#39;, &#39;a&#39;])</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用复合索引取DataFrame中的值</span></span><br><span class="line">print(d[<span class="string">'a'</span>][<span class="string">'one'</span>][<span class="number">2</span>])<span class="comment">#取第a列第['one'][2]行的值</span></span><br><span class="line">print(d.swaplevel())<span class="comment">#交换两个行索引的位置,level相当于复合索引的里外层。</span></span><br><span class="line">d.loc[<span class="string">'one'</span>].loc[<span class="number">0</span>]<span class="comment">#若要直接用行索引取值，则要用loc来取。这里指取第one，0行的值。</span></span><br><span class="line">e=a.set_index([<span class="string">'c'</span>,<span class="string">'a'</span>])[<span class="string">'d'</span>]</span><br><span class="line">print(e[<span class="string">'one'</span>,<span class="number">2</span>],e[<span class="string">'one'</span>][<span class="number">2</span>])<span class="comment">#用复合索引取Series中的值,两种方式都可以</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">       a  b    c  d</span><br><span class="line">a c                </span><br><span class="line">0 one  0  7  one  h</span><br><span class="line">1 one  1  6  one  j</span><br><span class="line">2 one  2  5  one  k</span><br><span class="line">3 two  3  4  two  l</span><br><span class="line">4 two  4  3  two  m</span><br><span class="line">5 two  5  2  two  n</span><br><span class="line">6 two  6  1  two  o</span><br><span class="line">k k</span><br></pre></td></tr></table></figure>

<h2 id="4-Pandas之时间序列"><a href="#4-Pandas之时间序列" class="headerlink" title="4.Pandas之时间序列"></a>4.Pandas之时间序列</h2><h3 id="生成时间范围pd-date-range"><a href="#生成时间范围pd-date-range" class="headerlink" title="生成时间范围pd.date_range()"></a>生成时间范围pd.date_range()</h3><p>pd.date_range(start=None,end=None,periods=None,freq=’D’)</p>
<p>start 和end以及freq配合能够生成start和end范围内以频率为freq的一组时间索引。</p>
<p>start和periods以及freq配合能够生成从start开始的以频率为freq的periods个时间索引。</p>
<p>代码如下：</p>
<img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" style="zoom:150%;">



<h3 id="freq参数的详细描述"><a href="#freq参数的详细描述" class="headerlink" title="freq参数的详细描述"></a>freq参数的详细描述</h3><p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<h3 id="pd-to-datetime-转化格式"><a href="#pd-to-datetime-转化格式" class="headerlink" title="pd.to_datetime() 转化格式"></a>pd.to_datetime() 转化格式</h3><p>pd.to_datetime(t[‘b’],format=’’)可以把b这列的时间字符串转化为时间序列。format参数大部分情况不用写，但对于pandas无法格式化的时间字符串，可以使用此参数，如包含中文。</p>
<h3 id="resample-重采样"><a href="#resample-重采样" class="headerlink" title="resample()重采样"></a>resample()重采样</h3><p>将时间序列从一个频率转化为另一个频率的过程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">t=pd.DataFrame(np.random.uniform(<span class="number">10</span>,<span class="number">50</span>,(<span class="number">100</span>,<span class="number">1</span>)),index=pd.date_range(start=<span class="string">'20170101'</span>,periods=<span class="number">100</span>,freq=<span class="string">'D'</span>))</span><br><span class="line">print(t)</span><br><span class="line">print(t.resample(<span class="string">'M'</span>).mean())<span class="comment">#resample将t中的时间频率改变了，之后对每个月的值求平均。注意resample的操作对象是为行索引的时间序列</span></span><br><span class="line">print(t.resample(<span class="string">'M'</span>).count())<span class="comment">#对每个月进行计数，</span></span><br><span class="line"><span class="comment">#输出如下</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<h3 id="实例1（用to-datetime解决实际问题）"><a href="#实例1（用to-datetime解决实际问题）" class="headerlink" title="实例1（用to_datetime解决实际问题）"></a>实例1（用to_datetime解决实际问题）</h3><p>统计911数据中不同月份电话次数的变化情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">data=pd.read_csv(data_path)<span class="comment">#在前文的实例2中可查看data</span></span><br><span class="line">data[<span class="string">'timeStamp'</span>]=pd.to_datetime(data[<span class="string">'timeStamp'</span>])<span class="comment">#将data中的timeStamp列转化为pandas时间序列的格式</span></span><br><span class="line">data.set_index(<span class="string">'timeStamp'</span>,inplace=<span class="literal">True</span>)<span class="comment">#将timeStamp列作为行索引，inplace=True即地生效。</span></span><br><span class="line">data.resample(<span class="string">'M'</span>).count()[<span class="string">'title'</span>]<span class="comment">#变为行索引后，就可以使用resample()得到我们想要的结果。</span></span><br><span class="line"><span class="comment">#输出如下，未截图完整</span></span><br></pre></td></tr></table></figure>



<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/D:%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5Cpandas%5C13.png" alt></p>
<p>现在我们想统计911数据中不同月份不同类型的电话次数的变化情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.groupby(by=<span class="string">'cate'</span>).resample(<span class="string">'M'</span>).count()[<span class="string">'cate'</span>]<span class="comment">#先按cate分组，再按每个月进行计数</span></span><br><span class="line"><span class="comment">#结果如下</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/D:%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0note%5Cpandas%5C14.png" alt></p>
<p>#现在我们再用loc[]取行索引就得到想要的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E=data.groupby(by=<span class="string">'cate'</span>).resample(<span class="string">'M'</span>).count()[<span class="string">'cate'</span>]</span><br><span class="line">E.loc[<span class="string">'EMS'</span>]<span class="comment">#得到EMS在每个月发生的次数，同理可得另外两个的</span></span><br><span class="line"><span class="comment">#结果如下，未截图完整</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt></p>
<h3 id="PeriodIndex-时间段"><a href="#PeriodIndex-时间段" class="headerlink" title="PeriodIndex()时间段"></a>PeriodIndex()时间段</h3><p>periods = pd.PeriodIndex(year=data[“year”],month=data[“month”],day=data[“day”],hour=data[“hour”],freq=”H”)</p>
<p>如果我们要处理的数据中年月日都是按列分开的（与上个例子不同），就要用PeriodIndex()将他们合并成一列转化为PeriodIndex类型，再用set_index()方法将它作为数据的列索引，然后可以用resample()对这个列索引进行处理了。</p>
<h3 id="实例2（用PeriodIndex解决实际问题）"><a href="#实例2（用PeriodIndex解决实际问题）" class="headerlink" title="实例2（用PeriodIndex解决实际问题）"></a>实例2（用PeriodIndex解决实际问题）</h3><p>绘制出北京pm2.5随时间的变化情况。数据来源<a href="https://www.kaggle.com/uciml/pm25-data-for-five-chinese-cities" target="_blank" rel="noopener">https://www.kaggle.com/uciml/pm25-data-for-five-chinese-cities</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">file_path=<span class="string">'D:/csv file/BeijingPM20100101_20151231.csv'</span></span><br><span class="line">pd.read_csv(file_path</span><br><span class="line"></span><br><span class="line"><span class="comment">#数据显示如下</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df=pd.read_csv(file_path)</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">period=pd.PeriodIndex(year=df[<span class="string">'year'</span>],month=df[<span class="string">'month'</span>],day=df[<span class="string">'day'</span>],hour=df[<span class="string">'hour'</span>],freq=<span class="string">'H'</span>)<span class="comment">#把分开的时间字符串通过PeriodIndex的方法转化为pandas的时间类型。</span></span><br><span class="line">print(period)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'period'</span>]=period<span class="comment">#添加period列到df中</span></span><br><span class="line">df.set_index(<span class="string">'period'</span>,inplace=<span class="literal">True</span>) <span class="comment">#将period列作为行索引</span></span><br><span class="line">data=df.dropna(axis=<span class="number">0</span>,subset=[<span class="string">'PM_US Post'</span>])<span class="comment">#去掉PM_US Post列中的nan数据</span></span><br><span class="line">new_data=data.resample(<span class="string">'M'</span>).mean() <span class="comment">#数据太多，进行降采样</span></span><br><span class="line">_x=new_data[<span class="string">'PM_US Post'</span>].index</span><br><span class="line">_y=new_data[<span class="string">'PM_US Post'</span>].values</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.xticks(range(len(_x)),_x,rotation=<span class="number">45</span>)</span><br><span class="line">plt.plot(range(len(_x)),_y)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.jpg" alt></p>
<p>与以前直接将index和values作为x轴和y轴就画出图不同，这次在实际写代码中，我发现直接用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(_x,_y)</span><br></pre></td></tr></table></figure>

<p>绘图会出现以下错误：</p>
<p>TypeError: float() argument must be a string or a number, not ‘Period’</p>
<p>上网查询没有得到结果，不知是否与index是时间序列有关。</p>
<h4 id="小tips—strftime-）"><a href="#小tips—strftime-）" class="headerlink" title="小tips—strftime(）"></a>小tips—strftime(）</h4><p>有时我们希望横坐标只有年月日，而绘图后发现横坐标莫名的多出了时分秒，就可以用strftime() 函数接收以时间元组，并返回以可读字符串表示的当地时间，格式由()中的参数format决定。</p>
<p>x=[i.strftime(‘%Y%m%d’) for i in x] # x一般就是作为列索引的时间序列.如上个实例中的_x。</p>
<h2 id="5-显示所有行与列"><a href="#5-显示所有行与列" class="headerlink" title="5.显示所有行与列"></a>5.显示所有行与列</h2><p>#显示所有列<br>pd.set_option(‘display.max_columns’, None)<br>#显示所有行<br>pd.set_option(‘display.max_rows’, None)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Pandas%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekf80007covt8p7z7bns" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pandas/" rel="tag">Pandas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python爬虫学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T14:47:48.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Python爬虫学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="request库"><a href="#request库" class="headerlink" title="request库"></a>request库</h2><h3 id="Requests的7个主要方法"><a href="#Requests的7个主要方法" class="headerlink" title="Requests的7个主要方法"></a>Requests的7个主要方法</h3><p>后四个方法有时由于网络安全限制并不能用。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" style="zoom:67%;">

<p>r=request.get(url,params=None,**kwargs) #r指服务器资源的Response对象（包含爬虫返回的全部内容）。</p>
<p>url:网页链接</p>
<p>params:url中的额外参数，字典或字节流格式。</p>
<p>**kwargs：12个控制访问的参数。</p>
<p>requests.request(method,url,**kwargs)</p>
<p>**kwargs:13个控制访问的参数，均为可选项（如params:改变url，data，json，headers，options等）</p>
<p><strong>requests.get(url）与requests.request(‘GET’,url）效果相同</strong></p>
<h3 id="Response对象的属性"><a href="#Response对象的属性" class="headerlink" title="Response对象的属性"></a>Response对象的属性</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" style="zoom:67%;">

<p>r.encoding:如果header中没有charset字段，则认为编码方式是ISO-8859-1</p>
<h3 id="Requests库的异常"><a href="#Requests库的异常" class="headerlink" title="Requests库的异常"></a>Requests库的异常</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" style="zoom: 67%;">

<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" style="zoom: 67%;">

<p>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r=requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(r.status_code)<span class="comment">#若状态码返回200，说明请求成功。404表示失败</span></span><br><span class="line">print(r.headers)<span class="comment">#返回请求页面的头部信息</span></span><br><span class="line">print(r.text)<span class="comment">#发现有些乱码</span></span><br><span class="line">print(r.encoding)<span class="comment">#从页面头部看它的编码方式ISO-8859-1，这种编码方式不能解析中文</span></span><br><span class="line">print(r.apparent_encoding)<span class="comment">#从页面内容解析出来的编码方式（实际）为utf-8，与上一个不一致</span></span><br><span class="line">r.encoding=<span class="string">'utf-8'</span></span><br><span class="line">print(r.text)<span class="comment">#此时输出了正常（包含中文）的页面内容</span></span><br></pre></td></tr></table></figure>



<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" style="zoom:67%;">

<h4 id="try方法"><a href="#try方法" class="headerlink" title="try方法"></a>try方法</h4><p>用于处理异常，基本语法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">&lt;语句&gt;        #运行别的代码</span><br><span class="line">except &lt;名字&gt;：</span><br><span class="line">&lt;语句&gt;        #如果在try部份引发了&#39;name&#39;异常</span><br><span class="line">except &lt;名字&gt;，&lt;数据&gt;:</span><br><span class="line">&lt;语句&gt;        #如果引发了&#39;name&#39;异常，获得附加的数据</span><br><span class="line">else:</span><br><span class="line">&lt;语句&gt;        #如果没有异常发生</span><br></pre></td></tr></table></figure>



<p>robots协议：网站通过设置robots协议来告诉用户那些数据可以爬取，哪些不能爬取。如下面nike的robots协议。</p>
<p><a href="https://www.nike.com/robots.txt" target="_blank" rel="noopener">https://www.nike.com/robots.txt</a></p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>当发生异常时，如r.status_code返回503，不是200：</p>
<p>我们修改请求报文头部信息（header）中的User-Agent，若还是不行，则将以浏览器形式访问的页面request header的字段都添加到我们爬虫时request的header中，之后就可以正常查看网页的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r=requests.get(url,timeout=<span class="number">30</span>)</span><br><span class="line">print(r.request.headers)</span><br><span class="line">kv=&#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0'</span>&#125;<span class="comment">#改变请求报文的user-agent，让对方以为我们是浏览器而不是爬虫</span></span><br><span class="line">u=requests.get(url,headers=kv)</span><br><span class="line">u.request.headers<span class="comment">#修改成功</span></span><br></pre></td></tr></table></figure>

<p>Out[37]:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;User-Agent&#39;: &#39;python-requests&#x2F;2.22.0&#39;, &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;, &#39;Accept&#39;: &#39;*&#x2F;*&#39;, &#39;Connection&#39;: &#39;keep-alive&#39;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0&#39;, &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;, &#39;Accept&#39;: &#39;*&#x2F;*&#39;, &#39;Connection&#39;: &#39;keep-a</span><br></pre></td></tr></table></figure>

<h2 id="实例1（网络图片的爬取和存储"><a href="#实例1（网络图片的爬取和存储" class="headerlink" title="实例1（网络图片的爬取和存储)"></a>实例1（网络图片的爬取和存储)</h2><p>网络图片链接的通用格式：</p>
<p><a href="http://www.example.com/picture.jpg" target="_blank" rel="noopener">http://www.example.com/picture.jpg</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">path=<span class="string">'d:/abc.jpg'</span></span><br><span class="line">url=<span class="string">'http://image.nationalgeographic.com.cn/2017/0211/20170211061910157.jpg'</span></span><br><span class="line">r=requests.get(url)<span class="comment">#图片是以二进制形式保存的</span></span><br><span class="line"><span class="keyword">with</span> open(path,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.content)<span class="comment">#因此要把相应内容的二进制形式写到path中</span></span><br></pre></td></tr></table></figure>

<p>可以看到图片已经保存到我们指定的目录中：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" style="zoom:50%;">

<p>爬取图片的标准代码：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" style="zoom: 33%;">

<h2 id="Beautiful-Soup-库"><a href="#Beautiful-Soup-库" class="headerlink" title="Beautiful Soup 库"></a>Beautiful Soup 库</h2><h3 id="对Beautiful-Soup的理解"><a href="#对Beautiful-Soup的理解" class="headerlink" title="对Beautiful Soup的理解"></a>对Beautiful Soup的理解</h3><p>Beautiful Soup类对应一个HTML/XML文档的全部内容，等价于html文件等价于标签树。bs4库将HTML文件转换为utf-8编码。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" style="zoom: 33%;">

<h3 id="Beautiful-Soup的四种解析器"><a href="#Beautiful-Soup的四种解析器" class="headerlink" title="Beautiful Soup的四种解析器"></a>Beautiful Soup的四种解析器</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" style="zoom: 67%;">

<h3 id="Beautiful-Soup类的基本元素"><a href="#Beautiful-Soup类的基本元素" class="headerlink" title="Beautiful Soup类的基本元素"></a>Beautiful Soup类的基本元素</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" style="zoom: 67%;">

<p>如<a>.attrs[‘href’] 指获取a标签中键为href的值</a></p>
<p>代码展示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'https://python123.io/ws/demo.html'</span></span><br><span class="line">r=requests.get(url)</span><br><span class="line">demo=r.text</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup<span class="comment">#在anaconda中已经有bs4库，不需要再额外安装</span></span><br><span class="line">soup=BeautifulSoup(demo,<span class="string">'html.parser'</span>)<span class="comment">#用html.parser解析器去解析demo（HTML文件)</span></span><br><span class="line">print(soup)</span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line">print(soup.prettify())<span class="comment">#prettify()会在每个标签后加一个换行符，作用是让&lt;html&gt;页面更友好的显示</span></span><br></pre></td></tr></table></figure>

<p>out</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(soup.title)<span class="comment">#打印标题</span></span><br><span class="line">a_tap=soup.a</span><br><span class="line">print(a_tap)<span class="comment">#只能打印第一个a标签</span></span><br><span class="line">print(soup.a.name)<span class="comment">#打印a标签的名字</span></span><br><span class="line">print(soup.a.parent.name)<span class="comment">#打印包含a标签的那个标签的名字</span></span><br><span class="line">print(a_tap.attrs)<span class="comment">#打印a标签的属性(键值对形式)</span></span><br><span class="line">print(a_tap.attrs[<span class="string">'class'</span>])<span class="comment">#打印a标签中class对应的值</span></span><br><span class="line">print(a_tap.string)<span class="comment">#打印a标签的字符串信息</span></span><br></pre></td></tr></table></figure>

<p>out</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<h3 id="标签树的遍历"><a href="#标签树的遍历" class="headerlink" title="标签树的遍历"></a>标签树的遍历</h3><p>（通过这些遍历方法更加直观的去获取我们想要的标签）</p>
<p>三种遍历方式（以上个代码为例）：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" style="zoom:50%;">

<h4 id="下行遍历"><a href="#下行遍历" class="headerlink" title="下行遍历"></a>下行遍历</h4><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" style="zoom:67%;">

<p>代码展示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(soup.head)<span class="comment">#打印head标签</span></span><br><span class="line">print(soup.head.contents)<span class="comment">#打印head标签的子标签，返回列表形式</span></span><br><span class="line">print(soup.body.contents)<span class="comment">#打印body标签的子标签，返回列表形式</span></span><br><span class="line">print(len(soup.body.contents))<span class="comment">#打印body标签的子标签数量</span></span><br><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> soup.body.children: <span class="comment">#对子标签进行遍历</span></span><br><span class="line">    print(child)</span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<p>out</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" style="zoom:67%;">

<h4 id="上行遍历"><a href="#上行遍历" class="headerlink" title="上行遍历"></a>上行遍历</h4><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" style="zoom:67%;">

<h4 id="平行遍历"><a href="#平行遍历" class="headerlink" title="平行遍历"></a>平行遍历</h4><p>平行遍历必须发生在同一个父节点的各节点之间。节点不一定都是标签类型，也有可能是字符串类型。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" style="zoom:50%;">

<h3 id="Beauitful-Soup的find-all-方法"><a href="#Beauitful-Soup的find-all-方法" class="headerlink" title="Beauitful Soup的find_all()方法"></a>Beauitful Soup的find_all()方法</h3><p>格式：soup.find_all(tag, attributes, recursive, text, limit, keywords)</p>
<p>由于find_all()非常常用，我们还可以用简写：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.png" style="zoom:50%;">

<p>find()方法不同的是只返回一个结果：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png" style="zoom:50%;">

<p>代码展示（依旧是上文的soup）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(soup.find_all(<span class="string">'a'</span>))<span class="comment">#查找所有a标签  </span></span><br><span class="line">print(soup.find_all([<span class="string">'a'</span>,<span class="string">'b'</span>]))<span class="comment">#查找所有a标签和b标签</span></span><br></pre></td></tr></table></figure>

<p>out：</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> soup.find_all(<span class="literal">True</span>):</span><br><span class="line">    print(tag.name)<span class="comment">#打印所有标签名</span></span><br></pre></td></tr></table></figure>

<p>out：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/21.png" style="zoom:50%;">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re<span class="comment">#导入正则表达式</span></span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> soup.find_all(re.compile(<span class="string">'b'</span>)):</span><br><span class="line">    print(tag.name)<span class="comment">#打印以'b'开头的标签名</span></span><br><span class="line">print(soup.find_all(<span class="string">'p'</span>,<span class="string">'course'</span>))<span class="comment">#打印含有'course'的p标签</span></span><br></pre></td></tr></table></figure>

<p>out:</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/22.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(soup.find_all(id=<span class="string">'link1'</span>))<span class="comment">#打印link(属性)=1(值)的标签</span></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line">print(soup.find_all(id=re.compile(<span class="string">'link'</span>)))<span class="comment">#打印含有名字以'link'开头的属性的标签</span></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line">print(soup.find_all(string=<span class="string">'Basic Python'</span>))</span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">100</span>)</span><br><span class="line">print(soup.find_all(string=re.compile(<span class="string">'Python'</span>)))<span class="comment">#打印所有含有'python'的字符串</span></span><br></pre></td></tr></table></figure>

<p>out:</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/23.png" alt></p>
<h2 id="实例2（利用BS获取大学排名信息）"><a href="#实例2（利用BS获取大学排名信息）" class="headerlink" title="实例2（利用BS获取大学排名信息）"></a>实例2（利用BS获取大学排名信息）</h2><p>url:<a href="http://zuihaodaxue.cn/zuihaodaxuepaiming2016.html" target="_blank" rel="noopener">http://zuihaodaxue.cn/zuihaodaxuepaiming2016.html</a></p>
<p>需要输出大学排名和总分。</p>
<h3 id="方法一：用BeautifulSoup"><a href="#方法一：用BeautifulSoup" class="headerlink" title="方法一：用BeautifulSoup"></a>方法一：用BeautifulSoup</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> bs4 </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">r=requests.get(<span class="string">'http://zuihaodaxue.cn/zuihaodaxuepaiming2016.html'</span>)</span><br><span class="line">r.encoding=r.apparent_encoding </span><br><span class="line">demo=r.text</span><br><span class="line">soup=BeautifulSoup(demo,<span class="string">'html.parser'</span>)</span><br><span class="line">ulist=[]</span><br><span class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> soup.find(<span class="string">'tbody'</span>).children:<span class="comment">#tr代表一所学校的信息</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(tr,bs4.element.Tag):<span class="comment">#过滤掉所有tr中非标签类型的节点,因为通过打印tr我们发现两个None,属于NavigableString类型;isinstance()用于判断某个对象的类型，若符合，则为True</span></span><br><span class="line">        tds=tr(<span class="string">'td'</span>)<span class="comment">#只留下'td'标签，因为此标签包含了所有我们想要的信息</span></span><br><span class="line">        ulist.append([tds[<span class="number">0</span>].string,tds[<span class="number">1</span>].string,tds[<span class="number">3</span>].string]) <span class="comment">#排名，大学名，总分分别在tds列表的第1，2，4位</span></span><br><span class="line"></span><br><span class="line">pd.DataFrame(ulist,columns=[<span class="string">'排名'</span>,<span class="string">'学校名称'</span>,<span class="string">'总分'</span>])<span class="comment">#ulist正好可以看作310行3列的二维数组传到pd.DataFrame中</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/24.png" alt></p>
<h3 id="方法二：-用正则表达式"><a href="#方法二：-用正则表达式" class="headerlink" title="方法二：#用正则表达式"></a>方法二：#用正则表达式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">r=requests.get(<span class="string">'http://zuihaodaxue.cn/zuihaodaxuepaiming2016.html'</span>)</span><br><span class="line">r.encoding=r.apparent_encoding</span><br><span class="line">demo=r.text</span><br><span class="line">a=re.findall(<span class="string">'(?&lt;=&lt;tr class="alt"&gt;&lt;td&gt;)\d+(?=&lt;/td&gt;)|(?&lt;=&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;)\d+(?=&lt;/td&gt;)'</span>,demo)<span class="comment">#排名,列表类型</span></span><br><span class="line">b=re.findall(<span class="string">'&lt;div align="left"&gt;(.*?)&lt;/div&gt;'</span>,demo)<span class="comment">#大学名称</span></span><br><span class="line">c=re.findall(<span class="string">'&lt;/td&gt;&lt;td&gt;(.*?)&lt;/td&gt;&lt;td class="hidden-xs need-hidden indicator5"&gt;'</span>,demo)<span class="comment">#对应的分数</span></span><br><span class="line">d=zip(a,b,c)</span><br><span class="line">e=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">    e.append(list(i))</span><br><span class="line">pd.DataFrame(e,columns=[<span class="string">'排名'</span>,<span class="string">'学校名称'</span>,<span class="string">'总分'</span>])</span><br></pre></td></tr></table></figure>

<p>输出结果与方法一 一模一样。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="re库的主要功能函数"><a href="#re库的主要功能函数" class="headerlink" title="re库的主要功能函数"></a>re库的主要功能函数</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.png" style="zoom: 67%;">

<p>代码展示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">a=<span class="string">'pyxdddyddpyddddxddddz'</span></span><br><span class="line">b=re.search(<span class="string">'xd'</span>,a) <span class="comment">#返回第一个匹配成功的结果，b为match对象.如果想得到每次的，则应该用.finilter()</span></span><br><span class="line"><span class="keyword">if</span> b:</span><br><span class="line">    print(b.group(<span class="number">0</span>))</span><br><span class="line">c=re.match(<span class="string">'py'</span>,a) <span class="comment">#默认匹配起始的字符串，这里a中起始的两个字符是'py',所以匹配成功。c为match对象</span></span><br><span class="line"><span class="keyword">if</span> c:</span><br><span class="line">    print(c.group())</span><br><span class="line">d=re.match(<span class="string">'xd'</span>,a)</span><br><span class="line">d.group(<span class="number">0</span>)<span class="comment">#报错，因为d为NoneType，为空。</span></span><br></pre></td></tr></table></figure>

<p>out：</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/27.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(re.split(<span class="string">'[1-9]\d&#123;5&#125;'</span>,<span class="string">'BIT100081 TSU100084'</span>))<span class="comment">#切割</span></span><br><span class="line">print(re.split(<span class="string">'[1-9]\d&#123;5&#125;'</span>,<span class="string">'BIT100081 TSU100084'</span>,maxsplit=<span class="number">1</span>))<span class="comment">#maxsplit为最大分割数</span></span><br><span class="line">print(re.sub(<span class="string">'[1-9]\d&#123;5&#125;'</span>,<span class="string">'000000'</span>,<span class="string">'BIT100081 TSU100084'</span>))<span class="comment">#替换</span></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">'[1-9]\d&#123;5&#125;'</span>,<span class="string">'BIT100081 TSU100084'</span>):</span><br><span class="line">    <span class="keyword">if</span> m:</span><br><span class="line">        print(m.group(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<p>out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[&#39;BIT&#39;, &#39; TSU&#39;, &#39;&#39;]</span><br><span class="line">[&#39;BIT&#39;, &#39; TSU100084&#39;]</span><br><span class="line">BIT000000 TSU000000</span><br><span class="line">100081</span><br><span class="line">100084</span><br></pre></td></tr></table></figure>



<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/26.png" style="zoom:67%;">



<p>rex=’\ba\w*\b’</p>
<p>regex=re.compile(rex) #将符合正则表达式规则的字符串编译成正则表达式。适用于我们需要在代码中多次用这个regex。（上图中的面向对象用法）</p>
<h3 id="Match对象"><a href="#Match对象" class="headerlink" title="Match对象"></a>Match对象</h3><p>re.search()和re.match()等返回的都是match对象。</p>
<h4 id="Match对象的属性"><a href="#Match对象的属性" class="headerlink" title="Match对象的属性"></a>Match对象的属性</h4><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/28.png" style="zoom:50%;">

<h4 id="Match对象的方法"><a href="#Match对象的方法" class="headerlink" title="Match对象的方法"></a>Match对象的方法</h4><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/29.png" style="zoom:50%;">

<p>关于.group()的理解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re </span><br><span class="line">a = <span class="string">"123abc456"</span></span><br><span class="line"><span class="comment">#group()的用法</span></span><br><span class="line">print( re.search(<span class="string">"([0-9]*)([a-z]*)([0-9]*)"</span>,a).group(<span class="number">0</span>))   <span class="comment">#123abc456,返回整体</span></span><br><span class="line"><span class="keyword">print</span> (re.search(<span class="string">"([0-9]*)([a-z]*)([0-9]*)"</span>,a).group(<span class="number">1</span>) )  <span class="comment">#123</span></span><br><span class="line">print( re.search(<span class="string">"([0-9]*)([a-z]*)([0-9]*)"</span>,a).group(<span class="number">2</span>) )  <span class="comment">#abc</span></span><br><span class="line"><span class="keyword">print</span> (re.search(<span class="string">"([0-9]*)([a-z]*)([0-9]*)"</span>,a).group(<span class="number">3</span>))   <span class="comment">#456</span></span><br></pre></td></tr></table></figure>

<p>out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">123abc456</span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line">456</span><br></pre></td></tr></table></figure>

<h3 id="常用操作符"><a href="#常用操作符" class="headerlink" title="常用操作符"></a>常用操作符</h3><p>？表示重复前一个字符0或1次。如abc?可以表示ab或abc。</p>
<p>.表示除换行符之外的任意字符。</p>
<p>[]表示字符集，如 [abc],[a-z],[0-9]，只取其中一个。如\w相当于[a-zA-Z0-9_]</p>
<p>{m}表示扩展前一个字符m次。{m,n}表示扩展前一个字符m次到n次中的任意一次。</p>
<p>|表示左右表达式任意一个</p>
<p>^表示匹配字符串开头； $ 表示匹配字符串结尾,如abc$表示以abc结尾的字符串。</p>
<p>()分组标记，内部只能用|操作符。(abc)表示abc，(abc|efg)表示abc或efg。</p>
<h2 id="实例三（利用正则打印milktea的博客文章名称及阅读量-并降序排列。）"><a href="#实例三（利用正则打印milktea的博客文章名称及阅读量-并降序排列。）" class="headerlink" title="实例三（利用正则打印milktea的博客文章名称及阅读量,并降序排列。）"></a>实例三（利用正则打印milktea的博客文章名称及阅读量,并降序排列。）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">path=<span class="string">'https://blog.csdn.net/SKI_12/article/list/'</span></span><br><span class="line">a=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">    current_path=path+str(i)</span><br><span class="line">    text=requests.get(current_path).text</span><br><span class="line">    current_course=re.findall(<span class="string">'&lt;span class="article-type type-1 float-none"&gt;原创&lt;/span&gt;\s*(.*?)\s*&lt;/a&gt;'</span>,text)</span><br><span class="line">    read_count=re.findall(<span class="string">'readCountWhite.png" alt=""&gt;(.*?)&lt;/span&gt;'</span>,text)</span><br><span class="line">    a.extend(zip(current_course,read_count))</span><br><span class="line">final=sorted(a,key=<span class="keyword">lambda</span> x:int(x[<span class="number">1</span>]),reverse=<span class="literal">True</span>)<span class="comment">#</span></span><br><span class="line">b=[]</span><br><span class="line"><span class="keyword">for</span> j,k <span class="keyword">in</span> final:</span><br><span class="line">    b.append([j,k])</span><br><span class="line"><span class="comment">#显示所有列</span></span><br><span class="line">pd.set_option(<span class="string">'display.max_columns'</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment">#显示所有行</span></span><br><span class="line">pd.set_option(<span class="string">'display.max_rows'</span>, <span class="literal">None</span>)</span><br><span class="line">pd.DataFrame(b,columns=[<span class="string">'文章名'</span>,<span class="string">'阅读数'</span>])</span><br></pre></td></tr></table></figure>

<p>out:</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/30.png" style="zoom: 50%;">



<h2 id="如何应对网页的反爬机制"><a href="#如何应对网页的反爬机制" class="headerlink" title="如何应对网页的反爬机制"></a>如何应对网页的反爬机制</h2><p>有时一些网页会有反爬机制（它们会根据我们的request header判断我们是爬虫而不是人工进行浏览器访问），我们无法直接爬取其html。</p>
<p>这时，可以用浏览器打开那个网页，F12键查看相关网络请求信息，并将Request headers 的信息复制下来按照键值对的形式放到我们爬虫请求访问的headers中。这样网页就会以为我们是普通的人工访问而不是爬虫了。</p>
<p>例如现在我们想爬取淘宝网关于书包的信息。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/计算机学习note\Python网络爬虫和信息提取\31.png" style="zoom: 33%;">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url=<span class="string">'https://s.taobao.com/search?q=书包&amp;s=44'</span></span><br><span class="line">r=requests.get(url,timeout=<span class="number">30</span>)</span><br><span class="line">r.encoding=r.apparent_encoding</span><br><span class="line">text=r.text</span><br><span class="line">print(r.status_code)</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>

<p>out：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/32.png" style="zoom:50%;">

<p>可以看到得到的网页代码与网页源码完全（在网页右键即可查询源码）不一样。</p>
<p>现在将淘宝网上Request headers 的信息（不包含以:开头的那几个）复制下来：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/33.png" style="zoom: 33%;">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">new=&#123;</span><br><span class="line"><span class="string">'accept'</span>:<span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span>,</span><br><span class="line"><span class="string">'accept-encoding'</span>:<span class="string">'gzip, deflate, br'</span>,</span><br><span class="line"><span class="string">'accept-language'</span>:<span class="string">'zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7'</span>,</span><br><span class="line"><span class="string">'cookie'</span>:<span class="string">'cookie2=1744088efca9155b56bd3e0f9d5905eb; t=75313cb0923e69ae22728f64f078da4d; _tb_token_=68aebf17357e; _samesite_flag_=true; tfstk=cWtNB0aOHcna6NsjyGsVhHyrtWJOZd_czkWASUwtHiCu3gQGi7NAKI15LTC-xNf..; enc=LZ3cO6wxiQ6wBk3Vfr7BQplKkPcZy2KKVPKBQIhOo9K4PUiM8DnCKnEPt%2BP6IdufTjGpTMl%2BKK%2FlclC4XVYfpg%3D%3D; thw=cn; hng=CN%7Czh-CN%7CCNY%7C156; mt=ci=0_0; tracknick=; cna=AZYtFzbew1QCAXFscipGmgIf; JSESSIONID=65A5F295B8F1C53428DC6226CC3A7DEC; l=eBOBnIBIQV20X92QBOfZhurza77OSIRADuPzaNbMiOCPO_5p5XkfWZvwzgY9C3GNh60HR35QyF6TBeYBqIv4n5U62j-la_kmn; isg=BGxsuk83HuXukwrZdSH0qhWOPUqeJRDP4jDy5MateJe60Qzb7jXgX2Jj8ZHplUgn'</span>,</span><br><span class="line"><span class="string">'sec-fetch-dest'</span>:<span class="string">'document'</span>,</span><br><span class="line"><span class="string">'sec-fetch-mode'</span>:<span class="string">'navigate'</span>,</span><br><span class="line"><span class="string">'sec-fetch-site'</span>:<span class="string">'none'</span>,</span><br><span class="line"><span class="string">'sec-fetch-user'</span>:<span class="string">'?1'</span>,</span><br><span class="line"><span class="string">'upgrade-insecure-requests'</span>: <span class="string">'1'</span>,</span><br><span class="line"><span class="string">'user-agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36'</span></span><br><span class="line">&#125;<span class="comment">#按键值对的格式保存下来</span></span><br><span class="line">r=requests.get(url,timeout=<span class="number">30</span>,headers=new)<span class="comment">#放到headers中</span></span><br><span class="line">text=r.text</span><br><span class="line">text</span><br></pre></td></tr></table></figure>

<p>此时输出了正常的代码，现在我们就可以进行后续的操作啦！</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/34.png" style="zoom:50%;">

<h2 id="scrapy爬虫框架"><a href="#scrapy爬虫框架" class="headerlink" title="scrapy爬虫框架"></a>scrapy爬虫框架</h2><h3 id="scrapy简介"><a href="#scrapy简介" class="headerlink" title="scrapy简介"></a>scrapy简介</h3><p>爬虫框架是实现爬虫功能的一个软件结构和功能组件结合。可以看作一个半成品，帮助用户实现专业网络爬虫。</p>
<p>如图所示，数据流在此框架传输有三种路径：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/35.png" style="zoom:50%;">

<p>其中：</p>
<p>（5+2）指5个模块和两个中间键</p>
<p>SPIDER模块由用户编写配置。在这个模块解析DOWNLOADE返回的响应，产生爬取项（scraped item)以及额外的爬取请求（比如响应中还有新的url，而我们对这个链接也感兴趣）。</p>
<p>ITEM PIPELINES模块由用户编写配置。这个模块以流水线方式处理SPIDER产生的爬取项；它又一组操作顺序构成，类似流水线，每个操作是一个Item Pipeline类型。这些操作包括：清理、检验和查重爬取项中的HTML数据、将数据存储到数据库。</p>
<p>ENGINE模块不需要用户修改。它控制所有模块间的数据流，并根据条件触发事件。</p>
<p>DOWNLOADER模块不需要用户修改。它根据请求下载网页。</p>
<p>SCHEDULER模块不需要用户修改。它对所有爬取请求的优先级进行调度管理。</p>
<p>ENGINE与DOWNLOADER之间的中间键（Downloader Middleware）：</p>
<p>目的：在DOWNLOADER，ENGINE，SCHEDULER中进行用户可控制的配置。</p>
<p>功能：修改、丢弃，新增请求或响应。</p>
<p>ENGINE与SPIDER之间的中间键（Spider Middleware）：</p>
<p>目地：对请求和爬取项的再处理。</p>
<p>功能：修改、丢弃，新增请求或爬取项。</p>
<h3 id="Requests-VS-Scrapy"><a href="#Requests-VS-Scrapy" class="headerlink" title="Requests VS Scrapy"></a>Requests VS Scrapy</h3><p>相同点：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/36.png" style="zoom: 67%;">

<p>不同点：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/37.png" style="zoom: 67%;">

<h3 id="Scrapy爬虫的常用命令"><a href="#Scrapy爬虫的常用命令" class="headerlink" title="Scrapy爬虫的常用命令"></a>Scrapy爬虫的常用命令</h3><p>在cmd中输入 <strong>scrapy -h</strong>可以看它的常用命令。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/38.png" style="zoom:67%;">

<h2 id="实例四（scrapy应用）"><a href="#实例四（scrapy应用）" class="headerlink" title="实例四（scrapy应用）"></a>实例四（scrapy应用）</h2><p>爬取一个html文件保存到电脑中</p>
<p>步骤一：在cmd中建立一个scrapy工程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\YI&gt;D: #进入D盘 </span><br><span class="line"></span><br><span class="line">D:\&gt;cd pycode #进入pycode文件</span><br><span class="line"></span><br><span class="line">D:\pycode&gt;scrapy startproject python123demo #创建一个名为python123demo的scrapy的工程</span><br></pre></td></tr></table></figure>

<p>生成的目录：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/39.png" style="zoom:50%;">

<p>步骤二：在工程中产生一个Scrapy爬虫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode&gt;cd python123demo #进入python123demo文件</span><br><span class="line"></span><br><span class="line">D:\pycode\python123demo&gt;scrapy genspider demo python123.io #新建一个爬虫（demo.py），在spiders目录下可以看到。demo指爬虫名，python123.io指要爬取的网站域名</span><br><span class="line">#注意！爬虫名不能与工程名一样</span><br><span class="line">Created spider &#39;demo&#39; using template &#39;basic&#39; in module:</span><br><span class="line">  python123demo.spiders.demo</span><br></pre></td></tr></table></figure>

<p>打开demo.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="comment">#创建爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoSpider</span><span class="params">(scrapy.Spider)</span>:</span> <span class="comment">#DemoSpider函数必须继承scrapy.spider类</span></span><br><span class="line">    name = <span class="string">'demo'</span> <span class="comment">#当前爬虫的名字叫demo</span></span><br><span class="line">    allowed_domains = [<span class="string">'python123.io'</span>] <span class="comment">#允许采集的域名，可以不要</span></span><br><span class="line">    start_urls = [<span class="string">'http://python123.io/'</span>] <span class="comment">#开始采集的网站</span></span><br><span class="line"><span class="comment">#解析响应数据，提取数据或者网址等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span> <span class="comment">#用于处理响应、解析内容形成字典、发现新的url爬取请求，目前为初始化值。response就是网页源码</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>步骤三：配置这个爬虫</p>
<p>将返回的html文件存成文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoSpider</span><span class="params">(scrapy.Spider)</span>:</span> <span class="comment">#DemoSpider函数必须继承scrapy.spider类</span></span><br><span class="line">    name = <span class="string">'demo'</span> <span class="comment">#当前爬虫的名字叫demo</span></span><br><span class="line"> <span class="comment">#   allowed_domains = ['python123.io'] #爬取的域名，现在不需要这行</span></span><br><span class="line">    start_urls = [<span class="string">'http://python123.io/ws/demo.html'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span> <span class="comment">#这是一个用于处理响应、解析内容形成字典、发现新的url爬取请求的方法，目前为初始化值。</span></span><br><span class="line">        <span class="comment"># self指面向对象类所属关系的标记，把response的内容写到一个html文件中</span></span><br><span class="line">        fname=response.url.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">with</span> open(fname,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.body)</span><br><span class="line"></span><br><span class="line">        self.log(<span class="string">'saved file %s.'</span> % name ) <span class="comment">#记录日志</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>步骤四：运行爬虫，获取网页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode\python123demo&gt;scrapy crawl demo</span><br></pre></td></tr></table></figure>

<p>可以看到html文件已经被保存到python123demo目录下</p>
<p><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/40.png" alt></p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/41.png" style="zoom: 67%;">



<h3 id="理解yield"><a href="#理解yield" class="headerlink" title="理解yield"></a>理解yield</h3><p>(python3中33个关键字之一)，一般与for循环搭配使用</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/42.png" style="zoom:50%;">

<p>代码展示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">yield</span> i**<span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> gen(<span class="number">5</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>

<p>0 1 4 9 16</p>
<p>为什么要用yield：</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/43.png" style="zoom:50%;">

<h3 id="scrapy爬虫的步骤和总结"><a href="#scrapy爬虫的步骤和总结" class="headerlink" title="scrapy爬虫的步骤和总结"></a>scrapy爬虫的步骤和总结</h3><img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/44.png" style="zoom:50%;">

<p>scrapy支持BS4,re，xpath，lxml，CSS Selector等html信息提取方法。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/47.png" style="zoom:67%;">

<h4 id="scrapy的request类"><a href="#scrapy的request类" class="headerlink" title="scrapy的request类"></a>scrapy的request类</h4><p>class scrapy.http.Request()</p>
<p>.Request对象表示一个http请求。</p>
<p>.由Spider生成，由DownLoader执行。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/45.png" style="zoom: 67%;">

<h4 id="scrapy的response类"><a href="#scrapy的response类" class="headerlink" title="scrapy的response类"></a>scrapy的response类</h4><p>class scrapy.http.Response()</p>
<p>.Response对象表示一个http请求。</p>
<p>.由DownLoader生成，由Spider处理。</p>
<img src="/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/46.png" style="zoom:67%;">



<p>上面两个与requests库中的request和response非常相似。</p>
<h4 id="scrapy的item类"><a href="#scrapy的item类" class="headerlink" title="scrapy的item类"></a>scrapy的item类</h4><p>class scrapy.item.Item()</p>
<p>.Item对象表示一个从http页面中提取的信息内容。</p>
<p>.由Spider生成，由ItemPipeline处理。</p>
<p>.Item类似字典类型，可以按照字典类型操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Python%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekfb000bcovt8re740xd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Re/" rel="tag">Re</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bs4/" rel="tag">bs4</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Scrapy静态爬虫实例-获取ip和port" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Scrapy%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport/" class="article-date">
  <time datetime="2020-07-05T14:41:15.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Scrapy%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport/">Scrapy静态爬虫实例-爬取ip和port</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>地址：<a href="https://www.xicidaili.com/nn/" target="_blank" rel="noopener">https://www.xicidaili.com/nn/</a></p>
<h2 id="1新建项目"><a href="#1新建项目" class="headerlink" title="1新建项目"></a>1新建项目</h2><p>scrapy startproject xxx(项目名称)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode&gt;scrapy startproject xicidailiSpider</span><br></pre></td></tr></table></figure>

<h2 id="2-创建爬虫"><a href="#2-创建爬虫" class="headerlink" title="2 创建爬虫"></a>2 创建爬虫</h2><p>scrapy genspider 爬虫名称 域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode\xicidailiSpider&gt;scrapy genspider xicidaili xicidaili.com</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>   *上面是项目名称，下面是爬虫名称，不要弄成一样的了。</p>
<p>   *网站域名是允许爬虫采集的域名</p>
<p>打开项目，我们就可以发现spider文件夹下有xicidaili.py文件了，这就是我们的爬虫文件！！！</p>
<h2 id="3-Robots协议"><a href="#3-Robots协议" class="headerlink" title="3 Robots协议"></a>3 Robots协议</h2><p>在settings.py文件中，找到下面这行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Obey robots.txt rules</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="keyword">True</span></span><br></pre></td></tr></table></figure>

<p>将True改为False： 不然爬虫没法工作</p>
<p>可以到网站根目录添加后缀 robots.txt查看网站的robots协议</p>
<h2 id="4-爬虫文件介绍"><a href="#4-爬虫文件介绍" class="headerlink" title="4 爬虫文件介绍"></a>4 爬虫文件介绍</h2><p>打开xicidaili.py文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy   <span class="comment">#导入scrapy包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XicidailiSpider</span><span class="params">(scrapy.Spider)</span>:</span>  <span class="comment">#继承自scrapy.Spider类</span></span><br><span class="line">    name = <span class="string">'xicidaili'</span>   <span class="comment">#爬虫名</span></span><br><span class="line">    allowed_domains = [<span class="string">'xicidaili.com'</span>] <span class="comment">#允许爬取的域名，可以注释掉</span></span><br><span class="line">    start_urls = [<span class="string">'http://xicidaili.com/'</span>] <span class="comment">#开始采集的网址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解析响应数据，提取数据获取网址等  response就是网页源码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="5分析网站"><a href="#5分析网站" class="headerlink" title="5分析网站"></a>5分析网站</h2><ul>
<li>提取数据<ul>
<li>正则（基础  ）</li>
<li>xpath ——–&gt;从html中提取数据语法<ul>
<li>response.xpath(‘xpath表达式’).get()  获取一个数据</li>
<li>response.xpath(‘xpath表达式’).getall()  获取多个数据</li>
<li>response.xpath(‘xpath表达式’).extract_first()  和get同样的效果</li>
<li>用xpath helper这个插件，我们可以直观的去查找标签</li>
</ul>
</li>
<li>css</li>
<li>BS4 </li>
</ul>
</li>
</ul>
<h2 id="6提取数据"><a href="#6提取数据" class="headerlink" title="6提取数据"></a>6提取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy   <span class="comment">#导入scrapy包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XicidailiSpider</span><span class="params">(scrapy.Spider)</span>:</span>  <span class="comment">#继承自scrapy.Spider类</span></span><br><span class="line">    name = <span class="string">'xicidaili'</span>   <span class="comment">#爬虫名</span></span><br><span class="line">    allowed_domains = [<span class="string">'xicidaili.com'</span>] <span class="comment">#允许爬取的域名，可以注释掉</span></span><br><span class="line">    <span class="comment"># start_urls = ['http://xicidaili.com/'] #开始采集的网址</span></span><br><span class="line">    start_urls = [<span class="string">'https://www.xicidaili.com/nn/'</span>]<span class="comment">#浏览器打开把网址复制下来</span></span><br><span class="line"><span class="comment">#解析响应数据，提取数据获取网址等  response就是网页源码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment">#提取ip,port</span></span><br><span class="line">        <span class="comment"># response.xpath('表达式')</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[2]/text()')  #ip</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[3]/text()')  #port</span></span><br><span class="line">        <span class="comment"># 我们不像上面几行这么写，拿到tr标签的内容再选择可以保证每个ip和它的port一一对应</span></span><br><span class="line">        selectors = response.xpath(<span class="string">'//tr'</span>)   <span class="comment">#选择所有的tr标签</span></span><br><span class="line">        <span class="keyword">for</span> selector <span class="keyword">in</span> selectors:  <span class="comment">#遍历tr标签下的所有的td标签</span></span><br><span class="line">            ip = selector.xpath(<span class="string">'./td[2]/text()'</span>)  <span class="comment">#   ./ 表示在当前节点下继续选择</span></span><br><span class="line">            port = selector.xpath(<span class="string">'./td[3]/text()'</span>) <span class="comment">#在当前节点下继续选择</span></span><br><span class="line"></span><br><span class="line">            print(ip,port)  <span class="comment">#打印ip  port</span></span><br></pre></td></tr></table></figure>

<h2 id="7运行爬虫"><a href="#7运行爬虫" class="headerlink" title="7运行爬虫"></a>7运行爬虫</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode\xicidailiSpider&gt;scrapy crawl xicidaili</span><br></pre></td></tr></table></figure>

<p>发现报错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">2019-09-15 20:22:36 [scrapy.utils.log] INFO: Scrapy 1.7.2 started (bot: xicidailiSpider)</span><br><span class="line">2019-09-15 20:22:36 [scrapy.utils.log] INFO: Versions: lxml 4.3.4.0, libxml2 2.9.5, cssselect 1.0.3, parsel 1.5.1, w3lib 1.20.0, Twisted 19.2.1, Python 3.7.0 (v3.7.0:1bf9cc5093, Jun 27 2018, 04:59:51) [MSC v.1914 64 bit (AMD64)], pyOpenSSL 19.0.0 (OpenSSL 1.1.1c  28 May 2019), cryptography 2.7, Platform Windows-10-10.0.17134-SP0</span><br><span class="line">2019-09-15 20:22:36 [scrapy.crawler] INFO: Overridden settings: &#123;'BOT_NAME': 'xicidailiSpider', 'NEWSPIDER_MODULE': 'xicidailiSpider.spiders', 'SPIDER_MODULES': ['xicidailiSpider.spiders']&#125;</span><br><span class="line">2019-09-15 20:22:36 [scrapy.extensions.telnet] INFO: Telnet Password: 1f33d178e985a6c0</span><br><span class="line">2019-09-15 20:22:36 [scrapy.middleware] INFO: Enabled extensions:</span><br><span class="line">['scrapy.extensions.corestats.CoreStats',</span><br><span class="line"> 'scrapy.extensions.telnet.TelnetConsole',</span><br><span class="line"> 'scrapy.extensions.logstats.LogStats']</span><br><span class="line">2019-09-15 20:22:36 [scrapy.middleware] INFO: Enabled downloader middlewares:</span><br><span class="line">['scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.retry.RetryMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware',</span><br><span class="line"> 'scrapy.downloadermiddlewares.stats.DownloaderStats']</span><br><span class="line">2019-09-15 20:22:36 [scrapy.middleware] INFO: Enabled spider middlewares:</span><br><span class="line">['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware',</span><br><span class="line"> 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware',</span><br><span class="line"> 'scrapy.spidermiddlewares.referer.RefererMiddleware',</span><br><span class="line"> 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware',</span><br><span class="line"> 'scrapy.spidermiddlewares.depth.DepthMiddleware']</span><br><span class="line">2019-09-15 20:22:36 [scrapy.middleware] INFO: Enabled item pipelines:</span><br><span class="line">[]</span><br><span class="line">2019-09-15 20:22:36 [scrapy.core.engine] INFO: Spider opened</span><br><span class="line">2019-09-15 20:22:36 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)</span><br><span class="line">2019-09-15 20:22:36 [scrapy.extensions.telnet] INFO: Telnet console listening on 127.0.0.1:6023</span><br><span class="line">2019-09-15 20:22:37 [scrapy.downloadermiddlewares.retry] DEBUG: Retrying &lt;GET https://www.xicidaili.com/nn/&gt; (failed 1 times): 503 Service Unavailable</span><br><span class="line">2019-09-15 20:22:37 [scrapy.downloadermiddlewares.retry] DEBUG: Retrying &lt;GET https://www.xicidaili.com/nn/&gt; (failed 2 times): 503 Service Unavailable</span><br><span class="line">2019-09-15 20:22:37 [scrapy.downloadermiddlewares.retry] DEBUG: Gave up retrying &lt;GET https://www.xicidaili.com/nn/&gt; (failed 3 times): 503 Service Unavailable</span><br><span class="line">2019-09-15 20:22:37 [scrapy.core.engine] DEBUG: Crawled (503) &lt;GET https://www.xicidaili.com/nn/&gt; (referer: None)</span><br><span class="line">2019-09-15 20:22:37 [scrapy.spidermiddlewares.httperror] INFO: Ignoring response &lt;503 https://www.xicidaili.com/nn/&gt;: HTTP status code is not handled or not allowed</span><br><span class="line">2019-09-15 20:22:37 [scrapy.core.engine] INFO: Closing spider (finished)</span><br><span class="line">2019-09-15 20:22:37 [scrapy.statscollectors] INFO: Dumping Scrapy stats:</span><br><span class="line">&#123;'downloader/request_bytes': 657,</span><br><span class="line"> 'downloader/request_count': 3,</span><br><span class="line"> 'downloader/request_method_count/GET': 3,</span><br><span class="line"> 'downloader/response_bytes': 999,</span><br><span class="line"> 'downloader/response_count': 3,</span><br><span class="line"> 'downloader/response_status_count/503': 3,</span><br><span class="line"> 'elapsed_time_seconds': 0.60528,</span><br><span class="line"> 'finish_reason': 'finished',</span><br><span class="line"> 'finish_time': datetime.datetime(2019, 9, 15, 12, 22, 37, 561550),</span><br><span class="line"> 'httperror/response_ignored_count': 1,</span><br><span class="line"> 'httperror/response_ignored_status_count/503': 1,</span><br><span class="line"> 'log_count/DEBUG': 4,</span><br><span class="line"> 'log_count/INFO': 11,</span><br><span class="line"> 'response_received_count': 1,</span><br><span class="line"> 'retry/count': 2,</span><br><span class="line"> 'retry/max_reached': 1,</span><br><span class="line"> 'retry/reason_count/503 Service Unavailable': 2,</span><br><span class="line"> 'scheduler/dequeued': 3,</span><br><span class="line"> 'scheduler/dequeued/memory': 3,</span><br><span class="line"> 'scheduler/enqueued': 3,</span><br><span class="line"> 'scheduler/enqueued/memory': 3,</span><br><span class="line"> 'start_time': datetime.datetime(2019, 9, 15, 12, 22, 36, 956270)&#125;</span><br><span class="line">2019-09-15 20:22:37 [scrapy.core.engine] INFO: Spider closed (finished)</span><br></pre></td></tr></table></figure>

<p>503错误，服务器端的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">downloader&#x2F;response_status_count&#x2F;503&#39;: 3,</span><br></pre></td></tr></table></figure>

<p><strong>补充：常见可能被网站识别返回错误</strong><br> 1、CAPTCHApages （captcha，验证码）</p>
<p>2、Unusualcontent delivery delay  （响应时间、速度变慢了）</p>
<p>3、Frequentresponse with HTTP404,301 or 50x errors</p>
<p>（1）301 MovedTemporarily</p>
<p>（2）401unauthorized</p>
<p>（3）403forbidden  （aAatch处理的）</p>
<p>（4）404 notfound</p>
<p>（5）408 requesttimeout</p>
<p>（6）429 too manyrequests</p>
<p>（7）503 serviceunavailable  （ip层）</p>
<h2 id="8原因分析："><a href="#8原因分析：" class="headerlink" title="8原因分析："></a>8原因分析：</h2><p>1、在settings中将rebots改为False，发现依旧返回503错误</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Obey robots.txt rules</span><br><span class="line"></span><br><span class="line">ROBOTSTXT_OBEY = <span class="keyword">False</span></span><br></pre></td></tr></table></figure>

<p>2、再分析，浏览器中打开正常显示，scrapy跟浏览器请求是同一个ip，所以排除ip封锁问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网页不需要登录，排除cookie问题，剩下就是headers中user_agent的问题了。scrapy中添加user_agent之后，成功解决</span><br><span class="line"></span><br><span class="line">结论：没有请求头，被网站识别为爬虫程序（所以要模拟浏览器访问）</span><br></pre></td></tr></table></figure>

<p>所以我们要给他添加请求头header</p>
<h2 id="9添加头部"><a href="#9添加头部" class="headerlink" title="9添加头部"></a>9添加头部</h2><p>在settings.py文件里找到如下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Override the default request headers:</span></span><br><span class="line">DEFAULT_REQUEST_HEADERS = &#123;</span><br><span class="line">  <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span><br><span class="line">  <span class="string">'Accept-Language'</span>: <span class="string">'en'</span>,</span><br><span class="line">  <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将其取消注释并添加请求头，运行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/text()' data='9999'&gt;]</span><br><span class="line">[<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[2]/text()'</span> <span class="attr">data</span>=<span class="string">'120.83.103.135'</span>&gt;</span>] [<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[3]/text()'</span> <span class="attr">data</span>=<span class="string">'9999'</span>&gt;</span>]</span><br><span class="line">[<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[2]/text()'</span> <span class="attr">data</span>=<span class="string">'120.83.122.28'</span>&gt;</span>] [<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[3]/text()'</span> <span class="attr">data</span>=<span class="string">'9999'</span>&gt;</span>]</span><br><span class="line">[<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[2]/text()'</span> <span class="attr">data</span>=<span class="string">'14.115.206.93'</span>&gt;</span>] [<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[3]/text()'</span> <span class="attr">data</span>=<span class="string">'61234'</span>&gt;</span>]</span><br><span class="line">[<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[2]/text()'</span> <span class="attr">data</span>=<span class="string">'125.123.122.206'</span>&gt;</span>] [<span class="tag">&lt;<span class="name">Selector</span> <span class="attr">xpath</span>=<span class="string">'./td[3]/text()'</span> <span class="attr">data</span>=<span class="string">'9999'</span>&gt;</span>]</span><br></pre></td></tr></table></figure>

<p>但是有一个问题，我们要的数据保存在一个对象里面，我们要把他取出来：</p>
<h2 id="10数据整理"><a href="#10数据整理" class="headerlink" title="10数据整理"></a>10数据整理</h2><p>我们使用get/extract_first/getall方法来获取数据对象里的数据，在这里get/extract_firs所取得的效果是一样的，随意使用，接下来我们继续完善我们的爬虫文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy   <span class="comment">#导入scrapy包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XicidailiSpider</span><span class="params">(scrapy.Spider)</span>:</span>  <span class="comment">#继承自scrapy.Spider类</span></span><br><span class="line">    name = <span class="string">'xicidaili'</span>   <span class="comment">#爬虫名</span></span><br><span class="line">    allowed_domains = [<span class="string">'xicidaili.com'</span>] <span class="comment">#允许爬取的域名</span></span><br><span class="line">    <span class="comment"># start_urls = ['http://xicidaili.com/'] #开始采集的网址</span></span><br><span class="line">    start_urls = [<span class="string">'https://www.xicidaili.com/nn/'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#解析响应数据，提取数据获取网址等  response就是网页源码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment">#提取ip,port</span></span><br><span class="line">        <span class="comment"># response.xpath('表达式')</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[2]/text()')  #ip</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[3]/text()')  #port</span></span><br><span class="line">        <span class="comment"># 我们不像上面几行这么写，拿到tr标签的内容再选择可以保证每个ip和它的port一一对应</span></span><br><span class="line">        selectors = response.xpath(<span class="string">'//tr'</span>)   <span class="comment">#选择所有的tr标签</span></span><br><span class="line">        <span class="keyword">for</span> selector <span class="keyword">in</span> selectors:  <span class="comment">#遍历tr标签下的所有的td标签</span></span><br><span class="line">            ip = selector.xpath(<span class="string">'./td[2]/text()'</span>).get()  <span class="comment">#   ./ 表示在当前节点下继续选择</span></span><br><span class="line">            port = selector.xpath(<span class="string">'./td[3]/text()'</span>).get() <span class="comment">#在当前节点下继续选择</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">#ip = selector.xpath('./td[2]/text()').extract_first()    </span></span><br><span class="line">            <span class="comment">#port = selector.xpath('./td[3]/text()').extract_first() #这两行与前两行效果一样</span></span><br><span class="line">            print(ip,port)  <span class="comment">#打印ip  port</span></span><br></pre></td></tr></table></figure>

<p>运行爬虫：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode\xicidailiSpider&gt;scrapy crawl xicidaili</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">112<span class="selector-class">.87</span><span class="selector-class">.71</span><span class="selector-class">.119</span> 9999</span><br><span class="line">144<span class="selector-class">.123</span><span class="selector-class">.68</span><span class="selector-class">.159</span> 9999</span><br><span class="line">110<span class="selector-class">.86</span><span class="selector-class">.136</span><span class="selector-class">.82</span> 9999</span><br><span class="line">110<span class="selector-class">.86</span><span class="selector-class">.136</span><span class="selector-class">.128</span> 9999</span><br><span class="line">171<span class="selector-class">.11</span><span class="selector-class">.178</span><span class="selector-class">.251</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.105</span><span class="selector-class">.156</span> 9999</span><br><span class="line">171<span class="selector-class">.35</span><span class="selector-class">.149</span><span class="selector-class">.199</span> 9999</span><br><span class="line">125<span class="selector-class">.125</span><span class="selector-class">.131</span><span class="selector-class">.41</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.102</span><span class="selector-class">.74</span> 9999</span><br><span class="line">1<span class="selector-class">.197</span><span class="selector-class">.203</span><span class="selector-class">.187</span> 9999</span><br><span class="line">120<span class="selector-class">.84</span><span class="selector-class">.100</span><span class="selector-class">.140</span> 808</span><br><span class="line">115<span class="selector-class">.207</span><span class="selector-class">.253</span><span class="selector-class">.27</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.101</span><span class="selector-class">.77</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.102</span><span class="selector-class">.181</span> 9999</span><br><span class="line">27<span class="selector-class">.43</span><span class="selector-class">.185</span><span class="selector-class">.13</span> 9999</span><br><span class="line">1<span class="selector-class">.197</span><span class="selector-class">.11</span><span class="selector-class">.20</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.103</span><span class="selector-class">.135</span> 9999</span><br><span class="line">120<span class="selector-class">.83</span><span class="selector-class">.122</span><span class="selector-class">.28</span> 9999</span><br><span class="line">14<span class="selector-class">.115</span><span class="selector-class">.206</span><span class="selector-class">.93</span> 61234</span><br><span class="line">125<span class="selector-class">.123</span><span class="selector-class">.122</span><span class="selector-class">.206</span> 9999</span><br></pre></td></tr></table></figure>

<p>这样就拿到了我们想要的东西</p>
<h2 id="11-问题来了（获取所有页面）"><a href="#11-问题来了（获取所有页面）" class="headerlink" title="11 问题来了（获取所有页面）"></a>11 问题来了（获取所有页面）</h2><p>我们这里只获取到了一个页面的数据，但现实中我们要爬取的远不止一个页面的，拿xicidaili来说，他目前有4071页，我们从最初级的开始 使用for循环，遍历看看：</p>
<p>遍历所有页面：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start_urls = [<span class="string">'https://www.xicidaili.com/nn/&#123;page&#125;'</span> <span class="keyword">for</span> page in <span class="keyword">range</span>(<span class="number">1</span>,<span class="number">4071</span>)]</span><br></pre></td></tr></table></figure>

<p>（但不要轻易尝试上述代码，短时间操作太多次可能会被网址封掉IP）</p>
<p>假如以后该网站继续添加页面数，那怎么办？</p>
<p>我们发现每页代码都标明了下一页，最后一页的next_page为disable,为空，所以就好办了。</p>
<p>我们在第一页时使用xpath获取下一页的链接地址：(用插件：xpath helper)</p>
<figure class="highlight xpath"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//a[@class=<span class="string">"next_page"</span>]/@href</span><br></pre></td></tr></table></figure>

<p>上行指在有键值对为class=”next_page”的a标签中找键为href的值</p>
<p>显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;nn&#x2F;2</span><br></pre></td></tr></table></figure>

<h3 id="完整的爬虫代码"><a href="#完整的爬虫代码" class="headerlink" title="完整的爬虫代码"></a>完整的爬虫代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy   <span class="comment">#导入scrapy包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XicidailiSpider</span><span class="params">(scrapy.Spider)</span>:</span>  <span class="comment">#继承自scrapy.Spider类</span></span><br><span class="line">    name = <span class="string">'xicidaili'</span>   <span class="comment">#爬虫名</span></span><br><span class="line">    allowed_domains = [<span class="string">'xicidaili.com'</span>] <span class="comment">#允许爬取的域名</span></span><br><span class="line">    <span class="comment"># start_urls = ['http://xicidaili.com/'] #开始采集的网址</span></span><br><span class="line">    start_urls = [<span class="string">'https://www.xicidaili.com/nn/4068'</span>]<span class="comment">#尝试一下从4068页开始爬</span></span><br><span class="line">    <span class="comment"># start_urls = ['https://www.xicidaili.com/nn/&#123;page&#125;' for page in range(1,4071)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解析响应数据，提取数据获取网址等  response就是网页源码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment">#提取ip,port</span></span><br><span class="line">        <span class="comment"># response.xpath('表达式')</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[2]/text()')  #ip</span></span><br><span class="line">        <span class="comment"># response.xpath('//tr//td[3]/text()')  #port</span></span><br><span class="line">        <span class="comment"># 我们不像上面几行这么写，拿到tr标签的内容再选择可以保证每个ip和它的port一一对应</span></span><br><span class="line">        selectors = response.xpath(<span class="string">'//tr'</span>)   <span class="comment">#选择所有的tr标签</span></span><br><span class="line">        <span class="keyword">for</span> selector <span class="keyword">in</span> selectors:  <span class="comment">#遍历tr标签下的所有的td标签</span></span><br><span class="line">            ip = selector.xpath(<span class="string">'./td[2]/text()'</span>).get()  <span class="comment">#   ./ 表示在当前节点下继续选择</span></span><br><span class="line">            port = selector.xpath(<span class="string">'./td[3]/text()'</span>).get() </span><br><span class="line">            </span><br><span class="line">            items=&#123;</span><br><span class="line">            <span class="string">'ip'</span>:ip,</span><br><span class="line">            <span class="string">'port'</span>:port</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">yield</span> items <span class="comment">#我们定义一个字典相当于给两列数据起名，并用生成器生成，后面进行保存操作</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#翻页操作</span></span><br><span class="line">        next_page = response.xpath(<span class="string">'//a[@class="next_page"]/@href'</span>).get()</span><br><span class="line">        <span class="keyword">if</span> next_page:</span><br><span class="line">            print(next_page)</span><br><span class="line">            <span class="comment">#拼接网址</span></span><br><span class="line">            <span class="comment"># next_url = "https://www.xicidaili.com"+next_page;与下一行代码效果一样</span></span><br><span class="line">            next_url = response.urljoin(next_page)<span class="comment">#next_page作为相对路径并入url</span></span><br><span class="line">            <span class="comment">#发出请求   Request callback是回调函数，将请求得到响应交给自己处理</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_url,callback=self.parse) <span class="comment">#生成器</span></span><br></pre></td></tr></table></figure>

<p>Request()发出请求，类似于requests.get()</p>
<p>callback 是将发出去的请求得到的响应交还给自己处理</p>
<h2 id="12保存输出"><a href="#12保存输出" class="headerlink" title="12保存输出"></a>12保存输出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\pycode\xicidailiSpider&gt;scrapy crawl xicidaili -o ip.json  (json文件) &#x2F;ip.csv(csv文件)</span><br></pre></td></tr></table></figure>

<p>现在可以看到文件已经保存好了</p>
<p><img src="/2020/07/05/Scrapy%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport/Scrapy-%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport%5C1.png" alt></p>
<p>打开csv文件：</p>
<p><img src="/2020/07/05/Scrapy%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport/Scrapy-%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport%5C2.png" alt></p>
<p>成功！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Scrapy%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B-%E8%8E%B7%E5%8F%96ip%E5%92%8Cport/" data-id="ckcapekfa000acovtb98n9rhp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB/" rel="tag">静态爬虫</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python之数据结构学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-05T14:27:03.000Z" itemprop="datePublished">2020-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Python之数据结构学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>初识数据结构</p>
<p><strong>数据结构</strong>( data structure )是计算机存储、组织数据的方式。数据结构是指相互之间存在一种或多种特定关系的数据元素的集合。通常情况下，精心选择的数据结构可以带来更高的运行或者存储效率。数据结构往往同高效的检索算法和索引技术有关。</p>
<p>学习数据结构的意义</p>
<p>在许多类型的程序的设计中，数据结构的选择是一个基本的设计考虑因素。许多大型系统的构造经验表明，系统实现的困难程度和系统构造的质量都严重地依赖于是否选择了最优的数据结构。许多时候，确定了数据结构后，算法就容易得到了。有些时候事情也会反过来，我们根据特定算法来选择数据结构与之适应。不论哪种情况，选择合适的数据结构都是非常重要的。</p>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p>栈（stack）又名堆栈，它是一种运算受限的线性表。其限制是仅允许在表的一端进行插入和删除运算。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/.1.png" alt></p>
<p>栈允许进行插入和删除操作的一端称为栈顶(top)，另一端为栈底(bottom)；栈底固定，而栈顶浮动；栈中元素个数为零时称为空栈。插入一般称为进栈（PUSH），删除则称为退栈（POP）。</p>
<p>由于堆叠数据结构只允许在一端进行操作，因而按照后进先出（LIFO, Last In First Out）的原理运作。栈也称为后进先出表。</p>
<h4 id="1-创建一个-Stack-的类"><a href="#1-创建一个-Stack-的类" class="headerlink" title="1. 创建一个 Stack 的类"></a><strong>1. 创建一个 Stack 的类</strong></h4><p>对栈进行初始化参数设计</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, limit=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.stack = []  <span class="comment"># 存放元素</span></span><br><span class="line">        self.limit = limit  <span class="comment"># 栈容量极限</span></span><br></pre></td></tr></table></figure>

<h4 id="2-push-进栈"><a href="#2-push-进栈" class="headerlink" title="2. push 进栈"></a><strong>2. push 进栈</strong></h4><p>压入 push ：将新元素放在栈顶</p>
<p>当新元素入栈时，栈顶上移，新元素放在栈顶。</p>
<p>具体实现代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, data)</span>:</span></span><br><span class="line">    <span class="comment"># 判断栈是否溢出</span></span><br><span class="line">    <span class="keyword">if</span> len(self.stack) &gt;= self.limit:</span><br><span class="line">        <span class="keyword">raise</span> IndexError(<span class="string">'超出栈容量极限'</span>)</span><br><span class="line">    self.stack.append(data)</span><br></pre></td></tr></table></figure>

<h4 id="3-pop-退栈"><a href="#3-pop-退栈" class="headerlink" title="3. pop 退栈"></a><strong>3. pop 退栈</strong></h4><p>弹出 pop ：从栈顶移出一个数据</p>
<ul>
<li>栈顶元素拷贝出来</li>
<li>栈顶下移</li>
<li>拷贝出来的栈顶作为函数返回值</li>
</ul>
<p>具体实现代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.stack:</span><br><span class="line">        <span class="keyword">return</span> self.stack.pop()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> IndexError(<span class="string">'pop from an empty stack'</span>)  <span class="comment"># 空栈不能被弹出</span></span><br></pre></td></tr></table></figure>

<p>有关于python里raise显示引发异常的方法:</p>
<ul>
<li>当程序出错时,python会自动触发异常,也可以通过raise显示引发异常</li>
<li>一旦执行了raise语句,raise之后的语句不在执行</li>
<li>如果加入了try,except,那么except里的语句会被执行</li>
</ul>
<h4 id="4-添加其他函数"><a href="#4-添加其他函数" class="headerlink" title="4. 添加其他函数**"></a>4. 添加其他函数**</h4><p>peek : 查看堆栈的最上面的元素</p>
<p>is_empty : 判断栈是否为空</p>
<p>size : 返回栈的大小</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.stack:</span><br><span class="line">        <span class="keyword">return</span> self.stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">not</span> bool(self.stack)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> len(self.stack)</span><br></pre></td></tr></table></figure>

<p>完整代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, limit=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.stack = []  <span class="comment"># 存放元素</span></span><br><span class="line">        self.limit = limit  <span class="comment"># 栈容量极限</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, data)</span>:</span> </span><br><span class="line">        <span class="comment"># 判断栈是否溢出</span></span><br><span class="line">        <span class="keyword">if</span> len(self.stack) &gt;= self.limit:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'超出栈容量极限'</span>)</span><br><span class="line">        self.stack.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.stack:</span><br><span class="line">            <span class="keyword">return</span> self.stack.pop()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 空栈不能被弹出元素</span></span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'pop from an empty stack'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 查看栈的栈顶元素（最上面的元素）</span></span><br><span class="line">        <span class="keyword">if</span> self.stack:</span><br><span class="line">            <span class="keyword">return</span> self.stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 查看堆栈的最上面的元素</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> bool(self.stack) <span class="comment">#判断栈是否溢</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 返回栈的大小</span></span><br><span class="line">        <span class="keyword">return</span> len(self.stack)</span><br></pre></td></tr></table></figure>

<p><strong>bool()</strong> 函数用于将给定参数转换为布尔类型，如果没有参数，返回 False。</p>
<h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><p>链表(linked_list)是物理存储单元上非连续的、非顺序的存储结构，数据元素的逻辑顺序是通过链表的指针地址实现，每个元素包含两个结点，一个是存储元素的数据域 (内存空间)，另一个是指向下一个结点地址的指针域。根据指针的指向，链表能形成不同的结构，例如单链表，双向链表，循环链表等。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt></p>
<p>链表通过将链点 i 与其邻居链点 i+1 通过指针相关联，从索引 0 到索引 N-1 对链点进行排序。</p>
<h4 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h4><p><strong>1. 创建 Node 类</strong></p>
<p>创建一个 Node 的类，作为基础数据结构：链点，并初始化对应的内参。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        self.data = data  <span class="comment"># 表示对应的元素值</span></span><br><span class="line">        self.next = <span class="literal">None</span>  <span class="comment"># 表示下一个链接的链点</span></span><br></pre></td></tr></table></figure>

<p><strong>2. 创建 Linked_List 类</strong></p>
<p>创建一个 Linked_List 的类，并初始化对应的内参。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Linked_List</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, head=None)</span>:</span>  <span class="comment"># 链表初始化函数</span></span><br><span class="line">        self.head = head  <span class="comment"># 表示链表的头部元素</span></span><br></pre></td></tr></table></figure>

<p><strong>3. 添加 append 函数</strong></p>
<p>添加一个 append 的函数，功能是向链表添加新的结点</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, new_element)</span>:</span></span><br><span class="line">    <span class="comment"># 将头部结点指向临时变量 current</span></span><br><span class="line">    current = self.head</span><br><span class="line">    <span class="comment"># 当头部结点存在时</span></span><br><span class="line">    <span class="keyword">if</span> self.head:</span><br><span class="line">        <span class="comment"># 循环遍历到链表的最后一个元素</span></span><br><span class="line">        <span class="keyword">while</span> current.next:</span><br><span class="line">            current = current.next</span><br><span class="line">        current.next = new_element</span><br><span class="line">    <span class="comment"># 当头部结点不存在时</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.head = new_element</span><br></pre></td></tr></table></figure>

<p><strong>4. 添加 is_empty 函数</strong></p>
<p>添加一个 is_empty 的函数，功能是判断链表是否为空</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    判断链表是否为空</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># bool() 函数只返回 True 和 False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">not</span> self.head</span><br></pre></td></tr></table></figure>

<p><strong>5. 添加 insert 函数</strong></p>
<p>insert(new_element) 往链表中任意位置添加一个 new_element 元素</p>
<p>流程如下：</p>
<ol>
<li>先判断要插入的位置是否在链表的索引范围内。</li>
<li>当插入的位置是头结点（即索引为 0）时，做特殊情况处理。</li>
<li>当要插入结点的位置不在 0 时，找到要插入的位置，插入新结点</li>
</ol>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, position, new_element)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    在链表中指定索引处插入元素</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> position &lt; <span class="number">0</span> <span class="keyword">or</span> position &gt; self.get_length():</span><br><span class="line">        <span class="keyword">raise</span> IndexError(<span class="string">'insert 插入时,key 的值超出了范围'</span>)</span><br><span class="line">    temp = self.head</span><br><span class="line">    <span class="comment"># 将插入元素的 next 属性指向老的头结点，并将新的元素赋值给头结点</span></span><br><span class="line">    <span class="keyword">if</span> position == <span class="number">0</span>:</span><br><span class="line">        new_element.next = temp</span><br><span class="line">        self.head = new_element</span><br><span class="line">        <span class="comment"># new_element.next, self.head = temp, new_element</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 遍历找到索引值为 position 的结点后, 在其后面插入结点</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; position:</span><br><span class="line">        pre = temp</span><br><span class="line">        temp = temp.next</span><br><span class="line">        <span class="comment"># pre, temp = temp, temp.next</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    pre.next = new_element</span><br><span class="line">    new_element.next = temp</span><br><span class="line">    <span class="comment"># pre.next, new_element.next = new_element, temp</span></span><br></pre></td></tr></table></figure>

<p><strong>6. 添加 remove 函数</strong></p>
<p>remove() 从链表中任意位置删除一个元素</p>
<p>流程如下：</p>
<ol>
<li>先判断要删除的元素索引是否存在，如果不存在抛出错误</li>
<li>接着判断当存在链表元素时才能执行删除操作。</li>
<li>当要删除的是头结点时（即索引为 0），做特殊情况处理。</li>
<li>其他情况时，通过循环找到要删除的结点。</li>
<li>最后要做的就是把这个结点删除掉。</li>
</ol>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, position)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    删除指定索引的链表元素</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> position &lt; <span class="number">0</span> <span class="keyword">or</span> position &gt; self.get_length()<span class="number">-1</span>:</span><br><span class="line">        <span class="comment"># print("insert error")</span></span><br><span class="line">        <span class="keyword">raise</span> IndexError(<span class="string">'删除元素的索引超出范围'</span>)</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    temp = self.head</span><br><span class="line">    <span class="comment"># 当存在链表元素时才能执行删除操作</span></span><br><span class="line">    <span class="keyword">while</span> temp != <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 将头结点的后一个结点赋值给新的头结点，再将之前的头结点指向 `None`</span></span><br><span class="line">        <span class="keyword">if</span> position == <span class="number">0</span>:</span><br><span class="line">            self.head = temp.next</span><br><span class="line">            temp.next = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        pre = temp</span><br><span class="line">        <span class="comment"># 以此来遍历链表</span></span><br><span class="line">        temp = temp.next</span><br><span class="line">        <span class="comment"># pre, temp = temp, temp.next</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i == position:</span><br><span class="line">            <span class="comment"># 将 pre 的 next 属性指向 temp 的下一个结点</span></span><br><span class="line">            pre.next = temp.next</span><br><span class="line">            temp.next = <span class="literal">None</span></span><br><span class="line">            <span class="comment"># pre.next, temp.next = temp.next, None</span></span><br><span class="line">            <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p><strong>7. 添加其他函数</strong></p>
<p>get_length:获取链表的长度</p>
<p>print_list:遍历链表，并将元素依次打印出来</p>
<p>reverse:将链表反转</p>
<p>initlist: 将列表转换为链表</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_length</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    返回链表的长度</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    头部结点赋值给头部结点</span><br><span class="line">    temp = self.head</span><br><span class="line">    <span class="comment"># 计算链表的长度变量</span></span><br><span class="line">    length = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> temp != <span class="literal">None</span>:</span><br><span class="line">        length = length+<span class="number">1</span></span><br><span class="line">        temp = temp.next</span><br><span class="line">    <span class="comment"># 返回链表的长度</span></span><br><span class="line">    <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_list</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    遍历链表，并将元素依次打印出来</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print(<span class="string">"linked_list:"</span>)</span><br><span class="line">    <span class="comment"># 头部结点赋值给临时变量 temp</span></span><br><span class="line">    temp = self.head</span><br><span class="line">    <span class="keyword">while</span> temp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        print(temp.data)</span><br><span class="line">        temp = temp.next</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    将链表反转</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    prev = <span class="literal">None</span></span><br><span class="line">    current = self.head</span><br><span class="line">    <span class="keyword">while</span> current:</span><br><span class="line">        next_node = current.next</span><br><span class="line">        current.next = prev</span><br><span class="line">        prev = current</span><br><span class="line">        current = next_node</span><br><span class="line">    self.head = prev</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initlist</span><span class="params">(self,data_list)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    将列表转换为链表</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 创建头结点</span></span><br><span class="line">    self.head = Node(data_list[<span class="number">0</span>])</span><br><span class="line">    temp = self.head</span><br><span class="line">    <span class="comment"># 逐个为 data 内的数据创建结点, 建立链表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data_list[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(i)</span><br><span class="line">        temp.next = node</span><br><span class="line">        temp = temp.next</span><br></pre></td></tr></table></figure>

<p>基于链表的基本功能介绍，我们给出链表的完整代码</p>
<p>在<code>/home/shiyanlou/</code>下新建一个文件<code>linked_list.py</code>。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Linked_List</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, head=None)</span>:</span></span><br><span class="line">        self.head = head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, new_element)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        在链表后面增加一个元素</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        current = self.head</span><br><span class="line">        <span class="keyword">if</span> self.head:</span><br><span class="line">            <span class="keyword">while</span> current.next:</span><br><span class="line">                current = current.next</span><br><span class="line">            current.next = new_element</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.head = new_element</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        判断链表是否为空</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self.head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_length</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取链表的长度</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 临时变量指向队列头部</span></span><br><span class="line">        temp = self.head</span><br><span class="line">        <span class="comment"># 计算链表的长度变量</span></span><br><span class="line">        length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> temp != <span class="literal">None</span>:</span><br><span class="line">            length = length+<span class="number">1</span></span><br><span class="line">            temp = temp.next</span><br><span class="line">        <span class="comment"># 返回链表的长度</span></span><br><span class="line">        <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, position, new_element)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        在链表中指定索引处插入元素</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> position &lt; <span class="number">0</span> <span class="keyword">or</span> position &gt; self.get_length():</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'insert 插入时,key 的值超出了范围'</span>)</span><br><span class="line">        temp = self.head</span><br><span class="line">        <span class="keyword">if</span> position == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># new_element.next = temp</span></span><br><span class="line">            <span class="comment"># self.head = new_element</span></span><br><span class="line">            new_element.next, self.head = temp, new_element</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 遍历找到索引值为 position 的结点后, 在其后面插入结点</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; position:</span><br><span class="line">            <span class="comment"># pre = temp</span></span><br><span class="line">            <span class="comment"># temp = temp.next</span></span><br><span class="line">            pre, temp = temp, temp.next</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="comment"># pre.next = node</span></span><br><span class="line">        <span class="comment"># node.next = temp</span></span><br><span class="line">        pre.next, new_element.next = new_element, temp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_list</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        遍历链表，并将元素依次打印出来</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        print(<span class="string">"linked_list:"</span>)</span><br><span class="line">        temp = self.head</span><br><span class="line">        new_list = []</span><br><span class="line">        <span class="keyword">while</span> temp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            new_list.append(temp.data)</span><br><span class="line">            temp = temp.next</span><br><span class="line">        print(new_list)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        删除指定索引的链表元素</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> position &lt; <span class="number">0</span> <span class="keyword">or</span> position &gt; self.get_length()<span class="number">-1</span>:</span><br><span class="line">            <span class="comment"># print("insert error")</span></span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'删除元素的位置超出范围'</span>)</span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        temp = self.head</span><br><span class="line">        <span class="comment"># 遍历找到索引值为 position 的结点</span></span><br><span class="line">        <span class="keyword">while</span> temp != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> position == <span class="number">0</span>:</span><br><span class="line">                self.head = temp.next</span><br><span class="line">                temp.next = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="comment"># pre = temp</span></span><br><span class="line">            <span class="comment"># temp = temp.next</span></span><br><span class="line">            pre, temp = temp, temp.next</span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i == position:</span><br><span class="line">                <span class="comment"># pre.next = temp.next</span></span><br><span class="line">                <span class="comment"># temp.next = None</span></span><br><span class="line">                pre.next, temp.next = temp.next, <span class="literal">None</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        将链表反转</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        prev = <span class="literal">None</span></span><br><span class="line">        current = self.head</span><br><span class="line">        <span class="keyword">while</span> current:</span><br><span class="line">            <span class="comment"># next_node = current.next</span></span><br><span class="line">            <span class="comment"># current.next = prev</span></span><br><span class="line">            <span class="comment"># prev = current</span></span><br><span class="line">            <span class="comment"># current = next_node</span></span><br><span class="line">            next_node, current.next = current.next, prev</span><br><span class="line">            prev, current = current, next_node</span><br><span class="line">        self.head = prev</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initlist</span><span class="params">(self, data_list)</span>:</span></span><br><span class="line">        “”“</span><br><span class="line">        将列表转换为链表</span><br><span class="line">        ”“”</span><br><span class="line">        <span class="comment"># 创建头结点</span></span><br><span class="line">        self.head = Node(data_list[<span class="number">0</span>])</span><br><span class="line">        temp = self.head</span><br><span class="line">        <span class="comment"># 逐个为 data 内的数据创建结点, 建立链表</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data_list[<span class="number">1</span>:]:</span><br><span class="line">            node = Node(i)</span><br><span class="line">            temp.next = node</span><br><span class="line">            temp = temp.next</span><br></pre></td></tr></table></figure>

<p>复杂度分析</p>
<p>链表属于常见的一种线性结构，对于插入和移除而言，时间复杂度都为 O(1)</p>
<p>但是对于搜索操作而言，不管从链表的头部还是尾部，都需要遍历 O(n)，所以最好复杂度为 O(1)，最坏的情况就是从头部遍历到尾部才搜索出对应的元素，所以最坏复杂度为 O(n)，平均复杂度为 O(n)。</p>
<p>归纳如下：</p>
<ul>
<li>最好复杂度为 O(1)</li>
<li>最坏复杂度为 O(n)</li>
<li>平均复杂度为 O(n)</li>
</ul>
<h4 id="双链表"><a href="#双链表" class="headerlink" title="双链表"></a>双链表</h4><p>双向链表（Double_linked_list）也叫双链表，是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱。所以，从双向链表中的任意一个结点开始，都可以很方便地访问它的前驱结点和后继结点。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 双向链表节点</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line">        self.prev = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLinkList</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 双向链表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 判断链表是否为空</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_length</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 返回链表的长度</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            count = count+<span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 遍历链表</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            print(cur.item)</span><br><span class="line">            cur = cur.next</span><br><span class="line">        print(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="comment"># 头部插入元素</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将 node 赋值给 _head</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 将 node 的 next 属性指向头节点 _head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 将头节点 _head 的 prev 属性指向 node</span></span><br><span class="line">            self._head.prev = node</span><br><span class="line">            <span class="comment"># 将 node 赋值给 _head</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="comment"># 尾部插入元素</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将 node 赋值给 _head</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 循环移动到链表尾部结点的位置</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != <span class="literal">None</span>:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾结点 cur 的 next 属性指向 node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将 node 的 prev 属性指向 cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="comment"># 查找元素是否存在</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, pos, item)</span>:</span></span><br><span class="line">        <span class="comment"># 在指定位置添加节点</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将 node 的 prev 属性指向 cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line">            <span class="comment"># 将 node 的 next 属性指向 cur 的下一个节点</span></span><br><span class="line">            node.next = cur.next</span><br><span class="line">            <span class="comment"># 将 cur 的下一个节点的 prev 属性指向 node</span></span><br><span class="line">            cur.next.prev = node</span><br><span class="line">            <span class="comment"># 将 cur 的 next 指向 node</span></span><br><span class="line">            cur.next = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="comment"># 删除元素</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 如果首节点的元素即是要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.next == <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># 如果链表只有这一个节点</span></span><br><span class="line">                    self._head = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 将第二个节点的 prev 属性设置为 None</span></span><br><span class="line">                    cur.next.prev = <span class="literal">None</span></span><br><span class="line">                    <span class="comment"># 将 _head 指向第二个节点</span></span><br><span class="line">                    self._head = cur.next</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 将 cur 的前一个节点的 next 指向 cur 的后一个节点</span></span><br><span class="line">                    cur.prev.next = cur.next</span><br><span class="line">                    <span class="comment"># 将 cur 的后一个节点的 prev 指向 cur 的前一个节点</span></span><br><span class="line">                    cur.next.prev = cur.prev</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur = cur.next</span><br></pre></td></tr></table></figure>

<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>队列 (queue) 是一种特殊的线性表，特殊之处在于它只允许在表的前端（front）进行删除操作，而在表的后端（rear）进行插入操作，和栈一样，队列是一种操作受限制的线性表。进行插入操作的端称为队尾，进行删除操作的端称为队头。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt></p>
<p>队列符合先进先出[FIFO]的原则。因为要排队的第一个项目，最终将是第一个要出列的项目，如在现实生活中的队列，先来的站在队列前面，后来的就只能站在队列后面啦。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<h4 id="以链表的形式实现队列"><a href="#以链表的形式实现队列" class="headerlink" title="以链表的形式实现队列"></a>以链表的形式实现队列</h4><p>队列有两种实现形式，分为两种：<strong>数组</strong>和<strong>链表</strong>。</p>
<p>在接下来的内容里，我们将以链表的形式实现队列，逐步介绍具体功能是如何实现的。</p>
<p><strong>1. 创建 Node 类</strong></p>
<p>创建一个 Node 的类，作为基础数据结构：链点，并初始化对应的内参。</p>
<p>具体实现代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,elem,next=None)</span>:</span></span><br><span class="line">        self.elem = elem  <span class="comment"># 表示对应的元素值</span></span><br><span class="line">        self.next=next  <span class="comment"># 表示下一个链接的链点</span></span><br></pre></td></tr></table></figure>

<p><strong>2. 创建 Queue 类</strong></p>
<p>创建一个 Queue 的类，以链表形式的队列，并初始化对应的内参。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.head = <span class="literal">None</span>  <span class="comment"># 头部链点为 None</span></span><br><span class="line">        self.rear = <span class="literal">None</span>  <span class="comment"># 尾部链点为 None</span></span><br></pre></td></tr></table></figure>

<p><strong>3. 添加 is_empty 函数</strong></p>
<p>添加一个 is_empty 的函数，功能是判断队列是否为空</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span>  <span class="comment"># 判断队列是否为空</span></span><br></pre></td></tr></table></figure>

<p><strong>4. 添加 enqueue 函数</strong></p>
<p>添加一个 enqueue(elem) 函数，功能是往队列中添加一个 elem 元素</p>
<p>流程如下：</p>
<ol>
<li>Vertex vtx = new Vertex(v) 初始化一个新的点</li>
<li>tail.next = vtx 队列尾部的后继是这个新的点</li>
<li>tail = vtx 然后让队列尾部指针指向这个新的点</li>
</ol>
<p>效果演示：往已知队列[29,9,53]里面添加一个 80 元素</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.gif" alt></p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, elem)</span>:</span></span><br><span class="line">    p = Node(elem)  <span class="comment"># 初始化一个新的点</span></span><br><span class="line">    <span class="keyword">if</span> self.is_empty():</span><br><span class="line">        self.head = p  <span class="comment"># 队列头部为新的链点</span></span><br><span class="line">        self.rear = p  <span class="comment"># 队列尾部为新的链点</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.rear.next = p  <span class="comment"># 队列尾部的后继是这个新的点</span></span><br><span class="line">        self.rear =p  <span class="comment"># 然后让队列尾部指针指向这个新的点</span></span><br></pre></td></tr></table></figure>

<p><strong>5. 添加 dequeue 函数</strong></p>
<p>添加一个 dequeue() 函数，功能是从队列头部删除一个元素</p>
<p>流程如下：</p>
<ol>
<li>先判断队列是否为空，为空即退出 dequeue 操作，不为空即继续后续操作</li>
<li>将队列头部元素赋值到 result 变量里</li>
<li>改变队列的头部指针的位置，然后返回 result</li>
</ol>
<p>效果演示：对已知队列[29,9,53,80] 删除头部元素</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.gif" alt></p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():  <span class="comment"># 判断队列是否为空</span></span><br><span class="line">            print(<span class="string">'Queue_is_empty'</span>)  <span class="comment"># 若队列为空，则退出 dequeue 操作</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = self.head.elem  <span class="comment"># result为队列头部元素</span></span><br><span class="line">            self.head = self.head.next  <span class="comment"># 改变队列头部指针位置</span></span><br><span class="line">            <span class="keyword">return</span> result  <span class="comment"># 返回队列头部元素</span></span><br></pre></td></tr></table></figure>

<p><strong>6. 添加 peek 函数</strong></p>
<p>添加一个 peek() 函数，功能是查看队列头部的元素</p>
<p>流程如下：</p>
<ol>
<li>判断队列是否为空，为空即返回 NOT_FOUND</li>
<li>队列如果不为空，返回队列头部元素</li>
</ol>
<p>具体代码实现如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.is_empty():  <span class="comment"># 判断队列是否为空</span></span><br><span class="line">        print(<span class="string">'NOT_FOUND'</span>)  <span class="comment"># 为空则返回 NOT_FOUND</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self.head.elem  <span class="comment"># 返回队列头部元素</span></span><br></pre></td></tr></table></figure>

<p><strong>7. 添加 print_queue 函数</strong></p>
<p>添加一个 print_queue() 函数，功能是展现队列的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_queue</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"queue:"</span>)</span><br><span class="line">    temp=self.head</span><br><span class="line">    myqueue=[]  <span class="comment"># 暂时存放队列数据</span></span><br><span class="line">    <span class="keyword">while</span> temp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        myqueue.append(temp.elem)</span><br><span class="line">        temp=temp.next</span><br><span class="line">    print(myqueue)</span><br></pre></td></tr></table></figure>

<p>最终代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, elem, next=None)</span>:</span></span><br><span class="line">        self.elem = elem  <span class="comment"># 表示对应的元素值</span></span><br><span class="line">        self.next = next  <span class="comment"># 表示下一个链接的链点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.head = <span class="literal">None</span>  <span class="comment"># 头部链点为 None</span></span><br><span class="line">        self.rear = <span class="literal">None</span>  <span class="comment"># 尾部链点为 None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span>  <span class="comment"># 判断队列是否为空</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, elem)</span>:</span></span><br><span class="line">        p = Node(elem)  <span class="comment"># 初始化一个新的点</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self.head = p  <span class="comment"># 队列头部为新的链点</span></span><br><span class="line">            self.rear = p  <span class="comment"># 队列尾部为新的链点</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rear.next = p  <span class="comment"># 队列尾部的后继是这个新的点</span></span><br><span class="line">            self.rear = p  <span class="comment"># 然后让队列尾部指针指向这个新的点</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():  <span class="comment"># 判断队列是否为空</span></span><br><span class="line">            print(<span class="string">'Queue_is_empty'</span>)  <span class="comment"># 若队列为空，则退出 dequeue 操作</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = self.head.elem  <span class="comment"># result为队列头部元素</span></span><br><span class="line">            self.head = self.head.next  <span class="comment"># 改变队列头部指针位置</span></span><br><span class="line">            <span class="keyword">return</span> result  <span class="comment"># 返回队列头部元素</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():  <span class="comment"># 判断队列是否为空</span></span><br><span class="line">            print(<span class="string">'NOT_FOUND'</span>)  <span class="comment"># 为空则返回 NOT_FOUND</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.head.elem  <span class="comment"># 返回队列头部元素</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_queue</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"queue:"</span>)</span><br><span class="line">        temp = self.head</span><br><span class="line">        myqueue = []  <span class="comment"># 暂时存放队列数据</span></span><br><span class="line">        <span class="keyword">while</span> temp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            myqueue.append(temp.elem)</span><br><span class="line">            temp = temp.next</span><br><span class="line">        print(myqueue)</span><br></pre></td></tr></table></figure>

<h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><p>队列属于常见的一种线性结构，对于出队和进队而言，时间复杂度都为 O(1)</p>
<h4 id="以数组的形式实现队列"><a href="#以数组的形式实现队列" class="headerlink" title="以数组的形式实现队列"></a>以数组的形式实现队列</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.entries = []  <span class="comment"># 表示队列内的参数</span></span><br><span class="line">        self.length = <span class="number">0</span>  <span class="comment"># 表示队列的长度</span></span><br><span class="line">        self.front = <span class="number">0</span>  <span class="comment"># 表示队列头部位置</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        self.entries.append(item)  <span class="comment"># 添加元素到队列里面</span></span><br><span class="line">        self.length = self.length + <span class="number">1</span>  <span class="comment"># 队列长度增加 1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.length = self.length - <span class="number">1</span>  <span class="comment"># 队列的长度减少 1</span></span><br><span class="line">        dequeued = self.entries[self.front]  <span class="comment"># 队首元素为dequeued</span></span><br><span class="line">        self.front -= <span class="number">1</span>  <span class="comment"># 队首的位置减少1</span></span><br><span class="line">        self.entries = self.entries[self.front:]  <span class="comment"># 队列的元素更新为退队之后的队列</span></span><br><span class="line">        <span class="keyword">return</span> dequeued</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.entries[<span class="number">0</span>]  <span class="comment"># 直接返回队列的队首元素</span></span><br></pre></td></tr></table></figure>

<h3 id="树（非线性数据结构）"><a href="#树（非线性数据结构）" class="headerlink" title="树（非线性数据结构）"></a>树（非线性数据结构）</h3><h4 id="树的介绍"><a href="#树的介绍" class="headerlink" title="树的介绍"></a>树的介绍</h4><ol>
<li>树的定义</li>
</ol>
<p>树是一种数据结构，它是由n（n&gt;=1）个有限节点组成一个具有层次关系的集合。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.jpg" alt></p>
<p>把它叫做“树”是因为它看起来像一棵倒挂的树，也就是说它是根朝上，而叶朝下的。它具有以下的特点：<br>(01) 每个节点有零个或多个子节点；<br>(02) 没有父节点的节点称为根节点；<br>(03) 每一个非根节点有且只有一个父节点；<br>(04) 除了根节点外，每个子节点可以分为多个不相交的子树。</p>
<h4 id="树的基本术语"><a href="#树的基本术语" class="headerlink" title="树的基本术语"></a>树的基本术语</h4><p>若一个结点有子树，那么该结点称为子树根的”双亲”，子树的根是该结点的”孩子”。有相同双亲的结点互为”兄弟”。一个结点的所有子树上的任何结点都是该结点的后裔。从根结点到某个结点的路径上的所有结点都是该结点的祖先。</p>
<p>结点的度：结点拥有的子树的数目。<br>叶子：度为零的结点。<br>分支结点：度不为零的结点。<br>树的度：树中结点的最大的度。</p>
<p>层次：根结点的层次为1，其余结点的层次等于该结点的双亲结点的层次加1。<br>树的高度：树中结点的最大层次。<br>无序树：如果树中结点的各子树之间的次序是不重要的，可以交换位置。<br>有序树：如果树中结点的各子树之间的次序是重要的, 不可以交换位置。<br>森林：0个或多个不相交的树组成。对森林加上一个根，森林即成为树；删去根，树即成为森林。</p>
<h4 id="二叉树的介绍"><a href="#二叉树的介绍" class="headerlink" title="二叉树的介绍"></a>二叉树的介绍</h4><ol>
<li>二叉树的定义</li>
</ol>
<p>二叉树是每个节点最多有两个子树的树结构。它有五种基本形态：二叉树可以是空集；根可以有空的左子树或右子树；或者左、右子树皆为空。</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.jpg" alt></p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.jpg" alt></p>
<h4 id="二叉树的性质"><a href="#二叉树的性质" class="headerlink" title="二叉树的性质"></a>二叉树的性质</h4><p>二叉树有以下几个性质：TODO(上标和下标)<br>性质1：二叉树第i层上的结点数目最多为 2{i-1} (i≥1)。<br>性质2：深度为k的二叉树至多有2{k}-1个结点(k≥1)。<br>性质3：包含n个结点的二叉树的高度至少为log2 (n+1)。<br>性质4：在任意一棵二叉树中，若终端结点的个数为n0，度为2的结点数为n2，则n0=n2+1。</p>
<h4 id="二叉树的实现"><a href="#二叉树的实现" class="headerlink" title="二叉树的实现"></a>二叉树的实现</h4><p>二叉树由两个对象组成，一个是节点对象，一个是树对象</p>
<p><strong>1. 创建 Node 类</strong></p>
<p>创建一个 Node 的类，作为基础数据结构：链点，并初始化对应的内参。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        self.item = item  <span class="comment"># 表示对应的元素</span></span><br><span class="line">        self.left = <span class="literal">None</span>  <span class="comment"># 表示左子节点</span></span><br><span class="line">        self.right = <span class="literal">None</span>  <span class="comment"># 表示右子节点</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># print 一个 Node 类时会打印 __str__ 的返回值</span></span><br><span class="line">        <span class="keyword">return</span> str(self.item)</span><br></pre></td></tr></table></figure>

<p><strong>2. 创建 Tree 类</strong></p>
<p>创建一个 Tree 的类，定义根节点。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self，root=None)</span>:</span></span><br><span class="line">        self.root = root</span><br></pre></td></tr></table></figure>

<p>在tree类中添加 add 函数</p>
<p>添加一个 add(item) 的函数，功能是添加子节点到树里面。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, item)</span>:</span></span><br><span class="line">    node = Node(item)</span><br><span class="line">    <span class="comment"># 如果二叉树为空，那么添加的点将插入 root 节点处</span></span><br><span class="line">    <span class="keyword">if</span> self.root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        self.root = node</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 在 q 列表中，添加二叉树的根节点</span></span><br><span class="line">        q = [self.root]</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pop_node = q.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># 左子树为空则将点添加到左子树</span></span><br><span class="line">            <span class="keyword">if</span> pop_node.left <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                pop_node.left = node</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="comment"># 右子树为空则将点添加到右子树</span></span><br><span class="line">            <span class="keyword">elif</span> pop_node.right <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                pop_node.right = node</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                q.append(pop_node.left)</span><br><span class="line">                q.append(pop_node.right)</span><br></pre></td></tr></table></figure>

<p>在tree类中添加 get_parent 函数**</p>
<p>添加一个 get_parent(item) 函数，功能是找到 item 的父节点。</p>
<p>具体实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_parent</span><span class="params">(self, item)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.root.item == item:</span><br><span class="line">        <span class="comment"># 根节点没有父节点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="comment"># 在 tmp 列表中，添加二叉树的根节点</span></span><br><span class="line">    tmp = [self.root]</span><br><span class="line">    <span class="keyword">while</span> tmp:</span><br><span class="line">        pop_node = tmp.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 如果点的左子树为要寻找的点</span></span><br><span class="line">        <span class="keyword">if</span> pop_node.left <span class="keyword">and</span> pop_node.left.item == item:</span><br><span class="line">            <span class="comment"># 返回这个点，即为寻找点的父节点</span></span><br><span class="line">            <span class="keyword">return</span> pop_node</span><br><span class="line">        <span class="comment"># 如果点的右子树为要寻找的点</span></span><br><span class="line">        <span class="keyword">if</span> pop_node.right <span class="keyword">and</span> pop_node.right.item == item:</span><br><span class="line">            <span class="comment"># 返回这个点，即为寻找点的父节点</span></span><br><span class="line">            <span class="keyword">return</span> pop_node</span><br><span class="line">        <span class="comment"># 添加 tmp 列表里的元素</span></span><br><span class="line">        <span class="keyword">if</span> pop_node.left <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            tmp.append(pop_node.left)</span><br><span class="line">        <span class="keyword">if</span> pop_node.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            tmp.append(pop_node.right)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>对二叉树节点的操作是通过列表存储节点的形式来操作，但是二叉树数据本身是通过链表的形式来存储，节点的操作一般使用递归函数。</p>
<h4 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h4><p>二叉搜索树又称二叉查找树，亦称二叉排序树，如下图所示：</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<p>它主要用于搜索。 它或者是一棵空树，或者是具有下列性质的二叉树：</p>
<ol>
<li>若左子树不空，则左子树上所有结点的值均小于它的根结点的值；</li>
<li>若右子树不空，则右子树上所有结点的值均大于它的根结点的值；</li>
<li>左、右子树也分别为二叉排序树。</li>
</ol>
<h4 id="平衡二叉树"><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h4><p>平衡二叉树(平衡二叉树又被称为 AVL 树 )是基于二分法的策略提高数据的查找速度的二叉树的数据结构。</p>
<p>特点：平衡二叉树是采用二分法思维把数据按规则组装成一个树形结构的数据，用这个树形结构的数据减少无关数据的检索，大大的提升了数据检索的速度；平衡二叉树的数据结构组装过程有以下规则：</p>
<ol>
<li>非叶子节点只能允许最多两个子节点存在。</li>
<li>每一个非叶子节点数据分布规则为左边的子节点小于前节点的值，右边的子节点大于当前节点的值(这里值是基于自己的算法规则而定的，比如 hash 值)。</li>
</ol>
<h4 id="遍历二叉树"><a href="#遍历二叉树" class="headerlink" title="遍历二叉树"></a>遍历二叉树</h4><p>遍历原理：</p>
<p>二叉树的遍历：是指从根结点出发，按照某种次序依次访问二叉树中的所有结点，使得每个结点被访问一次且仅被访问一次。</p>
<h5 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h5><ol>
<li>先处理左子树，然后处理当前节点，再处理右子树；</li>
<li>对于一颗二叉查找树，所有的信息都是有序排列的，中序遍历可以是信息有序输出，且运行时间为 O（n）；</li>
<li>递归实现中序遍历。</li>
</ol>
<p>在之前的 Tree 类里面添加 inorder 函数</p>
<p>参考代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inorder</span><span class="params">(self,node)</span>:</span>  <span class="comment"># 中序遍历</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    result = [node.item]</span><br><span class="line">    left_item = self.inorder(node.left)</span><br><span class="line">    right_item = self.inorder(node.right)</span><br><span class="line">    <span class="keyword">return</span> left_item + result + right_item</span><br></pre></td></tr></table></figure>

<p>中序遍历的效果演示:</p>
<p><img src="/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.gif" alt></p>
<h5 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h5><ol>
<li><p>先处理左右子树，然后再处理当前节点，运行时间为 O（n）</p>
</li>
<li><p>递归实现后序遍历</p>
<p>参考代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">postorder</span><span class="params">(self,node)</span>:</span>  <span class="comment"># 后序遍历</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    result = [node.item]</span><br><span class="line">    left_item = self.postorder(node.left)</span><br><span class="line">    right_item = self.postorder(node.right)</span><br><span class="line">    <span class="keyword">return</span> left_item + right_item + result</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="先序遍历"><a href="#先序遍历" class="headerlink" title="先序遍历"></a>先序遍历</h5><ol>
<li>先处理当前节点，再处理左右子树；</li>
<li>递归实现先序遍历。</li>
</ol>
<p>参考代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preorder</span><span class="params">(self,node)</span>:</span>  <span class="comment"># 先序遍历</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    result = [node.item]</span><br><span class="line">    left_item = self.preorder(node.left)</span><br><span class="line">    right_item = self.preorder(node.right)</span><br><span class="line">    <span class="keyword">return</span> result + left_item + right_item</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/05/Python%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckcapekff000fcovtbvg0hmty" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BA%93/">数据分析库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%AF%87/">机器学习基础篇</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Matplotlib/" rel="tag">Matplotlib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pandas/" rel="tag">Pandas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Re/" rel="tag">Re</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Request/" rel="tag">Request</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bs4/" rel="tag">bs4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/" rel="tag">动态爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" rel="tag">无监督学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" rel="tag">监督学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB/" rel="tag">静态爬虫</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Matplotlib/" style="font-size: 10px;">Matplotlib</a> <a href="/tags/Numpy/" style="font-size: 10px;">Numpy</a> <a href="/tags/Pandas/" style="font-size: 10px;">Pandas</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Re/" style="font-size: 10px;">Re</a> <a href="/tags/Request/" style="font-size: 10px;">Request</a> <a href="/tags/Scrapy/" style="font-size: 16.67px;">Scrapy</a> <a href="/tags/bs4/" style="font-size: 10px;">bs4</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/" style="font-size: 10px;">动态爬虫</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 10px;">排序算法</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">无监督学习</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 13.33px;">机器学习</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">监督学习</a> <a href="/tags/%E9%9D%99%E6%80%81%E7%88%AC%E8%99%AB/" style="font-size: 10px;">静态爬虫</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/06/Scrapy-Re-%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B/">Scrapy&amp;Re--动态爬虫实例</a>
          </li>
        
          <li>
            <a href="/2020/07/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95/">机器学习之监督学习算法</a>
          </li>
        
          <li>
            <a href="/2020/07/05/Linux%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Linux操作学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/07/05/Matplotlib%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Matplotlib学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/07/05/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Mysql学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>